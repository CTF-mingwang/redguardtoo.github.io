<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Linux, Programming, Emacs">
<meta name="viewport" content="width=device-width">
<title>Chen's blog (old posts, page 9) | Chen's blog</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://blog.binchen.org/index-9.html">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <section class="social"><ul>
<li><a href="index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="stories/about.html" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://twitter.com/chen_bin" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/redguardtoo" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
            
        <div class="post">
            <h1 class="title"><a href="posts/my-git-set-up.html">My git set up</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-07-07T22:17:00+00:00">2013-07-07 22:17</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/my-git-set-up.html#disqus_thread" data-disqus-identifier="cache/posts/my-git-set-up.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/git.html" rel="tag">git</a></li>
           <li><a class="tag p-category" href="categories/github.html" rel="tag">github</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div id="outline-container-sec-1" class="outline-2">

<div class="outline-text-2" id="text-1">
<p>
Content of my <code>.gitconfig</code>,
</p>
<div class="org-src-container">


<pre><code class="lang-conf">[apply]
    whitespace = nowarn
[user]
    name = my name
    email =my@email.com
[core]
    ; @see http://comments.gmane.org/gmane.comp.version-control.git/166098
    filemode = true
    ;autocrlf = false
    ignorecase = false
    ;autocrlf=false
    ;safecrlf=true
[color]
    diff = auto
    status = auto
    branch = auto
    ui = auto
[alias]
    ca=commit --amend
    cl = clean -fxd
    au = add -u
    st = status -sb #short status output for geeks
    stu= status --untracked-files=no
    r = rebase
    c = commit
    co = checkout
    b = branch
    s=show
    l = log --pretty=format:'%C(yellow)%h%Creset %ad %s %Cred(%an)%Creset' --date=short --decorate --graph
    d =diff
    da= diff --name-only # get the file list
    ds = diff --stat
    dw=diff --word-diff #highlight word changes
    dc = diff --cached
    dcs = diff --cached --stat
    t=stash
    a=add
    f=format-patch -n --stdout
    rh=reset --hard
    rs=reset --soft
    undo=reset --soft HEAD^
    rs=reset
    cnt=count-objects
    ps=push
    p=pull --rebase
    w = whatchanged
    sb = show-branch
    cp = cherry-pick
    # @see http://magazine.redhat.com/2008/05/02/shipping-quality-code-with-git/
    cpnx = cherry-pick --no-commit -x
    rl = reflog
    lp = log -p
    lt = log --topo-order
    gl = log --graph
    m = merge
    mt= mergetool
    me = merge --no-commit --no-ff
    brm = branch --merged
    brnm = branch --no-merged
    rnc = revert --no-commit
    com = checkout master
    glt = log --pretty=format:'%h : %s' --topo-order --graph
    phm = push heroku master
    pom = push origin master
    puom= pull origin master
    untrac=rm -r --cached
    #produce patch for hg
    hgp = show --format="From: %an &lt;%ae&gt;%n%s%n%b" -U8
    show-root-folder = rev-parse --show-toplevel
    forward = pull --ff -r
    u = !git stash &amp;&amp; git pull --rebase &amp;&amp; git stash pop
[sendemail]
    smtpencryption = tls
    smtpserver = smtp.gmail.com
    smtpuser = myname@gmail.com
    smtpserverport = 587
[github]
    user = github user
[push]
    default = tracking

[merge]
    branchdesc = true
    log = true
    tool = vimdiff
[diff]
    tool = vimdiff
[mergetool]
    prompt = false
</code></pre>

</div>

<p>
Content of my <code>.bashrc</code>,
</p>
<div class="org-src-container">


<pre><code class="lang-sh"># enable bash completion in interactive shells
# @see http://www.simplicidade.org/notes/archives/2008/02/bash_completion.html
if [ -f /etc/bash_completion ]; then
    # ArchLinux
    . /etc/bash_completion
elif [ -f /etc/profile.d/bash-completion.sh ]; then
    # Gentoo Linux
    . /etc/profile.d/bash-completion.sh
fi
. $HOME/bash_completion.d/gibo-completion.bash
. $HOME/bash_completion.d/git-completion.bash

function parse_git_branch ()
{
   git branch --no-color 2&gt; /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'
}

function simpleprompt()
{
   if test -n "`type -t git`"; then
      PS1="\$(parse_git_branch) \\$ "
   else
      PS1="\\$ "
   fi
}

alias gcd='cd $(git rev-parse --show-cdup)'
alias g="git status --short -b"
alias gn="git status --untracked-files=no --short -b"
alias gfl="git diff-tree --no-commit-id --name-only -r"
alias ga="git add"
alias gaa="git add ."
alias gau="git add -u"
alias gc="git commit -m"
alias gca="git commit --amend"
alias gb="git branch"
alias gbd="git branch -d"
alias gco="git checkout"
alias gcob="git checkout -b"
alias gt="git stash"
alias gta="git stash apply"
alias gm="git merge"
alias gmt="git mergetool"
alias gr="git rebase"
alias gl="git log --oneline --decorate --graph"
alias gs="git show"
alias gss="git show --stat"
alias gd="git diff"
alias gds="git diff --stat"
alias gdc="git diff --cached"
alias gdcs="git diff --cached --stat"
alias gbl="git blame"
alias gps="git push"
alias gpl="git pull"
alias cdgr='cd $(git rev-parse --show-toplevel)' #goto root dir
function gu(){
    local st=`git status --porcelain --untracked=no`
    if [ -z "$st" ]; then
        git pull --rebase
    else
        git stash &amp;&amp; git pull --rebase &amp;&amp; git stash pop
    fi
}

function gsrp(){
  if [ -z "$1" ]; then
      echo "Usage: gsrp old_string new_string (string could be perl regex)"
      echo "replace the content of file in latest git commit"
  elif [ $# -eq "2" ]; then
      git diff-tree --no-commit-id --name-only -r HEAD|xargs perl -pi -e "s/$1/$2/g"
  elif [ $# -eq "3" ]; then
      git diff-tree --no-commit-id --name-only -r $1|xargs perl -pi -e "s/$2/$3/g"
  fi
}

[ $(uname -s | grep -c CYGWIN) -eq 1 ] &amp;&amp; OS_NAME="CYGWIN" || OS_NAME=`uname -s`
# xclip has some problem with my emacs, so I use xsel for everything
function pclip() {
    if [ $OS_NAME == CYGWIN ]; then
        putclip $@;
    elif [ $OS_NAME == Darwin ]; then
        pbcopy $@;
    else
        if [ -x /usr/bin/xsel ]; then
            xsel -ib $@;
        else
            if [ -x /usr/bin/xclip ]; then
                xclip -selection c $@;
            else
                echo "Neither xsel or xclip is installed!"
            fi
        fi
    fi
}

# search the file in root directory of git repository, pop up dialog let you choose the path,
# then put the full path in clipboard
function gg()
{
    local cli=`find $(git rev-parse --show-toplevel) -type f -iname '*'$*'*'|percol`
    echo -n ${cli}|pclip
    echo ${cli}
}

alias ge='grep -rsn --exclude=TAGS --exclude=tags --exclude=GTAGS --exclude-dir=.svn --exclude-dir=.sass-cache --exclude-dir=.cache  --exclude-dir=.cvs --exclude-dir=.git --exclude-dir=.hg --exclude=\*.swp --exclude=\*~ --color=auto'
function ggs()
{
    local cli=`ge -l $* $(git rev-parse --show-toplevel)/*|percol`
    echo -n ${cli} |pclip;
    echo ${cli}
}
</code></pre>

</div>

<p>
I do lots of git stuff under shell, so I'm heavly dependent on below bash tools,
</p>
<ul class="org-ul">
<li>
<a href="https://github.com/clvv/fasd">fasd</a> to change current directory quickly
</li>
<li>
<a href="https://github.com/mooz/percol">percol</a> to filter the text from stdin interactively
</li>
</ul>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/shi-mian-yu-du-tang-shao-fa.html">虱面鱼肚汤烧法</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-06-30T17:38:41+00:00">2013-06-30 17:38</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/shi-mian-yu-du-tang-shao-fa.html#disqus_thread" data-disqus-identifier="cache/posts/shi-mian-yu-du-tang-shao-fa.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/cuisine.html" rel="tag">cuisine</a></li>
           <li><a class="tag p-category" href="categories/zh.html" rel="tag">zh</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>台湾很有名的小吃,烧法见<a href="http://blog.iset.com.tw/chef/?p=5952">型男大主厨</a>. </p> <p> 要点: </p>
<ul>
<li>先煎生姜是为了快速逼出姜的香味,同一个厨师在另一个节目中又建议姜丝最后放,因为姜放在水中煮就无味了. </li> <li>如最后放生姜,姜丝要很细. </li> <li>鱼肉一面,煎鱼皮沾锅. </li> <li>放下鱼肉煮5分钟即可,否则鱼肉容易老. </li> <li>豆腐当场切片下锅,这样容易入味 </li> <li>柴鱼粉是因为快速烧法,如果先熬鱼骨汤则不需要. </li> </ul>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/install-google-talk-plugin-64bit-on-gentoo-linux.html">install google talk plugin (64bit) on gentoo Linux</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-06-24T20:42:00+00:00">2013-06-24 20:42</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/install-google-talk-plugin-64bit-on-gentoo-linux.html#disqus_thread" data-disqus-identifier="cache/posts/install-google-talk-plugin-64bit-on-gentoo-linux.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/google.html" rel="tag">google</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
           <li><a class="tag p-category" href="categories/talk.html" rel="tag">talk</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<pre class="src src-sh">firefox <span style="color: #8abeb7;">'http://www.google.com/chat/video/thankyou.html'</span>
emerge -v deb2targz &amp;&amp;
<p>deb2targz google-talkplugin_current_amd64.deb &amp;&amp;</p>
<p>mkdir googletalk &amp;&amp; <span style="color: #b294bb;">cd</span> googletalk</p>
<p>tar xvf ../google-talkplugin_current_i386.tar.gz &amp;&amp;</p>
<p>sudo cp -Rfv {etc,opt} /</p>
<p>sudo cp -Rfv usr/lib/* /usr/lib64/</p>
<p></p></pre>   <p> Here is the content of google talk: </p>   <pre class="src src-sh">./etc/cron.daily:
<p>google-talkplugin</p>
<p>./opt/google:</p>
<p>chrome</p>
<p>talkplugin</p>
<p>./opt/google/chrome:</p>
<p>pepper</p>
<p>./opt/google/chrome/pepper:</p>
<p>libppo1d.so</p>
<p>./opt/google/talkplugin:</p>
<p>./usr/lib:</p>
<p>firefox</p>
<p>iceape</p>
<p>iceweasel</p>
<p>midbrowser</p>
<p>mozilla</p>
<p>xulrunner</p>
<p>xulrunner-addons</p>
<p>./usr/lib/firefox:</p>
<p>plugins</p>
<p>./usr/lib/firefox/plugins:</p>
<p>libnpgoogletalk.so</p>
<p>libnpgtpo3dautoplugin.so</p>
<p>libnpo1d.so</p>
<p>./usr/lib/iceape:</p>
<p>plugins</p>
<p>./usr/lib/iceape/plugins:</p>
<p>libnpgoogletalk.so</p>
<p>libnpgtpo3dautoplugin.so</p>
<p>libnpo1d.so</p>
<p>./usr/lib/iceweasel:</p>
<p>plugins</p>
<p>./usr/lib/iceweasel/plugins:</p>
<p>libnpgoogletalk.so</p>
<p>libnpgtpo3dautoplugin.so</p>
<p>libnpo1d.so</p>
<p>./usr/lib/midbrowser:</p>
<p>plugins</p>
<p>./usr/lib/midbrowser/plugins:</p>
<p>libnpgoogletalk.so</p>
<p>libnpgtpo3dautoplugin.so</p>
<p>libnpo1d.so</p>
<p>./usr/lib/mozilla:</p>
<p>plugins</p>
<p>./usr/lib/mozilla/plugins:</p>
<p>libnpgoogletalk.so</p>
<p>libnpgtpo3dautoplugin.so</p>
<p>libnpo1d.so</p>
<p>./usr/lib/xulrunner:</p>
<p>plugins</p>
<p>./usr/lib/xulrunner/plugins:</p>
<p>libnpgoogletalk.so</p>
<p>libnpgtpo3dautoplugin.so</p>
<p>libnpo1d.so</p>
<p>./usr/lib/xulrunner-addons:</p>
<p>plugins</p>
<p>./usr/lib/xulrunner-addons/plugins:</p>
<p>libnpgoogletalk.so</p>
<p>libnpgtpo3dautoplugin.so</p>
<p>libnpo1d.so</p>
<p>./usr/share:</p>
<p>doc</p>
<p>./usr/share/doc:</p>
<p>google-talkplugin</p>
<p>./usr/share/doc/google-talkplugin:</p>
<p>changelog.Debian.gz</p>
<p></p></pre>  </div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/set-up-nfs-server-on-archlinux.html">set up nfs server on ArchLinux</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-06-19T22:00:42+00:00">2013-06-19 22:00</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/set-up-nfs-server-on-archlinux.html#disqus_thread" data-disqus-identifier="cache/posts/set-up-nfs-server-on-archlinux.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>The purpose of set up nfs server is to watch video stored on server through my android devices. </p>    <pre class="src src-sh">sudo pacman -S nfs-utils
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">donnot touch /etc/idmapd.conf</span>
<p>mkdir -p /srv/nfs4/z</p>
<p></p></pre>   <p> add following lines into /etc/fstab: </p>   <pre class="src src-conf"><span style="color: #e7c547;">UUID</span>=986C96596C9631CC /mnt/z ntfs-3g defaults,nofail 0 2
<p>/mnt/z /srv/nfs4/z none bind,nofail 0 0</p>
<p></p></pre>   <p> add this line into /etc/exports: </p>   <pre class="src src-conf"><span style="color: #e7c547;">/srv/nfs4/z</span> 192.168.0.0/24(async,rw,no_subtree_check,nohide,no_root_squash)
<p></p></pre>   <p> make sure change in /etc/exports to take effect: </p>   <pre class="src src-sh">sudo exportfs -ra
<p></p></pre>   <p> now enable and start the services: </p>   <pre class="src src-sh">sudo systemctl enable rpc-idmapd
<p>sudo systemctl start rpc-idmapd</p>
<p>sudo systemctl enable rpc-mountd</p>
<p>sudo systemctl start rpc-mountd</p>
<p></p></pre>  </div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/an-example-to-abuse-the-git-merge.html">An example to abuse the git merge</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-06-13T14:23:00+00:00">2013-06-13 14:23</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/an-example-to-abuse-the-git-merge.html#disqus_thread" data-disqus-identifier="cache/posts/an-example-to-abuse-the-git-merge.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/branch.html" rel="tag">branch</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/git.html" rel="tag">git</a></li>
           <li><a class="tag p-category" href="categories/merge.html" rel="tag">merge</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>WARNING, this is BAD practice. I'm showing you anti-pattern you'd better avoid. </p> <p> The work flow is simple at the beginning. There is only one master branch where several developers submit the code. </p> <p> Then come bad rules:  </p>
<ul>
<li>Rule 1, any feature should be done on new branch (this rule is actually good if without next three rules)  </li> <li>Rule 2, <code>git rebase</code> is forbidden and any minor branch created by developers should be publicized immediately.  </li> <li>Rule 3, keep using your same feature branch forever even it's behind master branch for a very long time.   </li> <li>Rule 4, <code>git merge</code> between feature and master branches frequently </li> </ul>
<p> After three months developement, this is the result of <code>git log –graph –oneline</code>: <img src="wp-content/uploads/2013/06/git-merge-mess-nq82.png" alt="image/git-merge-mess-nq8.png"></p> <p> Can you see the "M" at the top right corner. It's "M" from "Merge". </p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/use-vimdiff-to-resolve-git-merge-conflicts-effectively.html">Use vimdiff to resolve git/subversion/mercurial merge conflicts effectively</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-06-10T21:08:00+00:00">2013-06-10 21:08</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/use-vimdiff-to-resolve-git-merge-conflicts-effectively.html#disqus_thread" data-disqus-identifier="cache/posts/use-vimdiff-to-resolve-git-merge-conflicts-effectively.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/git.html" rel="tag">git</a></li>
           <li><a class="tag p-category" href="categories/merge.html" rel="tag">merge</a></li>
           <li><a class="tag p-category" href="categories/mergetool.html" rel="tag">mergetool</a></li>
           <li><a class="tag p-category" href="categories/vim.html" rel="tag">vim</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div id="outline-container-sec-1" class="outline-2">

<div class="outline-text-2" id="text-1">
<p>
You can jump to <a href="posts/use-vimdiff-to-resolve-git-merge-conflicts-effectively.html#Quick-start">1.5</a> section at the end of this article.
</p>

<p>
I use git as an example of version control software. But you can use any other version control software instead.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h4 id="sec-1-1">The reasons to use vimdiff to do the merge?</h4>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>It's free (vim)
</li>
<li>It works on any OS
</li>
<li>It works in shell
</li>
<li>Keyboard only
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h4 id="sec-1-2">Setup</h4>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-sec-1-2-1" class="outline-4">
<h5 id="sec-1-2-1">Setup vimdiff (OPTIONAL)</h5>
<div class="outline-text-4" id="text-1-2-1">
<p>
The vimdiff as a merge tool will display several buffers to show YOURS/THEIRS/ORIGINAL code.
</p>

<p>
First, add following code into your ~/.vimrc,
</p>
<div class="org-src-container">


<pre><code class="lang-vimrc">set laststatus=2 "show the status line
set statusline=%-10.3n  "buffer number
</code></pre>

</div>
<p>
The purpose of above two lines is to display buffer number at the status line of vim. It's OPTIONAL. You don't need see the buffer number if you are familiar with the all the buffer's position. The left top is buffer number 2. The middle top is buffer number 3. The right top is buffer number 4.
</p>

<p>
Second, if you know the buffer number, you can use hot key like ",2" (press comma first, then press two key as quickly as possible) to pull change from buffer number 2.
Add below code into your ~/.vimrc to set up hot keys:
</p>
<div class="org-src-container">


<pre><code class="lang-vimrc">map &lt;silent&gt; &lt;leader&gt;2 :diffget 2&lt;CR&gt;
map &lt;silent&gt; &lt;leader&gt;3 :diffget 3&lt;CR&gt;
map &lt;silent&gt; &lt;leader&gt;4 :diffget 4&lt;CR&gt;
</code></pre>

</div>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h5 id="sec-1-2-2">Setup git</h5>
<div class="outline-text-4" id="text-1-2-2">
<p>
Run below commands in shell,
</p>
<div class="org-src-container">


<pre><code class="lang-bash">git config --global merge.tool vimdiff
git config --global mergetool.prompt false
</code></pre>

</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h4 id="sec-1-3">Usage</h4>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-sec-1-3-1" class="outline-4">
<h5 id="sec-1-3-1">Create a "hello world" project</h5>
<div class="outline-text-4" id="text-1-3-1">
<p>
I setup a "hello world" project at <a href="https://github.com/redguardtoo/test-git-mergetool">https://github.com/redguardtoo/test-git-mergetool</a> for your practice.
</p>

<p>
It has three branches "master", "bob", and "chen",
</p>
<div class="org-src-container">


<pre><code class="lang-sh">git clone https://github.com/redguardtoo/test-git-mergetool.git
cd test-git-mergetool
git checkout -b bob origin/bob # create local mirror of bob branch
git checkout -b chen origin/chen # create local mirror of chen branch
</code></pre>

</div>

<p>
Bob and Chen has edited same files. So please merge branch "bob" into "master" at first. Then merge from "chen". The merge conflicts will be created.
</p>
<div class="org-src-container">


<pre><code class="lang-sh">git branch # double check that we got three local branches: master, bob, chen
git checkout master # set master branch as main branch
git merge bob #this is ok, because bob is the first one to merge changes
git merge chen # now some conflicts created because Bob has already edited and merged same files
</code></pre>

</div>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4">
<h5 id="sec-1-3-2">Resolve merge conflict</h5>
<div class="outline-text-4" id="text-1-3-2">
<p>
Now start merge tool,
</p>
<div class="org-src-container">


<pre><code class="lang-sh">git mergetool
</code></pre>

</div>

<p>
Git will invoke vimdiff with the following window layout. There are four buffers in this layout:
<img src="wp-content/git-merge-tool-nq8.png" alt="git-merge-tool-nq8.png"></p>

<p>
Here is the explanation of each buffer:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left">
<col class="left">
<col class="right">
</colgroup>
<thead><tr>
<th scope="col" class="left">Buffer</th>
<th scope="col" class="left">Explanation</th>
<th scope="col" class="right">Buffer Number</th>
</tr></thead>
<tbody>
<tr>
<td class="left">THEIRS (LOCAL)</td>
<td class="left">contents of the file on the current branch</td>
<td class="right">2</td>
</tr>
<tr>
<td class="left">BASE</td>
<td class="left">common base for the merge</td>
<td class="right">3</td>
</tr>
<tr>
<td class="left">YOURS (REMOTE)</td>
<td class="left">contents of the file to be merged.</td>
<td class="right">4</td>
</tr>
<tr>
<td class="left">MERGED</td>
<td class="left">The file containing the conflict markers. You need edit and commit this file.</td>
<td class="right">1</td>
</tr>
</tbody>
</table>
<p>
Some people name THEIRS and YOURS buffer to LOCAL and REMOTE buffer. That's fine because names are just names. The point is that the top middle buffer is the BASE one which contains the original code before Bob and Chen committing any code. And the bottom buffer is the mess which contains resolved/unresolved conflicts where you actual editing work happens.
</p>

<p>
You could press hot key =,2=,
Then you pick the content from THEIRS buffer (the top left buffer). It means you will use the Bob's code and discard Chen's code in MERGED buffer.
</p>

<p>
You could press hot key ",3",
Then you pick the content from BASE buffer (the top middle buffer). It means you will discard either Bob's code or Chen's code in MERGED buffer.
</p>

<p>
You could press hot key ",4",
Then you pick the content from YOURS buffer (the top right buffer). It means you will use Chen's code and discard Bob code in MERGED buffer.
</p>

<p>
Or you can edit the content directly in MERGED buffer. Anyway, git only care about the file binding to MERGED buffer. Any other buffer will be ignored by git.
</p>

<p>
You can use hot key <code>[c</code> and <code>]c</code> to navigate to previous/next conflict (including the conflict resolved by git automatically) in current file which is binding to MERGED buffer.
</p>

<p>
After finishing editing of the conflicting file in MERGED buffer, you can use hot key <code>:xa</code> to exit vimdiff. Git will open next conflicting file vimdiff automatically.
</p>

<p>
When you have resolved all the conflicts, follow the hint of git to commit your changes.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h4 id="sec-1-4">Tips</h4>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>fugitive.vim (<a href="https://github.com/tpope/vim-fugitive">https://github.com/tpope/vim-fugitive</a>) can do this too. Actually it can do much more git stuff than merge. I cannot write this article without reading its code
</li>
<li>You can use Emacs to do the similar job (<a href="http://stackoverflow.com/questions/1817370/using-ediff-as-git-mergetool">http://stackoverflow.com/questions/1817370/using-ediff-as-git-mergetool</a>). For me, Emacs start up time is too much for this task. Some people use <code>emacsclient</code> which has other overhead I don't like
</li>
<li>If you prefer GUI, use command line `git mergetool -t gvimdiff` instead
</li>
<li>The <code>:diffget</code> command is valid if and only if there are <b>MARKED</b> conflicts in merged buffer. If there is <b>NO</b> marked string like "&gt;&gt;&gt;&gt;" or "&lt;&lt;&lt;&lt;&lt;" around current change (you can jump to previous/next change by press <code>[c</code> or <code>]c</code>), it means the git have automatically resolved potential conflict for you. Reviewing is still wise because git is not as smart as human
</li>
<li>If you prefer navigating between the unresolved conflicts <b>only</b>, you can install Tim Pope's <a href="https://github.com/tpope/vim-unimpaired">vim-unimpaired</a> and use hot key "[n" and "]n" to do the navigation
</li>
<li>I map <code>[n</code> and <code>]n</code> to more handy hot keys:
</li>
</ul>
<div class="org-src-container">


<pre><code class="lang-vimrc">map ]] ]n
map [[ [n
</code></pre>

</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h4 id="sec-1-5"><a id="Quick-start" name="Quick-start"></a></h4>
<div class="outline-text-3" id="text-1-5">
<p>
You can use command line like "git mergetool -t vimdiff" to start vimdiff from git.
</p>

<p>
So the minimum set up is adding three lines of code into your ~/.vimrc:
</p>
<div class="org-src-container">


<pre><code class="lang-vimrc">map &lt;silent&gt; &lt;leader&gt;2 :diffget 2&lt;CR&gt; :diffupdate&lt;CR&gt;
map &lt;silent&gt; &lt;leader&gt;3 :diffget 3&lt;CR&gt; :diffupdate&lt;CR&gt;
map &lt;silent&gt; &lt;leader&gt;4 :diffget 4&lt;CR&gt; :diffupdate&lt;CR&gt;
</code></pre>

</div>

<p>
Then you can press hot key ",2" ",3" ",4" in vimdiff to pull change from top three buffer. The bottom buffer is for editing the code with markers which is actually your only work space.
</p>

<p>
":help vimdiff" for other hot keys.
</p>

<p>
#+image/git-merge-tool-nq8.png <img src="http://blog.binchen.org/wp-content/uploads/2013/06/wpid-git-merge-tool-nq8.png" alt="wpid-git-merge-tool-nq8.png"></p>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h4 id="sec-1-6">subversion/mercurial</h4>
<div class="outline-text-3" id="text-1-6">
<p>
Until now I'm focusing on how to tweak the vimdiff UI because the git has already setup the <a href="https://github.com/git/git/blob/master/mergetools/vimdiff">basic vimdiff layout for us</a>. So we just follow the Git layout in other VCS.
</p>
</div>
<div id="outline-container-sec-1-6-1" class="outline-4">
<h5 id="sec-1-6-1">subversion</h5>
<div class="outline-text-4" id="text-1-6-1">
<p>
Insert below code into ~/.subversion/config:
</p>
<div class="org-src-container">


<pre><code class="lang-conf">[helpers]
merge-tool-cmd = vimdiff.sh
</code></pre>

</div>

<p>
Content of vimdiff.sh
</p>
<div class="org-src-container">


<pre><code class="lang-bash">#!/bin/sh
#

# Step 1:
# When you get following options during svn merge command, select option 'l'. This is to launch external tool to resolve conflicts.
#
# Conflict discovered in 'main.h'.
# Select: (p) postpone, (df) diff-full, (e) edit,
#        (mc) mine-conflict, (tc) theirs-conflict,
#        (s) show all options: l

# Step 2: Now vim will be opened in diff mode with 3 files - mine, theirs and merged. Make the required changes in the merged file, and do save and exit (:xa).

# Step 3:
# Now below options will appear again, select 'r' (to accept the merged version) now.

BASE=${1}
LOCAL=${2}
REMOTE=${3}
MERGED=${4}
WCPATH=${5}

# copied from from git's vimdiff script
# @see https://github.com/git/git/blob/master/mergetools/vimdiff
vimdiff -f -d -c 'wincmd J' "$MERGED" "$LOCAL" "$BASE" "$REMOTE"
</code></pre>

</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h4 id="sec-1-7">mercurial</h4>
<div class="outline-text-3" id="text-1-7">
<p>
Insert below code into <code>~/.hgrc</code>:
</p>
<div class="org-src-container">


<pre><code class="lang-conf">[ui]
merge = vimdiff
[merge-tools]
vimdiff.executable = vim
vimdiff.args = -f -d -c 'wincmd J' "$output" "$local" "$base" "$other" +close +close
</code></pre>

</div>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/open-readme-under-git-root-directory-in-emacs.html">open README under git root directory in Emacs</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-06-08T14:40:00+00:00">2013-06-08 14:40</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/open-readme-under-git-root-directory-in-emacs.html#disqus_thread" data-disqus-identifier="cache/posts/open-readme-under-git-root-directory-in-emacs.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/git.html" rel="tag">git</a></li>
           <li><a class="tag p-category" href="categories/github.html" rel="tag">github</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>I often need update my README files at the root directory of my project which is always managed by git. </p> <p> As a lazy guy, I' rather use some hotkey to open that README. </p> <p> So if you add below elisp code into your ~/ .emacs, you can use hot key <code>C-c C-f</code> to open the README: </p>    <pre class="src src-elisp">(<span style="color: #b5bd68;">defun</span> <span style="color: #81a2be;">open-readme-in-git-root-directory</span> ()
  (interactive)
  (<span style="color: #b5bd68;">let</span> (filename
        (root-dir (locate-dominating-file (file-name-as-directory (file-name-directory buffer-file-name)) <span style="color: #8abeb7;">".git"</span>))
        )
    <span style="color: #969896; font-style: italic;">;; </span><span style="color: #969896; font-style: italic;">(message "root-dir=%s" root-dir)</span>
    (and root-dir (file-name-as-directory root-dir))
    (setq filename (concat root-dir <span style="color: #8abeb7;">"README.org"</span>))
    (<span style="color: #b5bd68;">if</span> (not (file-exists-p filename))
        (setq filename (concat root-dir <span style="color: #8abeb7;">"README.md"</span>))
      )
    <span style="color: #969896; font-style: italic;">;; </span><span style="color: #969896; font-style: italic;">(message "filename=%s" filename)</span>
    (<span style="color: #b5bd68;">if</span> (file-exists-p filename)
        (switch-to-buffer (find-file-noselect filename nil nil))
      (message <span style="color: #8abeb7;">"NO README.org or README.md found!"</span>))
    ))
(global-set-key (kbd <span style="color: #8abeb7;">"C-c C-f"</span>) 'open-readme-in-git-root-directory)
<p></p></pre>  <p> ,,,, </p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/i-became-a-true-emacs-geek-when-i-publicized-my-emacs-d-at-github-com.html">How to measure a Emacs geek</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-05-31T19:40:00+00:00">2013-05-31 19:40</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/i-became-a-true-emacs-geek-when-i-publicized-my-emacs-d-at-github-com.html#disqus_thread" data-disqus-identifier="cache/posts/i-became-a-true-emacs-geek-when-i-publicized-my-emacs-d-at-github-com.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/git.html" rel="tag">git</a></li>
           <li><a class="tag p-category" href="categories/github.html" rel="tag">github</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>Me, for example. </p> <p> The first day I changed my .emacs.d: </p>   <pre class="example">master $ git log --pretty=format:'%C(yellow)%h%Creset %ad %s %Cred(%an)%Creset' --date=short|grep "<code>git config user.name</code>"|tail -n1
11fd85f 2011-08-31 eim (Chinese input method) (chen bin)
<p></p></pre>   <p> How many times I modified my emacs.d since then: </p>   <pre class="example">master $ git log --pretty=format:'%C(yellow)%h%Creset %ad %s %Cred(%an)%Creset' --date=short|grep "<code>git config user.name</code>"|wc -l
<p>672</p>
<p></p></pre>   <p> My emacs.d at github: <a href="https://github.com/redguardtoo/emacs.d">https://github.com/redguardtoo/emacs.d</a> </p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/the-reliable-way-to-access-system-clipboard-from-emacs.html">The reliable way to access system clipboard from Emacs</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-05-31T09:25:00+00:00">2013-05-31 09:25</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/the-reliable-way-to-access-system-clipboard-from-emacs.html#disqus_thread" data-disqus-identifier="cache/posts/the-reliable-way-to-access-system-clipboard-from-emacs.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/clipboard.html" rel="tag">clipboard</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
reliable way to access system clipboard from Emacs                        :emacs:en:linux:clipboard:
</p>

<p>
CREATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2013-05-31&gt;</span></span>
</p>

<p>
UPDATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2015-11-20 Fri&gt;</span></span>
</p>

<p>
The <a href="http://emacs.stackexchange.com/search?q=clipboard">Emacs clipboard questions</a> has been asked so many times. Yet few give a complete and reliable solution. 
</p>

<p>
Only a dedicated project maintained by professional developer could solve this issue once for all.
</p>

<p>
<a href="https://github.com/rolandwalker/simpleclip">simpleclip</a> is such a project.
</p>

<p>
I only use its APIs `simpleclip-get-contents` and `simpleclip-set-contents`.
</p>

<p>
Here is my setup:
</p>

<div class="org-src-container">

<pre><code class="lang-lisp">(require 'simpleclip)
(defun copy-to-x-clipboard ()
  (interactive)
  (let ((thing (if (region-active-p)
                   (buffer-substring-no-properties (region-beginning) (region-end))
                 (thing-at-point 'symbol))))
    (simpleclip-set-contents thing)
    (message "thing =&gt; clipboard!")))

(defun paste-from-x-clipboard()
  "Paste string clipboard"
  (interactive)
  (insert (simpleclip-get-contents)))

;; Press `Alt-Y' to paste from clibpoard when in minibuffer
(defun my/paste-in-minibuffer ()
  (local-set-key (kbd "M-y") 'paste-from-x-clipboard))
(add-hook 'minibuffer-setup-hook 'my/paste-in-minibuffer)
</code></pre>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/how-to-refactorrename-a-variable-name-in-a-function-efficiently.html">How to refactor/rename a variable name in a function efficiently</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-05-23T21:05:00+00:00">2013-05-23 21:05</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/how-to-refactorrename-a-variable-name-in-a-function-efficiently.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-refactorrename-a-variable-name-in-a-function-efficiently.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/evil.html" rel="tag">evil</a></li>
           <li><a class="tag p-category" href="categories/programming.html" rel="tag">programming</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>As we dicussed in <a href="https://plus.google.com/110954683162859211810/posts/TgnyDRqBWkb">Emacs community at Google+</a>. Although <a href="https://github.com/magnars/multiple-cursors.el">multiple-cursor</a> is good for this task, I cannot use it because it conflicts with my favourite <a href="http://www.emacswiki.org/emacs/Evil">evil-mode</a> (Vim simulation in Emacs). </p> <p> There is another emacs plugin called <a href="https://github.com/victorhge/iedit">iedit</a> which could do the similar job (I usually use its command called iedit-mode-toggle-on-function) </p> <p> Though iedit is good, there is still room for improvement. When using iedit-mode-toggle-on-function, we need press key twice to rename the variable name. Once to enable it, twice to disable it. </p> <p> Magnar Sveen pointed out in the G+ discussion that the key point we need plugins like multiple-cursor or iedit-mode is that we can see all the changes while doing the editing. </p> <p> This reminds me that evil-mode has a excellent regex string replacing mode which also show the changes when you are typing EACH character of new string. </p> <p> So by using evil-mode's default regex replacing command, I can implement similar feature even more efficiently then iedit-mode! </p> <p> Here is my elisp code: </p>   <pre class="src src-elisp">(<span style="color: #b9ca4a;">defun</span> <span style="color: #7aa6da;">evilcvn-change-symbol-in-defun</span> ()
  <span style="color: #c397d8;">"mark the region in defun (definition of function) and use string replacing UI in evil-mode</span>
<span style="color: #c397d8;">to replace the symbol under cursor"</span>
  (interactive)
  (<span style="color: #b9ca4a;">let</span> ((old (thing-at-point 'symbol)))
    (mark-defun)
    (<span style="color: #b9ca4a;">unless</span> (evil-visual-state-p)
      (evil-visual-state))
    (evil-ex (concat <span style="color: #70c0b1;">"'&lt;,'&gt;s/"</span> (<span style="color: #b9ca4a;">if</span> (= 0 (length old)) <span style="color: #70c0b1;">""</span> <span style="color: #70c0b1;">"\&lt;</span><span style="color: #e7c547; font-weight: bold;">\</span><span style="color: #c397d8; font-weight: bold;">(</span><span style="color: #70c0b1;">"</span>) old (<span style="color: #b9ca4a;">if</span> (= 0 (length old)) <span style="color: #70c0b1;">""</span> <span style="color: #70c0b1;">"</span><span style="color: #e7c547; font-weight: bold;">\</span><span style="color: #c397d8; font-weight: bold;">)</span><span style="color: #70c0b1;">\&gt;/"</span>))))
  )
(global-set-key (kbd <span style="color: #70c0b1;">"C-c ; s"</span>) 'evilcvn-change-symbol-in-defun)
<p></p></pre>   <p> Put you cursor above a symbol/variable and press hot key "Ctrl-c ; s", then the regex to replace that symbol is automatically created and inserted into mini-buffer. Now you only need type new string and watch. </p> <p> This is the screen shot (I renamed variable "count" into "cnt" in C++ function hello): <img src="wp-content/uploads/2013/05/wpid-evil-regex-replace-nq8.png" alt="image/evil-regex-replace-nq8.png"></p>
</div>
            </div>
        </div>
    
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-10.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-8.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="chenbin0";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2017         <a href="mailto:chenbin.sh@gmail.com">Chen Bin</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
         document.addEventListener('DOMContentLoaded', function() {
           var items = document.getElementsByClassName('timeago'), e, pd;
           for (var i = 0; i < items.length; i++) {
             e = items[i];
             pd = moment(new Date(e.getAttribute('datetime')));
             e.innerHTML = pd.fromNow();
             e.setAttribute('title', pd.format('LLLL'));
           }
         });
        </script>
</body>
</html>
