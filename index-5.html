<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Linux, Programming, Emacs">
<meta name="viewport" content="width=device-width">
<title>Chen's blog (old posts, page 5) | Chen's blog</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://blog.binchen.org/index-5.html">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <section class="social"><ul>
<li><a href="index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="stories/about.html" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://twitter.com/chen_bin" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/redguardtoo" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
            
        <div class="post">
            <h1 class="title"><a href="posts/python-code-to-migrate-the-mysql-database-enmysqldatabasepython.html">python code to migrate the MySQL database</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-08-22T12:08:00+00:00">2012-08-22 12:08</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/python-code-to-migrate-the-mysql-database-enmysqldatabasepython.html#disqus_thread" data-disqus-identifier="cache/posts/python-code-to-migrate-the-mysql-database-enmysqldatabasepython.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/database.html" rel="tag">database</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/mysql.html" rel="tag">mysql</a></li>
           <li><a class="tag p-category" href="categories/python.html" rel="tag">python</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
code to migrate the MySQL database                                     :en:mysql:database:python:
</p>

<p>
The script reads configuration and requires python 2.4.
</p>

<div class="org-src-container">

<pre><code class="lang-python">#!/usr/bin/python
import sys
import os
import string
import time
import datetime
import getopt

#############
# CONFIG
#############
DB_NAME='mydb'
DB_PASSWORD='111111'
DB_USER='root'
DB_HOST='mylinux0'
SQL_DB_SCHEMA=os.path.abspath("db_schema.sql")
SQL_CREATE_TABLE=os.path.abspath("000.sql")
CLONE_TABLES=['MyJobs','MyUsers']

#############
# GLOBALS
#############
backup_db=False
migration=False
config=None
verbose=False
delete=False
remote=False

def sql_cmd(cmd):
    if remote:
        return 'mysql -h %s -u %s -p%s -e " %s " %s' % (DB_HOST,DB_USER,DB_PASSWORD,cmd,DB_NAME)
    return 'mysql -u %s -p%s -e " %s " %s' % (DB_USER,DB_PASSWORD,cmd,DB_NAME)

def sql_script(script):
    if remote:
        return 'mysql -h %s -u %s -p%s %s &lt; %s' % (DB_HOST,DB_USER,DB_PASSWORD,DB_NAME,script)
    return 'mysql -u %s -p%s %s &lt; %s' % (DB_USER,DB_PASSWORD,DB_NAME,script)


def make_sql_to_create_table():
    s=open(SQL_DB_SCHEMA).read()
    for t in CLONE_TABLES:
        s=s.replace(t,t+'2')
    open(SQL_CREATE_TABLE,'w').write(s)

def backup_database():
    fname="%s-%s.dump.gz" % (DB_NAME,time.strftime('%Y%m%d%H%M%S', time.gmtime()))
    if remote:
        cmd="mysqldump -h %s -u %s -p%s --compact %s|gzip -9 &gt; %s" % (DB_HOST,DB_USER,DB_PASSWORD,DB_NAME,fname)
    else:
        cmd="mysqldump -u %s -p%s --compact %s|gzip -9 &gt; %s" % (DB_USER,DB_PASSWORD,DB_NAME,fname)

    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

def delete_db_records():
    cmd=sql_cmd("delete from sources;delete from cameras;")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

def package():
    cmd="tar zcvf migrate-db.tar.gz *.sql migrate.py .migrate_*"
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

def read_config(config):
    global DB_NAME
    global DB_PASSWORD
    global DB_USER
    global DB_HOST
    f=open(config,"r")
    for line in f:
        a=line.split("=")
        if len(a)!=2:
            continue
        n=a[0].strip()
        v=a[1].strip()
        if n=="DB_NAME":
            DB_NAME=v
        elif n=="DB_PASSWORD":
            DB_PASSWORD=v
        elif n=="DB_USER":
            DB_USER=v
        elif n=="DB_HOST":
            DB_HOST=v

def usage():
    print '''
USAGE: python migrate.py [OPTIONS]

OPTIONS:
    -h, --help
        print this help

    -b, --backup-database
        backup the old database before migration (recommended)

    -m, --migrate
        donot start migration

    -v, --verbose
        print database related information

    -p, --package
        packge all the scripts into migrate-db.tar.gz

    -d, --delete-db-records
        delete database records so we can restart migration

    -c, --config

SAMPLES:
    python migrate.py -b                        #back database and exit
    python migrate.py -m                        #start migration right now
    python migrate.py -b -m                     #backup the database and start the migration (recommended)
    python migrate.py -v                        #print database information and exit
    python migrate.py -c .migrate_staging -v    #print staging database information and exit
'''

def show_info():
    print '''
==Database Information
name:{name}
password:{password}
user:{user}
host:{host}
'''.format(name=DB_NAME, password=DB_PASSWORD,user=DB_USER,host=DB_HOST)

def confirm(prompt=None, resp=False):
    """prompts for yes or no response from the user. Returns True for yes and
    False for no.

    'resp' should be set to the default value assumed by the caller when
    user simply types ENTER.

    &gt;&gt;&gt; confirm(prompt='Create Directory?', resp=True)
    Create Directory? [y]|n:
    True
    &gt;&gt;&gt; confirm(prompt='Create Directory?', resp=False)
    Create Directory? [n]|y:
    False
    &gt;&gt;&gt; confirm(prompt='Create Directory?', resp=False)
    Create Directory? [n]|y: y
    True

    """

    if prompt is None:
        prompt = 'WARNING: DONOT run me twice and migration CANNOT be rolled back, GO?'

    if resp:
        prompt = '%s [%s]|%s: ' % (prompt, 'y', 'n')
    else:
        prompt = '%s [%s]|%s: ' % (prompt, 'n', 'y')

    while True:
        ans = raw_input(prompt)
        if not ans:
            return resp
        if ans not in ['y', 'Y', 'n', 'N']:
            print 'please enter y or n.'
            continue
        if ans == 'y' or ans == 'Y':
            return True
        if ans == 'n' or ans == 'N':
            return False

if __name__=="__main__":
    '''
    @see http://linux.byexamples.com/archives/366/python-how-to-run-a-command-line-within-python/
    '''
    try:
        opts, args = getopt.getopt(sys.argv[1:], "hbmvpdc:r", ["help", "backup-database","--migrate","--verbose","--package","--delete-db-records","--config=","--remote"])
    except getopt.GetoptError, err:
        print str(err) # will print something like "option -a not recognized"
        usage()
        exit(2)

    if len(opts)==0:
        usage()
        exit(2)

    for o, a in opts:
        if o in ("-h", "--help"):
            usage()
            sys.exit()
        elif o in ("-v", "--verbose"):
            verbose=True
        elif o in ("-c", "--config"):
            config=a
            print config
        elif o in ("-d", "--delete-db-records"):
            delete=True
        elif o in ("-p", "--package"):
            package()
            exit(0)
        elif o in ("-b", "--backup-database"):
            backup_db=True
        elif o in ("-m", "--migrate"):
            migration=True
        elif o in ("-r", "--remote"):
            remote=True
        else:
            assert False, "unhandled option"

    if config!=None:
        read_config(config)

    if delete:
        delete_db_records()
        sys.exit()

    if verbose:
        show_info()
        sys.exit()

    if backup_db:
        backup_database()

    if migration==False:
        exit(0)

    if confirm()==False:
        print "Aborting ..."
        exit(0)

    make_sql_to_create_table()

    print "==START MIGRATION"

    # test data base connection
    cmd=sql_cmd('show databases;use %s;' % (DB_NAME))
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    cmd=sql_script("000.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    os.system(sql_cmd("insert into migrate (Action) values ('001.sql')"))
    cmd=sql_script("001.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    os.system(sql_cmd("insert into migrate (Action) values ('002.sql')"))
    cmd=sql_script("002.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    os.system(sql_cmd("insert into migrate (Action) values ('003.sql')"))
    cmd=sql_script("003.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    os.system(sql_cmd("insert into migrate (Action) values ('004.sql')"))
    cmd=sql_script("004.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    os.system(sql_cmd("insert into migrate (Action) values ('005.sql')"))
    cmd=sql_script("005.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    os.system(sql_cmd("insert into migrate (Action) values ('006.sql')"))
    cmd=sql_script("006.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    os.system(sql_cmd("insert into migrate (Action) values ('100.sql')"))
    cmd=sql_script("100.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    cmd=sql_script("insert_sample_sources.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    cmd=sql_script("app_config.sql")
    print "==WILL RUN [ %s ]" % (cmd)
    os.system(cmd)
    print "==DONE"

    print "==END MIGRATION"
# vim: set expandtab tabstop=4 shiftwidth=4:
</code></pre>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/emacs-zhong-de-zi-dong-wan-chen-wan-quan-zhi-nan.html">Emacs中的自动完成(Auto Completion)完全指南</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-08-21T14:50:00+00:00">2012-08-21 14:50</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/emacs-zhong-de-zi-dong-wan-chen-wan-quan-zhi-nan.html#disqus_thread" data-disqus-identifier="cache/posts/emacs-zhong-de-zi-dong-wan-chen-wan-quan-zhi-nan.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/completion.html" rel="tag">completion</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/intellisense.html" rel="tag">intellisense</a></li>
           <li><a class="tag p-category" href="categories/zh.html" rel="tag">zh</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
Completion)完全指南                                    :zh:emacs:completion:intellisense:
</p>

<p>
作者: 陈斌(redguardtoo)
</p>

<p>
更新时间: <span class="timestamp-wrapper"><span class="timestamp">&lt;2017-04-05 Wed&gt;</span></span>
</p>

<p>
原创时间: <span class="timestamp-wrapper"><span class="timestamp">&lt;2012-08-21 Tue&gt;</span></span>
</p>

<p>
Emacs比普通IDE的Intellisense强大,例如可输入当前文件名(带或者不带文件名后缀都可以).
</p>

<p>
我不是来赞美Emacs的强大的,我是来吐槽的.自动完成框架太多,功能重叠,让人困扰.
</p>

<p>
所以本文目的有两个:
</p>

<ul class="org-ul">
<li>说明哪些框架流行
</li>
<li>如何使用框架
</li>
</ul>
<div id="outline-container-sec-1" class="outline-2">

<div class="outline-text-2" id="text-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left">
<col class="left">
<col class="left">
</colgroup>
<thead><tr>
<th scope="col" class="left">函数/插件名</th>
<th scope="col" class="left">快捷键</th>
<th scope="col" class="left">使用频率</th>
</tr></thead>
<tbody>
<tr>
<td class="left">company-mode (结合clang)</td>
<td class="left">不需要 (也可启用TAB)</td>
<td class="left">高</td>
</tr>
<tr>
<td class="left">hippie-expand</td>
<td class="left">M-/</td>
<td class="left">高</td>
</tr>
<tr>
<td class="left">evil-mode</td>
<td class="left">C-n/C-p(完成词),C-x C-n/p(完成行)</td>
<td class="left">高</td>
</tr>
<tr>
<td class="left">auto-complete (结合clang)</td>
<td class="left">TAB</td>
<td class="left">低</td>
</tr>
<tr>
<td class="left">complete-symbol</td>
<td class="left">C-M-i</td>
<td class="left">低</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">auto-complete结合clang</h3>
<div class="outline-text-2" id="text-2">
<p>
<a href="http://emacswiki.org/emacs/AutoComplete">auto-complete</a>是第三方开发的插件,提供了自动完成需要的支持(例如在命令行环境下对下拉菜单的模拟).
</p>

<p>
而<a href="http://clang.llvm.org">clang</a>是苹果公司C/C++/Objective-C编译器,对C++语法的解析很好.
</p>

<p>
显然,这种l案只适用于 <code>Clang</code> 支持的语言.
</p>

<p>
需要通过<a href="http://emacswiki.org/wiki/ELPA">elpa(Emacs的AppStore)</a>安装第三方插件 <code>auto-complete</code> 和<a href="https://github.com/brianjcj/auto-complete-clang">auto-complete-clang</a>.
</p>

<p>
具体配置请参考我的<a href="https://github.com/redguardtoo/emacs.d/blob/903aeb10c316c0f43b35bc0dc6101eea3f729da7/init-auto-complete.el">init-auto-complete.el</a>.
</p>

<p>
已被company-mode取代,不推荐.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">company-mode</h3>
<div class="outline-text-2" id="text-3">
<p>
<a href="https://github.com/company-mode/company-mode">company-mode</a>和auto-complete功能类似，唯一的区别是clang以及其他语言支持已内置，所以不需要安装其他elisp插件或者额外配置.目前我已用company-mode代替了auto-complete.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h3 id="sec-4">hippie-expand</h3>
<div class="outline-text-2" id="text-4">
<p>
<a href="http://emacswiki.org/emacs/HippieExpand">hippie-expand</a>是Emacs自带的自动完成框架.
</p>

<p>
其默认的一些特色功能(例如,完成词/文件名/行的功能,或在 <code>minibuffer</code> 中使用)可作为 <code>company-mode</code> 补充.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h3 id="sec-5">complete-symbol</h3>
<div class="outline-text-2" id="text-5">
<p>
Emacs自带的一个函数,我对这个方案感觉一般,因为在Emacs23中,它默认仅仅调用了后台的ctags而已.
</p>

<p>
<code>hippie-expand</code> 经过调教也可用 <code>Ctags</code>,且默认特色功能比 <code>complete-symbol</code> 多,所以我没兴趣配置第三个自动完成框架了.
</p>

<p>
通过阅读Emacs24的ChangeLog,我发现 <code>complete-symbol</code> 经过配置后可以用 <code>semantic</code> 作为语法解析后端(Emacs23.4也支持,不明白为什么把该特性放在Emacs24的ChangeLog介绍).
</p>

<p>
<a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Semantic.html">semantic</a>是lisp写的语法解析器,Emacs自带,智能程度介于ctags和clang之间,解析速度比较慢,如果机器配置较差会很卡.
</p>

<p>
我不喜欢这个语法解析器,过去在 <code>Semantic</code> 尚是<a href="http://cedet.sourceforge.net">Cedet</a>的一个组件时,我折腾过 <code>Cedet</code>,当时感觉速度慢,配置繁琐,不稳定.
</p>

<p>
<code>Semantic</code> 支持多种语言,如C++/Java.
</p>

<p>
配置请参考我的<a href="https://github.com/redguardtoo/emacs.d/blob/903aeb10c316c0f43b35bc0dc6101eea3f729da7/init-semantic.el">init-semantic.el</a>(注意,我不用 <code>Semantic</code>,所以相应代码被注释了.你可取消注释).
</p>

<p>
已被 <code>company-mode</code> 取代,不推荐.
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h3 id="sec-6">evil-mode</h3>
<div class="outline-text-2" id="text-6">
<p>
<a href="http://emacswiki.org/emacs/Evil">Evil-mode</a>把Emacs模拟成了Vim,是我最喜欢的第三方插件,其自动完成很简单,就是根据当前文件内容自动完成词或行.
</p>

<p>
值得推荐是因为我也是重度Vim用户,Vim的快捷键已成为我本能了.
</p>

<p>
无需配置,启动 <code>evil-mode</code> 即可,参见我的<a href="https://github.com/redguardtoo/emacs.d/blob/master/init-evil.el">init-evil.el</a>.
</p>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h3 id="sec-7">其他</h3>
<div class="outline-text-2" id="text-7">
<p>
我的一个想法. 类似于Evil的完成行.但是可以扫瞄指定目录中所有的文件,列出相似的行.
</p>

<p>
优点在于:
</p>
<ul class="org-ul">
<li>匹配可以更加宽容一点
</li>
<li>使用目前最快的grep工具如<a href="https://github.com/BurntSushi/ripgrep">ripgrep</a>扫瞄文本
</li>
</ul>
<p>
实现见<a href="https://github.com/redguardtoo/emacs.d/blob/24dd0d7/lisp/init-ivy.el">init-ivy</a>中的=counsel-complete-line-by-grep=.
</p>

<p>
试用好几个月了,非常好用.
</p>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h3 id="sec-8">小结</h3>
<div class="outline-text-2" id="text-8">
<p>
自动完成包括前端用户界面和后端语法解析引擎两个部分.
</p>

<p>
作为前端的用户界面, <code>company-mode</code> 和 <code>auto-complete</code> 相当成熟.
</p>

<p>
后端 <code>Clang</code> 最优秀.
</p>

<p>
<code>Ctags</code> 谈不上语法解析,只是正则表达式罢了,但是因此才能通吃所有语言.
</p>

<p>
<code>Semantic</code> 支持的语言比 <code>Clang</code> 多一点,性能和稳定性比较差.
</p>

<p>
作为一个C++程序员,我过去用 <code>auto-complete</code> 加上 <code>Clang</code>,现在用 <code>company-mode</code> 加 <code>Clang</code>.
</p>

<p>
脚本语言(Ruby/Python/Javascript)用 <code>Ctags</code> 加 <code>company-mode</code> 自带的 <code>company-etags</code>.
</p>

<p>
基于框架自己发明新技术会更好用.</p>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/my-git-alias-in-bashrc.html">My git alias in .bashrc</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-07-20T17:22:00+00:00">2012-07-20 17:22</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/my-git-alias-in-bashrc.html#disqus_thread" data-disqus-identifier="cache/posts/my-git-alias-in-bashrc.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/bash.html" rel="tag">bash</a></li>
           <li><a class="tag p-category" href="categories/control.html" rel="tag">control</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/git.html" rel="tag">git</a></li>
           <li><a class="tag p-category" href="categories/version.html" rel="tag">version</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
git alias in .bashrc                                                       :en:git:version:control:bash:
</p>

<p>
CREATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2012-12-26&gt;</span></span>
</p>

<p>
UPDATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2017-11-02&gt;</span></span>
</p>

<p>
My favorite alias are <code>g</code>, <code>gau</code>, <code>gc</code>, <code>gt</code>, <code>gl</code>,and  <code>gdc</code>.
</p>

<div class="org-src-container">

<pre><code class="lang-sh"># {{ git
# Git alias
function gitshortlogcmd () {
    git log --date=short --decorate --graph "$@"
}
function gitlogcmd () {
    git log --date=short --decorate --graph --pretty=format:'%C(yellow)%h%Creset%C(green)%d%Creset %ad %s %Cred(%an)%Creset' "$@"
}
alias g="git status --short -b"
alias gb="git branch"
alias gn="git status --untracked-files=no --short -b"
alias gfl="git diff-tree --no-commit-id --name-only -r"
alias ga="git add"
alias gr="git rebase -i `git remote`/`git symbolic-ref --short HEAD`"
alias gap='git add --patch'
alias gai='git add -i'
alias gau="git add -u"
alias gc="git commit -m"
alias gca="git commit --amend"
alias gja="git --no-pager commit --amend --reuse-message=HEAD" # git just amend
alias gt="git stash"
alias gta="git stash apply"
alias gmt="git mergetool"
alias gl="gitlogcmd"
alias glp="gitlogcmd -p"
alias gls="gitlogcmd --stat"
alias gnb="git checkout -b"
alias gss="git show --stat"
alias gsl="git log --pretty=format:'%h %s (%an)' --date=short -n1 | pclip"
alias gd="git diff"
alias gds="git diff --stat"
alias gdc="git diff --cached"
alias gdcs="git diff --cached --stat"
alias gps="git push"
alias gpf="git push --force"
alias gpl="git pull"
alias gpr="git pull -r"
alias cg='cd $(git rev-parse --show-toplevel)' #goto root dir
alias ghe='git diff --name-only --diff-filter=U|grep "\.html\|\.min\.js"|xargs -I{} sh -c "git checkout --theirs {} &amp;&amp; git add {}"'
alias gme='git diff --name-only --diff-filter=U|grep "\.html\|\.min\.js"|xargs -I{} sh -c "git checkout --our {} &amp;&amp; git add {}"'
# delete selected local branch
alias gdd='git branch -D $(git branch | sed "s/[\* ]\+//g" | ~/bin/percol.py)'
# show diff from the branch to current HEAD
alias gdp='git diff $(git branch | sed "s/[\* ]\+//g" | ~/bin/percol.py)..HEAD'
alias grh='git reset --hard HEAD'
alias gr1='git reset --hard HEAD^'
alias gr2='git reset --hard HEAD^^'
alias gs="git show"

function gsh {
    git log --date=short --pretty=format:'%h%d %ad %s (%an)' | python ~/bin/percol.py | awk '{print $1}' | xargs -i git show {}
}

function gcn()
{
    # commit with timestamp
    local d=`date +%m%d-%H%M%S`
    git add -u . &amp;&amp; git commit -m ${d}
}

# find full path of file who under git controll
# the optional parameter is the keyword
function gf()
{
    if [ -z "$1" ]; then
        local cli=`git ls-tree -r HEAD --name-status | python ~/bin/percol.py`
    else
        local cli=`git ls-tree -r HEAD --name-status | grep "$1" | python ~/bin/percol.py`
    fi
    local rlt=$(cd $(dirname $cli); pwd)/$(basename $cli)
    echo ${rlt}
    echo -n ${rlt} | pclip
}

function glwho () {
    local guy=`git shortlog -sn | ~/bin/percol.py | sed 's/^\s*[0-9]\+\s*//g'`
    # space is a problem, so we can't use gitshortlogcmd here
    gitshortlogcmd --pretty=format:'%C(yellow)%h%Creset%C(green)%d%Creset %ad %s %Cred(%an)%Creset' --author="$guy" "$@"
}

function gfp ()  {
    if [ -z "$1" ]; then
        echo "Usage: gfp since [file]"
        echo "  Just alias of 'git format-patch -n --stdout since -- [file]'"
        echo "  'gfp since | git am' to apply the patch"
    fi
    git format-patch -n --stdout $1 -- $2
}

function gcnb () {
    local remoteb=$(git branch --all | sed '/no branch/d' | ~/bin/percol.py)
    local localb=$(echo $remoteb | sed 's/^ *remotes\/[a-z]*\///g')
    git checkout -b $localb $remoteb
}
function grb () {
    # switch to recent git branch or just another branch

    local crtb=`git branch | grep \*`
    local ptn="no branch"
    # compatible way to detect sub-strin in bash
    # @see http://stackoverflow.com/questions/229551/string-contains-in-bash
    if [ -z "${crtb##*$ptn*}" ]; then
        # detached HEAD
        git checkout $(git branch | sed '/no branch/d' | ~/bin/percol.py)
    else
        local myrbs=`git for-each-ref --sort=-committerdate refs/heads/ | sed -e s%.*refs\/heads\/%%g`
        local crb=`git symbolic-ref --short HEAD`
        git checkout `echo "$myrbs" | sed '/$crb/d' | ~/bin/percol.py`
    fi
}

# rebase on LOCAL branches
function gri () {
    local b=`git branch | sed 's/[\* ]\+//g' | ~/bin/percol.py`
    git rebase -i ${b}
}

# rebase on ALL braches
function gra () {
    local b=`git branch --all | sed 's/[\* ]\+//g' | sed 's/remotes\///g' | ~/bin/percol.py`
    git rebase -i ${b}
}

# select a local git branch
function gsb () {
    local b=`git branch | sed "s/[\* ]\+//g" | ~/bin/percol.py`
    echo -n ${b} | pclip;
    echo ${b}
}

# print current branch name
function gcb () {
    local crb=`git symbolic-ref --short HEAD`
    echo -n ${crb} | pclip;
    echo ${crb}
}

# new local branch based on remote branch
function gnr () {
    local myrb=`git for-each-ref --sort=-committerdate refs/remotes/ | sed -e s%.*refs\/remotes\/%%g | ~/bin/percol.py`
    local mylb=`echo -n $myrb | sed 's/.*\/\([^\/]\+\)$/\1/'`
    git checkout -b $mylb $myrb
}

function gchk () {
    if [ -z "$1" ]; then
        echo "Usage: gchk commit_id"
        echo "reset hard certain version of current working directory"
    else
        rm -rf $PWD/*
        git checkout $1 -- $PWD
    fi
}

function git2fullpath {
    local fullpath=$(git rev-parse --show-toplevel)/$1
    echo -n $fullpath | pclip
    echo $fullpath
}

function glf () {
    local str=`git --no-pager log --oneline --name-only $* |  ~/bin/percol.py`
    git2fullpath $str
}


function gsf () {
    local str=`git --no-pager show --pretty=format:'%h %s (%an)' --name-only $* |  ~/bin/percol.py`
    git2fullpath $str
}

function gdf () {
    local str=`git --no-pager diff --oneline --name-only $*| ~/bin/percol.py`
    git2fullpath $str
}

function gdcf () {
    local str=`git --no-pager diff --oneline --cached --name-only $* |  ~/bin/percol.py`
    git2fullpath $str
}

function ggr () {
  if [ -z "$1" ]; then
      echo "Grep files under git controll"
      echo "Usage: ggr [filename-pattern] text-pattern"
  elif [ $# -eq "1" ]; then
      git ls-tree -r HEAD --name-only |  xargs grep -sn "$1"
  elif [ $# -eq "2" ]; then
      git ls-tree -r HEAD --name-only | grep "$1" | xargs grep -sn --color -E "$2"
  fi
}

function grpc() {
  if [ -z "$1" ]; then
      echo "Replace the content of file in latest git commit"
      echo "Usage: grpc [commit-hash] old_string new_string (string could be perl regex)"
  elif [ $# -eq "2" ]; then
      git diff-tree --no-commit-id --name-only -r HEAD | xargs perl -pi -e "s/$1/$2/g"
  elif [ $# -eq "3" ]; then
      git diff-tree --no-commit-id --name-only -r $1 | xargs perl -pi -e "s/$2/$3/g"
  fi
}

function grpf() {
  if [ -z "$1" ]; then
      echo "Replace the content of file under git"
      echo "Usage: grpf old_string new_string (string could be perl regex)"
  elif [ $# -eq "2" ]; then
      git grep -l "$1" | xargs perl -pi -e "s/$1/$2/g"
  fi
}

function gp() {
    if [ $# = 0 ]; then
        local from=`gitshortlogcmd --pretty=format:'%h %ad %s (%an)' $* | ~/bin/percol.py|sed -e"s/^[ *|]*\([a-z0-9]*\) .*$/\1/"`;
        local fn=from-$from-`date +%Y%m%d-%H%M`.patch
        git format-patch -n --stdout $from &gt; $fn &amp;&amp; ls $fn
    else
        local fn=from-$1-`date +%Y%m%d-%H%M`.patch
        git format-patch -n --stdout $1 &gt; $fn &amp;&amp; ls $fn
    fi;
}
# }}
</code></pre>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/emacs-zhong-de-wan-mei-duo-chuang-kou-cao-zuo.html">Emacs中的完美多窗口操作</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-07-20T14:56:00+00:00">2012-07-20 14:56</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/emacs-zhong-de-wan-mei-duo-chuang-kou-cao-zuo.html#disqus_thread" data-disqus-identifier="cache/posts/emacs-zhong-de-wan-mei-duo-chuang-kou-cao-zuo.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/multiple.html" rel="tag">multiple</a></li>
           <li><a class="tag p-category" href="categories/window.html" rel="tag">window</a></li>
           <li><a class="tag p-category" href="categories/zh.html" rel="tag">zh</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<div id="outline-container-1" class="outline-3"> <h4 id="sec-1">典型的工作流</h4> <div class="outline-text-3" id="text-1">  <ol>
<li>在两个子窗口中对比文件内容 </li> <li>打开更多的窗口以参考其他信息. </li> <li>对某个窗口内容比较有兴趣,跳转到该窗口,将该窗口最大化 </li> <li>看完最大化的窗口内容后,undo最大化操作,重新回到早先的多个小窗口模式以便继续纵览全局 </li> </ol>
</div>  </div>  <div id="outline-container-2" class="outline-3"> <h4 id="sec-2">将子窗口自动编号,然后按M-0…9跳转(最爱)</h4> <div class="outline-text-3" id="text-2">  <p>安装<a href="https://github.com/nschum/window-numbering.el">window-numbering.el</a>,然后在.emacs中添加以下代码, </p>   <pre class="src src-elisp">(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">window-numbering</span>)
(window-numbering-mode 1)</pre>  </div>  </div>  <div id="outline-container-3" class="outline-3"> <h4 id="sec-3">undo/redo之前的窗口操作(最爱)</h4> <div class="outline-text-3" id="text-3">  <p>安装<a href="http://www.emacswiki.org/emacs/WinnerMode">Winner Mode</a>,然后在.emacs中添加以下代码, </p>   <pre class="src src-elisp">(winner-mode 1)
<p><span style="color: #af0000;">;; </span><span style="color: #af0000;">copied from http://puntoblogspot.blogspot.com/2011/05/undo-layouts-in-emacs.html</span>
(global-set-key (kbd <span style="color: #87005f;">"C-x 4 u"</span>) 'winner-undo)
(global-set-key (kbd <span style="color: #87005f;">"C-x 4 r"</span>) 'winner-redo)</p></pre>  </div>  </div>  <div id="outline-container-4" class="outline-3"> <h4 id="sec-4">焦点移动到下一窗口(常用)</h4> <div class="outline-text-3" id="text-4">  <p>M-x other-window,快捷键是<code>C-x o</code>. </p>
</div>  </div>  <div id="outline-container-5" class="outline-3"> <h4 id="sec-5">水平/垂直切分当前窗口(常用)</h4> <div class="outline-text-3" id="text-5">  <p>快捷键C-x 2/3 </p>
</div>  </div>  <div id="outline-container-6" class="outline-3"> <h4 id="sec-6">将当前子窗口最大化(常用)</h4> <div class="outline-text-3" id="text-6">  <p>M-x delete-other-windows,快捷键<code>C-x 1</code>. </p>
</div>  </div>  <div id="outline-container-7" class="outline-3"> <h4 id="sec-7">删除当前子窗口(偶尔用)</h4> <div class="outline-text-3" id="text-7">  <p>M-x delete-window (快捷键<code>C-x 0</code>) </p> <p> 顺便说一下,M-x kill-buffer-and-window (快捷键<code>C-x 4 0</code>),我现在用得更多 些. </p>
</div>  </div>  <div id="outline-container-8" class="outline-3"> <h4 id="sec-8">移动焦点到上下左右的窗口(基本不用)</h4> <div class="outline-text-3" id="text-8">  <p>因我较喜欢vi快捷键,所以我安装了<a href="http://emacswiki.org/emacs/Evil">Evil Mode</a>.快捷键和Vi一样. C-w h/j/k/l移动至各方向的子窗口. </p>
</div>  </div>  <div id="outline-container-9" class="outline-3"> <h4 id="sec-9">存储/载入窗口布局到register(基本不用)</h4> <div class="outline-text-3" id="text-9">  <p><code>C-x r w</code>存储,<code>C-x r j</code>载入. </p>
</div> </div> </div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/convert-tex-to-pdf.html">Convert TEX to PDF</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-07-17T23:22:00+00:00">2012-07-17 23:22</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/convert-tex-to-pdf.html#disqus_thread" data-disqus-identifier="cache/posts/convert-tex-to-pdf.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/cpan.html" rel="tag">cpan</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/latex.html" rel="tag">latex</a></li>
           <li><a class="tag p-category" href="categories/pdf.html" rel="tag">pdf</a></li>
           <li><a class="tag p-category" href="categories/perl.html" rel="tag">perl</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
TEX to PDF                                                            :en:perl:cpan:latex:pdf:
</p>

<p>
Install <a href="http://www.tug.org/texlive/">TexLive</a> in your OS.
</p>

<p>
Install <code>latex2pdf</code> which is dependent on TexLive.
</p>

<div class="org-src-container">

<pre><code class="lang-sh">cpan App::cpanminus # handy tool to install cpan module
cpanm Template # Template is missing on cygwin
cpanm latex2pdf # finally
</code></pre>

</div>

<p>
Convert now!
</p>

<div class="org-src-container">

<pre><code class="lang-sh">pdf2latex cv.tex
</code></pre>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/install-perl-module-through-source-package-on-cygwin-by-using-cpanm.html">Install perl module through source package on cygwin by using cpanm</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-07-17T23:22:00+00:00">2012-07-17 23:22</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/install-perl-module-through-source-package-on-cygwin-by-using-cpanm.html#disqus_thread" data-disqus-identifier="cache/posts/install-perl-module-through-source-package-on-cygwin-by-using-cpanm.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/cpan.html" rel="tag">cpan</a></li>
           <li><a class="tag p-category" href="categories/cpanm.html" rel="tag">cpanm</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/install.html" rel="tag">install</a></li>
           <li><a class="tag p-category" href="categories/module.html" rel="tag">module</a></li>
           <li><a class="tag p-category" href="categories/perl.html" rel="tag">perl</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
perl module through source package on cygwin by using cpanm           :cpanm:cpan:perl:module:install:en:
</p>

<p>
I failed to install package "Template" by running `cpanm Template'.
</p>

<p>
It's because the binary package requires gcc4 while on my cygwin only gcc3 available.
</p>

<p>
So I install it from source package (with some hack, of course),
</p>

<div class="org-src-container">

<pre><code class="lang-sh">cpanm --look Template # Download and unpack the distribution and then open the directory with your shellI
cpanm . #install from local directory
</code></pre>

</div>

<p>
Updated: The simpler solution is to install gcc4 at cygwin.</p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/how-to-convert-org-to-pdf.html">How to convert org to PDF</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-07-08T15:27:00+00:00">2012-07-08 15:27</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/how-to-convert-org-to-pdf.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-convert-org-to-pdf.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/latex.html" rel="tag">latex</a></li>
           <li><a class="tag p-category" href="categories/pdf.html" rel="tag">pdf</a></li>
           <li><a class="tag p-category" href="categories/perl.html" rel="tag">perl</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>All you need  to do is to install <a href="http://www.tug.org/texlive/">TexLive</a>. The org-mode has some handy function to find the TexLive and do the conversion. So all you need to trigger the conversion in Emacs is pressing </p>
<pre>C-c C-e p</pre>.

<p> At Cygwin and Linux, installing TexLive is a piece of cake by using default package system. </p>

<p></p>
<p> At Mac, I use <a href="http://www.tug.org/texlive/acquire-netinstall.html">the default TexLive source package</a> (install-tl-unx.tar.gz). After installation, you need set up environment varaibles. </p> <p> If you use Bash (default at my OS X 10.7.3), you can paste below code to you ~/.bashrc: </p>
<pre class="src src-sh"><span style="color: #af00ff;">if</span> [[ <span style="color: #cd00cd;">`uname -s`</span> == *Darwin* ]]; <span style="color: #af00ff;">then</span>
   <span style="color: #af0000;">#</span><span style="color: #af0000;">tex live on OS X</span>
   <span style="color: #5f5f87;">export</span> <span style="color: #af5f00;">PATH</span>=/usr/local/texlive/2011/bin/universal-darwin:$<span style="color: #af5f00;">PATH</span>
   <span style="color: #5f5f87;">export</span> <span style="color: #af5f00;">MANPATH</span>=/usr/local/texlive/2011/texmf/doc/man:$<span style="color: #af5f00;">MANPAH</span>
   <span style="color: #5f5f87;">export</span> <span style="color: #af5f00;">INFOPATH</span>=/usr/local/texlive/2011/texmf/doc/info:$<span style="color: #af5f00;">INFOPATH</span>
<span style="color: #af00ff;">fi</span></pre>

<p></p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/note-on-emacs-chat-between-john-wiegley-and-sacha-chua.html">Notes on Emacs chat between John Wiegley and Sacha Chua</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-07-04T17:15:00+00:00">2012-07-04 17:15</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/note-on-emacs-chat-between-john-wiegley-and-sacha-chua.html#disqus_thread" data-disqus-identifier="cache/posts/note-on-emacs-chat-between-john-wiegley-and-sacha-chua.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
on Emacs chat between John Wiegley and Sacha Chua                       :emacs:linux:en:
</p>

<p>
See <a href="http://sachachua.com/blog/2012/07/transcript-emacs-chat-john-wiegley/">http://sachachua.com/blog/2012/07/transcript-emacs-chat-john-wiegley/</a> for the video and transcript.
</p>

<p>
I only record key points,
</p>

<ul class="org-ul">
<li>Use gnus heavily
</li>
<li>ERC in another Emacs instance
</li>
<li>Look at Magit buffer to get overview
</li>
<li>Use built in vc mode, `C-x v =' to get diff of current file
</li>
<li>One single org, other seven are archives
</li>
<li>Helm (fork of anything.el)
</li>
<li>Gnus read mail and rss (gwene), Adaptive scoring is good.
</li>
<li>fetchmail to fetch from Gmail
</li>
<li>Organize Structure (rename/moving files folders)
</li>
<li>Twenty items in hot list in org-mode linking to other lists and areas of machine
</li>
<li>Dropbox to record voice at <a href="http://dropbox.com">http://dropbox.com</a> and org-mode hook to get voice message
</li>
<li>M-m to call `org-capture'
</li>
<li>'Quick Keys' on Mac plus some apple script (Viewing page in Chrome, M-n to activate emacs, put a link)
</li>
<li>Emacs can view PDF
</li>
<li>Reading Emacs manual from the scratch
</li>
<li>Emacspeak to read the manual
</li>
<li>Ledger for the accounting
</li>
</ul>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/how-to-configure-yasnippet-0-7-0-and-use-it-with-auto-complete-mode.html">How to configure yasnippet 0.7.0 and use it with Auto-Complete-Mode</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-06-19T21:40:00+00:00">2012-06-19 21:40</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/how-to-configure-yasnippet-0-7-0-and-use-it-with-auto-complete-mode.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-configure-yasnippet-0-7-0-and-use-it-with-auto-complete-mode.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/autocomplete.html" rel="tag">autocomplete</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/yasnippet.html" rel="tag">yasnippet</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
to configure yasnippet 0.7.0 and use it with Auto-Complete-Mode           :en:yasnippet:emacs:autocomplete:
</p>

<p>
I will only talk about how to set up yasnippet 0.7.0 or higher version.
</p>

<div id="outline-container-sec-1" class="outline-2">

<div class="outline-text-2" id="text-1">
<p>
See its <a href="http://capitaomorte.github.com/yasnippet/">official documentation</a>.
</p>

<p>
Install the yasnippet into somewhere and add following code into your .emacs:
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">(add-to-list 'load-path
              "~/.emacs.d/plugins/yasnippet-x.y.z")
(require 'yasnippet) ;; not yasnippet-bundle
(yas/initialize)
(yas/load-directory "~/.emacs.d/plugins/yasnippet-x.y.z/snippets")
</code></pre>

</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">If you use elpa package system, setup is even simpler</h3>
<div class="outline-text-2" id="text-2">
<p>
After installation, you only need two lines in .emacs.
</p>
<div class="org-src-container">

<pre><code class="lang-lisp">(require 'yasnippet)
(yas/initialize)
</code></pre>

</div>

<p>
Yasnippet 0.7.0 have already defined two locations for the snippets, "~/.emacs.d/yasnippet-install-path/yasnippet-x.y.z/snippets" and "~/.emacs.d/snippets". Yasnippet will load snippets in BOTH directories at startup.
</p>

<p>
So you only put your own snippets in "~/.emacs.d/snippets" and done. No need to tweak .emacs at all. To verify my claim, you can `C-h v yas/snippet-dirs' to check value of "yas/snippet-dirs". Please note "yas/root-directory" is the alias of "yas/snippet-dirs".
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">The real world setup is NOT simple</h3>
<div class="outline-text-2" id="text-3">
<p>
I will explain the reasons at first and give my complete yasnippet configuration code at the end of the this post.
</p>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h4 id="sec-3-1">Two snippets may share the same key, so I need activate `yas/dropdown-prompt'</h4>
<div class="outline-text-3" id="text-3-1">
<p>
One issue is I need a user-friendly dropdown window popped up when the key I input has several candidates. For example, when I type "inc" in C code. There are two candidates `#include "…"' and `#include &lt;…&gt;' available. A handy dropdown popup will help me to choose one of them as efficient as possible.
</p>

<p>
The good news is such fancy popup is a standard component of yasnippet. It's called `yas/dropdown-prompt'.  Its default algorithm will activate it at highest priority.
</p>

<p>
The bad news is for some strange reason yasnippet won't load that dropdown-list by default. So you need manually load that component by one line of elisp code `(require 'dropdown-list)'.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h4 id="sec-3-2">`yas/dropdown-prompt' is not perfect</h4>
<div class="outline-text-3" id="text-3-2">
<p>
I cannot scroll down the dropdown window when there are more candidates it can display. That's especially annoying when calling `yas/insert-snippet'. In this case, we need use `yas/completing-prompt' instead. I will show the fix at the end of this article.
</p>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h4 id="sec-3-3">Yasnippet conflicts with other plugins</h4>
<div class="outline-text-3" id="text-3-3">
<p>
I use <a href="http://cx4a.org/software/auto-complete/">Auto Complete Mode</a> (version 20120327 in elpa).  There are two issues when using it with yasnippet.
</p>

<p>
First, it use TAB key to do the auto-complete thing while yasnippet also uses TAB key. So I need re-configure hotkeys of yasnippet.
</p>

<p>
Second, yasnippet changed its API `yas/get-snippet-tables' since version 0.7.0. This make the auto-complete cannot use yasnippet at all. This issue is <a href="https://github.com/m2ym/auto-complete/pull/107">reported</a> and <a href="https://github.com/tkf/auto-complete/commit/337caa2ccc254a79f615bb2417f0d2fb9552b547">fixed</a> by <a href="https://github.com/tkf">tkf</a>. Actually all you need do is simple:
</p>
<div class="org-src-container">


<pre><code class="lang-sh">cd auto-complete-install-dir
rm auto-complete-config.elc
curl -L https://raw.github.com/tkf/auto-complete/337caa2ccc254a79f615bb2417f0d2fb9552b547/auto-complete-config.el &gt; auto-complete-config.el
</code></pre>

</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h3 id="sec-4">My final yasnippet setup</h3>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre><code class="lang-lisp">(require 'yasnippet)
(yas/initialize)
;; default TAB key is occupied by auto-complete
(global-set-key (kbd "C-c ; u") 'yas/expand)
;; default hotkey `C-c &amp; C-s` is still valid
(global-set-key (kbd "C-c ; s") 'yas/insert-snippet)
;; give yas/dropdown-prompt in yas/prompt-functions a chance
(require 'dropdown-list)
;; use yas/completing-prompt when ONLY when `M-x yas/insert-snippet'
;; thanks to capitaomorte for providing the trick.
(defadvice yas/insert-snippet (around use-completing-prompt activate)
     "Use `yas/completing-prompt' for `yas/prompt-functions' but only here..."
       (let ((yas/prompt-functions '(yas/completing-prompt)))
             ad-do-it))
</code></pre>

</div>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/zai-wo-de-osx-shang-wei-heroku-kai-fa-rails-chen-xu.html">在我的Mac OS X 10.7.3上为heroku开发rails程序</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2012-05-31T14:13:00+00:00">2012-05-31 14:13</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/zai-wo-de-osx-shang-wei-heroku-kai-fa-rails-chen-xu.html#disqus_thread" data-disqus-identifier="cache/posts/zai-wo-de-osx-shang-wei-heroku-kai-fa-rails-chen-xu.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/deployment.html" rel="tag">deployment</a></li>
           <li><a class="tag p-category" href="categories/heorku.html" rel="tag">heorku</a></li>
           <li><a class="tag p-category" href="categories/postgresql.html" rel="tag">postgresql</a></li>
           <li><a class="tag p-category" href="categories/rails.html" rel="tag">rails</a></li>
           <li><a class="tag p-category" href="categories/zh.html" rel="tag">zh</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>rails版本为3.1，OS X版本10.7.3，postgresql版本9.1.3j </p> <div id="outline-container-1" class="outline-3"> <h4 id="sec-1">数据库必须用postgresql</h4> <div class="outline-text-3" id="text-1">  <p>heroku官方主页反对开发版本用sqlite3而生产版本用postgresql. </p>
</div>  </div>  <div id="outline-container-2" class="outline-3"> <h4 id="sec-2">在OS X 10.7.3上安装postgresql</h4> <div class="outline-text-3" id="text-2">  <p>首先,检查你的OS X版本，从10.7开始OS X自带postgresql </p>   <pre class="src src-sh">sw_vers -productVersion
</pre>  <p> 如果要安装最新版的postgresql，必须删除老版本的数据库。具体做法参考<a href="http://nextmarvel.net/blog/2011/09/brew-install-postgresql-on-os-x-lion/">这篇文章</a>,实际上也就是一行命令： </p>   <pre class="src src-sh">curl http://nextmarvel.net/blog/downloads/fixBrewLionPostgres.sh | sh
<p></p></pre>  <p> 强烈推荐用homebrew安装数据库, </p>   <pre class="src src-sh">brew install postgresql
<p></p></pre>  <p> 具体安装细节请参考<a href="http://wiki.postgresql.org/wiki/Detailed_installation_guides">postgresql官方wiki</a>. </p>
</div>  </div>  <div id="outline-container-3" class="outline-3"> <h4 id="sec-3">检测已安装的postgresql</h4> <div class="outline-text-3" id="text-3">  <p>这里是<a href="http://www.postgresql.org/docs/9.1/interactive/tutorial-createdb.html">一些数据库基本操作的官方文档</a>. 可以<code>psql -l</code>看一些已有数据库列表. </p>
</div>  </div>  <div id="outline-container-4" class="outline-3"> <h4 id="sec-4">数据库用postgresql的rails项目</h4> <div class="outline-text-3" id="text-4">     <pre class="src src-sh">rails new myapp --database=postgresql
<p></p></pre>  <p> 如果是从一个已经使用sqlite的项目切换数据库，就必须改config/database.yml,有一些catch，请参考<a href="http://stackoverflow.com/questions/8199141/postgres-rake-dbmigrate-fails-with-access-denied-error">stackoverflow上的讨论</a>. </p> <p> 然后,<code>createdb myapp_development</code>创建postgresql数据库，<code>rake db:migrate</code>建立数据库schema并导入数据在本地数据库.简单测试可证明数据库和web程序可以无缝工作. </p> <p> 最后不要忘记<code>git commit</code>最新代码. </p>
</div>  </div>  <div id="outline-container-5" class="outline-3"> <h4 id="sec-5">部署web程序到heroku</h4> <div class="outline-text-3" id="text-5">  <p>请参考<a href="https://devcenter.heroku.com/articles/ruby">heroku官方文档</a>,提醒一下不要忘记运行<code>heroku run rake db:migrate</code>,否则数据库是空的. </p> <p> 部署结束后可以运行<code>heroku open</code>打开浏览器访问web程序首页. </p> <p> 如打开网站有问题，可以<code>heroku logs</code>查看日志. </p>
</div> </div> </div>
            </div>
        </div>
    
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-6.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-4.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="chenbin0";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2017         <a href="mailto:chenbin.sh@gmail.com">Chen Bin</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
         document.addEventListener('DOMContentLoaded', function() {
           var items = document.getElementsByClassName('timeago'), e, pd;
           for (var i = 0; i < items.length; i++) {
             e = items[i];
             pd = moment(new Date(e.getAttribute('datetime')));
             e.innerHTML = pd.fromNow();
             e.setAttribute('title', pd.format('LLLL'));
           }
         });
        </script>
</body>
</html>
