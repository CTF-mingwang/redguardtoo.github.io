<html><body><p>As we dicussed in <a href="https://plus.google.com/110954683162859211810/posts/TgnyDRqBWkb">Emacs community at Google+</a>. Although <a href="https://github.com/magnars/multiple-cursors.el">multiple-cursor</a> is good for this task, I cannot use it because it conflicts with my favourite <a href="http://www.emacswiki.org/emacs/Evil">evil-mode</a> (Vim simulation in Emacs). </p> <p> There is another emacs plugin called <a href="https://github.com/victorhge/iedit">iedit</a> which could do the similar job (I usually use its command called iedit-mode-toggle-on-function) </p> <p> Though iedit is good, there is still room for improvement. When using iedit-mode-toggle-on-function, we need press key twice to rename the variable name. Once to enable it, twice to disable it. </p> <p> Magnar Sveen pointed out in the G+ discussion that the key point we need plugins like multiple-cursor or iedit-mode is that we can see all the changes while doing the editing. </p> <p> This reminds me that evil-mode has a excellent regex string replacing mode which also show the changes when you are typing EACH character of new string. </p> <p> So by using evil-mode's default regex replacing command, I can implement similar feature even more efficiently then iedit-mode! </p> <p> Here is my elisp code: </p>   <pre class="src src-elisp">(<span style="color: #b9ca4a;">defun</span> <span style="color: #7aa6da;">evilcvn-change-symbol-in-defun</span> ()
  <span style="color: #c397d8;">"mark the region in defun (definition of function) and use string replacing UI in evil-mode</span>
<span style="color: #c397d8;">to replace the symbol under cursor"</span>
  (interactive)
  (<span style="color: #b9ca4a;">let</span> ((old (thing-at-point 'symbol)))
    (mark-defun)
    (<span style="color: #b9ca4a;">unless</span> (evil-visual-state-p)
      (evil-visual-state))
    (evil-ex (concat <span style="color: #70c0b1;">"'&lt;,'&gt;s/"</span> (<span style="color: #b9ca4a;">if</span> (= 0 (length old)) <span style="color: #70c0b1;">""</span> <span style="color: #70c0b1;">"\\&lt;</span><span style="color: #e7c547; font-weight: bold;">\\</span><span style="color: #c397d8; font-weight: bold;">(</span><span style="color: #70c0b1;">"</span>) old (<span style="color: #b9ca4a;">if</span> (= 0 (length old)) <span style="color: #70c0b1;">""</span> <span style="color: #70c0b1;">"</span><span style="color: #e7c547; font-weight: bold;">\\</span><span style="color: #c397d8; font-weight: bold;">)</span><span style="color: #70c0b1;">\\&gt;/"</span>))))
  )
(global-set-key (kbd <span style="color: #70c0b1;">"C-c ; s"</span>) 'evilcvn-change-symbol-in-defun)

</pre>   <p> Put you cursor above a symbol/variable and press hot key "Ctrl-c ; s", then the regex to replace that symbol is automatically created and inserted into mini-buffer. Now you only need type new string and watch. </p> <p> This is the screen shot (I renamed variable "count" into "cnt" in C++ function hello): <img src="/wp-content/uploads/2013/05/wpid-evil-regex-replace-nq8.png" alt="image/evil-regex-replace-nq8.png"> </p></body></html>