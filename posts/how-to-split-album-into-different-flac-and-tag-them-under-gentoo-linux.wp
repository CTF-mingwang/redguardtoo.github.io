<html><body><div id="outline-container-1" class="outline-3"> <h3 id="sec-1">Install necessary CLI tools</h3> <div class="outline-text-3" id="text-1">     <pre class="src src-sh">sudo emerge media-sound/shntool
sudo emerge cuetools

</pre>  </div>  </div>  <div id="outline-container-2" class="outline-3"> <h3 id="sec-2">Download the script</h3> <div class="outline-text-3" id="text-2">  <p>See <a href="https://bbs.archlinux.org/viewtopic.php?id=58766">https://bbs.archlinux.org/viewtopic.php?id=58766</a> for the source of bash script. </p> <p> Here is the full content of the bash script: </p>   <pre class="src src-sh"><span style="color: #969896; font-style: italic;">#</span><span style="color: #969896; font-style: italic;">!/bin/</span><span style="color: #b9ca4a;">bash</span>

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">split image file (flac, ape, wav, etc.) according to cue-file</span>



<span style="color: #b9ca4a;">if</span> [ -f <span style="color: #70c0b1;">"$1"</span> ]; <span style="color: #b9ca4a;">then</span>
    <span style="color: #e7c547;">i</span>=0
    <span style="color: #b9ca4a;">for</span> cuefile<span style="color: #b9ca4a;"> in</span> *.cue; <span style="color: #b9ca4a;">do</span>
        <span style="color: #e7c547;">i</span>=$(($<span style="color: #e7c547;">i</span> + 1))
    <span style="color: #b9ca4a;">done</span>
    <span style="color: #b9ca4a;">if</span> [ $<span style="color: #e7c547;">i</span> -eq 1 ]; <span style="color: #b9ca4a;">then</span>
        <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">precies 1 cuesheet gevonden</span>
        <span style="color: #b9ca4a;">if</span> grep -q <span style="color: #70c0b1;">"INDEX 01 00:00:00"</span> *.cue ; <span style="color: #b9ca4a;">then</span>
            nice shntool split -t <span style="color: #70c0b1;">"%n %t"</span> -f *.cue <span style="color: #70c0b1;">"$1"</span>
        <span style="color: #b9ca4a;">else</span>
            <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"The first track has a pre-gap. Shntool will cut that off and put it in a seperate file."</span>
            <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"You don't want that. Please modify the cuesheet from:"</span>
            grep -m1 <span style="color: #70c0b1;">"INDEX 00"</span> *.cue
            grep -m1 <span style="color: #70c0b1;">"INDEX 01"</span> *.cue
            <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"to:"</span>
            <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"    INDEX 01 00:00:00"</span>
            <span style="color: #b9ca4a;">exit</span> 1
        <span style="color: #b9ca4a;">fi</span>
    <span style="color: #b9ca4a;">elif</span> [ $<span style="color: #e7c547;">i</span> -eq 0 ]; <span style="color: #b9ca4a;">then</span>
        <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"No cuesheet found in the current directory."</span>
        <span style="color: #b9ca4a;">exit</span> 1
    <span style="color: #b9ca4a;">elif</span> [ $<span style="color: #e7c547;">i</span> -gt 1 ]; <span style="color: #b9ca4a;">then</span>
        <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"$i cuesheets found in the current directory. Please remove the superfluous cuesheets."</span>
        <span style="color: #b9ca4a;">exit</span> 1
    <span style="color: #b9ca4a;">fi</span>
<span style="color: #b9ca4a;">else</span>
    <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"Split image file (flac, ape, wav, etc.) according to cue-file."</span>
    <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"Output files are in FLAC."</span>
    <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"Usage: `basename $0` &lt;image-file&gt;"</span>
    <span style="color: #b9ca4a;">exit</span> 1
<span style="color: #b9ca4a;">fi</span>



<span style="color: #c397d8;">echo</span>

<span style="color: #e7c547;">album</span>=<span style="color: #c397d8;">`grep -m 1 TITLE *.cue | cut -d\" -f2`</span>

<span style="color: #e7c547;">artist</span>=<span style="color: #c397d8;">`grep -m 1 PERFORMER *.cue | cut -d\" -f2`</span>



<span style="color: #b9ca4a;">for</span> file<span style="color: #b9ca4a;"> in</span> [0-9]*.wav; <span style="color: #b9ca4a;">do</span>
    <span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">"Encoding $file"</span>

    <span style="color: #b9ca4a;">if</span> [[ ${<span style="color: #e7c547;">file</span>:0:1} == 0 ]] ; <span style="color: #b9ca4a;">then</span>
        <span style="color: #e7c547;">tracknr</span>=${<span style="color: #e7c547;">file</span>:1:1}
    <span style="color: #b9ca4a;">else</span>
        <span style="color: #e7c547;">tracknr</span>=${<span style="color: #e7c547;">file</span>:0:2}
    <span style="color: #b9ca4a;">fi</span>
    <span style="color: #e7c547;">title</span>=<span style="color: #c397d8;">`echo ${file:2} | sed -e "s/.wav$//"`</span>

    nice flac -s -T <span style="color: #70c0b1;">"artist=$artist"</span> -T <span style="color: #70c0b1;">"album=$album"</span> -T <span style="color: #70c0b1;">"title=$title"</span> <span style="color: #70c0b1;">\</span>
    -T <span style="color: #70c0b1;">"tracknumber=$tracknr"</span> <span style="color: #70c0b1;">"$file"</span> &amp;&amp; rm <span style="color: #70c0b1;">"$file"</span>
<span style="color: #b9ca4a;">done</span>

</pre>   <p> Put the script somewhere and name it to "cue2flac" </p></div>  </div>  <div id="outline-container-3" class="outline-3"> <h3 id="sec-3">Do the real conversion</h3> <div class="outline-text-3" id="text-3">     <pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">convert the ape to corresponding wav file, for example, "a.ape" is converted to "a.ape.wav"</span>

find . -name <span style="color: #70c0b1;">'*.ape'</span>|xargs -I {} ffmpeg -i {} {}.wav

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">split wav and convert it to flac, make sure the *.cue exists in current directory</span>

cue2flac a.ape.wav

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">do the cleaning (OPTIONAL)</span>

rm *.ape *.wav

</pre>  </div> </div> </body></html>