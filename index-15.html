<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Linux, Programming, Emacs">
<meta name="viewport" content="width=device-width">
<title>Chen's blog (old posts, page 15) | Chen's blog</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://blog.binchen.org/index-15.html">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <section class="social"><ul>
<li><a href="index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="stories/about.html" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://twitter.com/chen_bin" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/redguardtoo" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
            
        <div class="post">
            <h1 class="title"><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html">My answer to "What are some must-have emacs additions" on quora.com</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-02-13T19:44:00+00:00">2014-02-13 19:44</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#disqus_thread" data-disqus-identifier="cache/posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/addon.html" rel="tag">addon</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/plugin.html" rel="tag">plugin</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<div id="table-of-contents"> <h3>Table of Contents</h3> <div id="text-table-of-contents"> <ul>
<li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-1">1. Warning</a></li> <li>
<a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2">2. third party plugins</a> <ul>
<li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-1">2.1. company-mode</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-2">2.2. yasnippet</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-3">2.3. js2-mode</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-4">2.4. evil-mode</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-5">2.5. evil-leader</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-6">2.6. evil-matchit (written by me)</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-7">2.7. evil-nerd-commenter (written by me)</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-8">2.8. helm</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-9">2.9. web-mode</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-10">2.10. windows-numbering.el</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-2-11">2.11. smex</a></li> </ul>
</li> <li>
<a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3">3. plugins bundled with emacs 24</a> <ul>
<li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3-1">3.1. org-mode</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3-2">3.2. winner-mode</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3-3">3.3. gnus</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3-4">3.4. ido</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3-5">3.5. imenu</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3-6">3.6. flymake</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-3-7">3.7. flyspell</a></li> </ul>
</li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-4">4. The last and best plugin</a></li> <li><a href="posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html#sec-5">5. Tip</a></li> </ul>
</div> </div> <p> This is my answer for <a href="http://www.quora.com/Emacs/What-are-some-must-have-additions-to-your-emacs-file">What are some must-have additions to your .emacs file?</a> on quora.com. </p>  <p> Emacs 24 is already bundled with a package manager. So you can download and install the package without leaving Emacs. See <a href="http://www.emacswiki.org/emacs/ELPA">http://www.emacswiki.org/emacs/ELPA</a> for how to set up. </p>  <p> If you want to know more tips about specific plugin. Please search its name in <a href="http://www.emacswiki.org">Emacswiki</a>. </p>  <div id="outline-container-sec-1" class="outline-2"> <h3 id="sec-1">
<span class="section-number-2">1</span> Warning</h3> <div class="outline-text-2" id="text-1"> <p> I'm a web programmer, so my focus could be different from other emacs users. </p> </div> </div> <div id="outline-container-sec-2" class="outline-2"> <h3 id="sec-2">
<span class="section-number-2">2</span> third party plugins</h3> <div class="outline-text-2" id="text-2"> </div>
<div id="outline-container-sec-2-1" class="outline-3"> <h4 id="sec-2-1">
<span class="section-number-3">2.1</span> company-mode</h4> <div class="outline-text-3" id="text-2-1"> <p> auto completing code, it requires less key typing than another emacs plugin auto-complete. Besides, it's actively maintained  </p> </div> </div>  <div id="outline-container-sec-2-2" class="outline-3"> <h4 id="sec-2-2">
<span class="section-number-3">2.2</span> yasnippet</h4> <div class="outline-text-3" id="text-2-2"> <p> insert template </p> </div> </div>  <div id="outline-container-sec-2-3" class="outline-3"> <h4 id="sec-2-3">
<span class="section-number-3">2.3</span> js2-mode</h4> <div class="outline-text-3" id="text-2-3"> <p> javascript development, best of the best </p> </div> </div>  <div id="outline-container-sec-2-4" class="outline-3"> <h4 id="sec-2-4">
<span class="section-number-3">2.4</span> evil-mode</h4> <div class="outline-text-3" id="text-2-4"> <p> vim simulator, I cannot live without it as a vi guy </p> </div> </div>  <div id="outline-container-sec-2-5" class="outline-3"> <h4 id="sec-2-5">
<span class="section-number-3">2.5</span> evil-leader</h4> <div class="outline-text-3" id="text-2-5"> <p> evil's plugin, simple and powerful if you realize that ALL the hot keys (for example, I map "M-x" to ",mx") can be re-mapped with it </p> </div> </div>  <div id="outline-container-sec-2-6" class="outline-3"> <h4 id="sec-2-6">
<span class="section-number-3">2.6</span> evil-matchit (written by me)</h4> <div class="outline-text-3" id="text-2-6"> <p> jump between tag pair, port of  vim matchit </p> </div> </div>  <div id="outline-container-sec-2-7" class="outline-3"> <h4 id="sec-2-7">
<span class="section-number-3">2.7</span> evil-nerd-commenter (written by me)</h4> <div class="outline-text-3" id="text-2-7"> <p> (un)comment by lines,  port of nerd-comment </p> </div> </div>  <div id="outline-container-sec-2-8" class="outline-3"> <h4 id="sec-2-8">
<span class="section-number-3">2.8</span> helm</h4> <div class="outline-text-3" id="text-2-8"> <p> hard to describe but powerful </p> </div> </div>  <div id="outline-container-sec-2-9" class="outline-3"> <h4 id="sec-2-9">
<span class="section-number-3">2.9</span> web-mode</h4> <div class="outline-text-3" id="text-2-9"> <p> major-mode for all html templates </p> </div> </div>  <div id="outline-container-sec-2-10" class="outline-3"> <h4 id="sec-2-10">
<span class="section-number-3">2.10</span> windows-numbering.el</h4> <div class="outline-text-3" id="text-2-10"> <p> sub-window navigation, best one. well, it occupies hotkey from M-1 to M-9, For normal emacs user this could be issue. but I'm evil guy;) </p> </div> </div>  <div id="outline-container-sec-2-11" class="outline-3"> <h4 id="sec-2-11">
<span class="section-number-3">2.11</span> smex</h4> <div class="outline-text-3" id="text-2-11"> <p> you don't need remember hot key or command any more </p> </div> </div> </div> <div id="outline-container-sec-3" class="outline-2"> <h3 id="sec-3">
<span class="section-number-2">3</span> plugins bundled with emacs 24</h3> <div class="outline-text-2" id="text-3"> </div>
<div id="outline-container-sec-3-1" class="outline-3"> <h4 id="sec-3-1">
<span class="section-number-3">3.1</span> org-mode</h4> <div class="outline-text-3" id="text-3-1"> <p> gtd tool, it changed my life, as git,vim,emacs did to me ages ago. </p> </div> </div>  <div id="outline-container-sec-3-2" class="outline-3"> <h4 id="sec-3-2">
<span class="section-number-3">3.2</span> winner-mode</h4> <div class="outline-text-3" id="text-3-2"> <p> undo sub window-layout </p> </div> </div>  <div id="outline-container-sec-3-3" class="outline-3"> <h4 id="sec-3-3">
<span class="section-number-3">3.3</span> gnus</h4> <div class="outline-text-3" id="text-3-3"> <p> hate and love it. the UI is too geek. but has some killer feature,  for example, forward email, send email quickly, attach file. but the point is I can use with other awesome plugins like yasnippet, company-mode,evil. </p> </div> </div>  <div id="outline-container-sec-3-4" class="outline-3"> <h4 id="sec-3-4">
<span class="section-number-3">3.4</span> ido</h4> <div class="outline-text-3" id="text-3-4"> <p> similar to helm, my tip, you can tell helm when to use ido, when to use helm. </p> </div> </div>  <div id="outline-container-sec-3-5" class="outline-3"> <h4 id="sec-3-5">
<span class="section-number-3">3.5</span> imenu</h4> <div class="outline-text-3" id="text-3-5"> <p> display list of function in current buffer, the point is it is programmable </p> </div> </div>  <div id="outline-container-sec-3-6" class="outline-3"> <h4 id="sec-3-6">
<span class="section-number-3">3.6</span> flymake</h4> <div class="outline-text-3" id="text-3-6"> <p> real time syntax check </p> </div> </div>  <div id="outline-container-sec-3-7" class="outline-3"> <h4 id="sec-3-7">
<span class="section-number-3">3.7</span> flyspell</h4> <div class="outline-text-3" id="text-3-7"> <p> best spell checker, if you know how to do programming for it </p> </div> </div> </div> <div id="outline-container-sec-4" class="outline-2"> <h3 id="sec-4">
<span class="section-number-2">4</span> The last and best plugin</h3> <div class="outline-text-2" id="text-4"> <p> Lisp! </p> <ul class="org-ul">
<li>simple </li> <li>no learning curve, </li> <li>it's syntax ensure that its plugin developer are experienced developers who knows at least three programming languages. </li> </ul>
</div> </div> <div id="outline-container-sec-5" class="outline-2"> <h3 id="sec-5">
<span class="section-number-2">5</span> Tip</h3> <div class="outline-text-2" id="text-5"> <p> If I find some awesome plugin, I will investigate the original author and make sure what other tools he/she uses or develops </p>  <p> For example, mooz maintains js2-mode, he also developed: </p> <dl class="org-dl">
<dt> keysnail </dt>
<dd>firefox is converted into Emacs, best one in similar tools (I tried 3 or 2 similar firefox/chrome addons before settled on keysnail) </dd> <dt> percol </dt>
<dd>A genius utility for shell operation. Make me ten times faster when working in bash shell. Without it, I will quit my programming career immediately. </dd> </dl>
</div> </div> </div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/how-to-do-htmljavascript-repl-read-eval-print-loop-with-no-server-set-up-2.html">How to do HTML/Javascript REPL (Read–eval–print loop) with NO server set up</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-02-10T21:56:00+00:00">2014-02-10 21:56</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/how-to-do-htmljavascript-repl-read-eval-print-loop-with-no-server-set-up-2.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-do-htmljavascript-repl-read-eval-print-loop-with-no-server-set-up-2.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/frontend.html" rel="tag">frontend</a></li>
           <li><a class="tag p-category" href="categories/html.html" rel="tag">html</a></li>
           <li><a class="tag p-category" href="categories/javascript.html" rel="tag">javascript</a></li>
           <li><a class="tag p-category" href="categories/repl.html" rel="tag">repl</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
to do HTML/Javascript REPL (Read–eval–print loop) with NO server set up   :en:repl:javascript:html:frontend:
</p>

<div id="outline-container-sec-1" class="outline-2">

<div class="outline-text-2" id="text-1">
<p>
I love the REPL (Read–eval–print loop). Watch live update of web page when typing code is cool.
</p>

<p>
But most solutions around the internet are not practical for me.
</p>

<p>
In my world, I never has a chance to develop fancy 2D/3D games written in HTML5 canvas.
</p>

<p>
Instead, I was <b>ALWAYS</b> assigned to maintain some enterprise CMS with complex business logic. For example, after refreshing the web page I need click lots of buttons before doing the job. Avoiding press "refresh page button" does not help much.
</p>

<p>
Besides, I can't use the embedded server those solutions boasted because our web application has many dependencies. It needs a whole environment support team to set it up. There is no way I can persuade the team to use a different web server
</p>

<p>
For me, a practical solution must be:
</p>
<ul class="org-ul">
<li>easy to set up
</li>
<li>powerful. I can read/write any part of the web page in my text editor
</li>
<li>no learning curve. I don't want to learn any domain specific language or API. For example, if my web application uses jquery, I want <b>use and only use jquery API</b> to manipulate web page in my text editor. If it use backbone, then I use backbone. No more, no less.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">Solution</h3>
<div class="outline-text-2" id="text-2">
<p>
The best solution is firefox addon <a href="https://github.com/bard/mozrepl/wiki">MozRepl</a>. You can install it <a href="https://addons.mozilla.org">https://addons.mozilla.org</a>. Click firefox menu "Tools =&gt; MozRepl =&gt; Start" to run it.
<img src="wp-content/moz-repl-start-nq8.png" alt="moz-repl-start-nq8.png"></p>

<p>
So what is MozRepl, as its web site says, "MozRepl lets you program Firefox and other Mozilla-based applications <b>from the inside</b>." Basically it convert firefox into a socket server. Your text editor could talk to firefox and let firefox do anything you want. Since it only interact with the firefox, I don't need mess with the web server.
</p>

<p>
Well, I hope I can end this article by claiming "after reading its <a href="https://github.com/bard/mozrepl/wiki/Tutorial">official tutorial</a>,I live happily with MozRepl ever after".
</p>

<p>
The ugly truth is, MozRepl has some rough edges. That's the reason why I write this article. I will explain how to use MozRepl in next two sections.
</p>

<p>
Section 1 is about how to use MozRepl, whatever text editor you use, you should read this section.
</p>

<p>
Section 2 is on how to set up my text editor Emacs to interact with MozRepl. It's optional.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h4 id="sec-2-1">Section 1, use MozRepl</h4>
<div class="outline-text-3" id="text-2-1">
<p>
Here are key points:
</p>
<ul class="org-ul">
<li>You need read above official tutorial at least once
</li>

<li>There is video demo on youtube. I suggest watching from <a href="http://www.youtube.com/watch?v=5RSnHN6S52c#t=137">2:18</a> because you possibly are more interested in manipulating web page than toy with firefox internals.
</li>
<li>web page is called "content" in MozRepl
</li>
<li>In order to execute your javascript code with exactly same syntax as your web application is running code "repl.enter(content);" at first line, as you can see in both video and text tutorial
</li>
<li>Use firefox 24.0+ and MozRepl 1.1.2+
</li>
<li>For some weird reason, MozRepl socket server needs some warm up after web page refreshed. So run the code like "console.log('hello');" in the first connection, close the connection, and run your other code in second connection.
</li>
<li>For code running in MozRepl, if one line will trigger some AJAX request, all the code just after that line <b>will not</b> be executed. Use javascript API "setTimeout' to work around this issue.
</li>
</ul>
<p>
Here is a complete example (note how I use setTimeout) written in javascript,
</p>
<div class="org-src-container">


<pre><code class="lang-javascript">$('#serviceId').val('0451235550');
$('#serviceId').keyup();
console.log('hi');
setTimeout(function(){
  console.log('world');
  $('input[value="1"][name="isAccountHolder"]').click();
  $('#accountNumber').val('01234567891234');
  setTimeout(function(){
    $('#registrationLoginEmailAddress').val('cb@cb.cb');
    $('#registrationLoginEmailAddress2').val('cb@cb.cb');
    $('#password').val('Password1');
    $('#passwordConfirm').val('Password1');
    $('#title').val('Mr');
    $('#serviceFirstName').val('chen');
    $('#serviceLastName').val('bin');
    $('#registrationLoginDetailsContinueBtn').click();
  },2000);
  $('#serviceAccountContinueBtn').click();
},3000);
$('#confirmServiceBtn').click();
</code></pre>

</div>

<p>
As you can see from above, I can use jQuery API loaded in that web page without any problem. Of course, you can always use vanilla javascript instead.
</p>

<p>
Please note the code is not part of my web application! It will be run only in MozRepl. You can telnet to the MozRepl socket server (127.0.0.1 with port 4424) and copy paste above code line by line.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h4 id="sec-2-2">Section 2, set up text editor (Emacs)</h4>
<div class="outline-text-3" id="text-2-2">
<p>
My text editor is Emacs, so I use Emacs as an example.
</p>

<p>
Step 1, install moz.el according to <a href="https://github.com/bard/mozrepl/wiki/Emacs-integration">official manual</a>.
</p>

<p>
Step 2, Please insert below code into your ~/.emacs:
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">(defun moz-goto-content-and-run-cmd (cmd)
  (comint-send-string (inferior-moz-process)
                      (concat "repl.enter(content);"
                              cmd
                              "repl.back();")))

(setq moz-repl-js-dir (expand-file-name "~/moz-repl-js-dir"))

(defun moz--read-file (js-file)
  (with-temp-buffer
    (insert-file-contents js-file)
    (buffer-string)))

(defun moz--load-js-file (js-file)
  (let (cmd )
    (when (file-exists-p js-file)
      ;; make moz API usable in any major-mode
      (moz-minor-mode 1)
      ;; flush mozrepl at first
      (moz-goto-content-and-run-cmd "console.log('hello');")
      ;; read the content of js-file
      (setq cmd (moz--read-file js-file))
      (moz-goto-content-and-run-cmd cmd))))

(defun moz-load-js-file-and-send-it ()
  "load js file from specific directory and send it to mozrepl"
  (interactive)
  (let ((js-file (read-file-name "js file:" moz-repl-js-dir)))
    (moz--load-js-file js-file)
    ))
</code></pre>

</div>

<p>
From now on, you only need "M-x moz-load-js-file-and-send-it" and select the js file you need MozRepl to run.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">Tips</h3>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h4 id="sec-3-1">Tip 1</h4>
<div class="outline-text-3" id="text-3-1">
<p>
Well, this is a simple tip. Maybe you are already aware of this.
</p>

<p>
You can write a all-in-one.js. In all-in-one.js, you can parse the URL to separate logic for different project.
</p>

<p>
Here is javascript code,
</p>
<div class="org-src-container">


<pre><code class="lang-javascript">var url=document.URL;
if(/^.*mycompany\.com\.au.*my-account\/registration/.test(url)){
   console.log("for regitration module");
} else if (/^.*mycompany\.com\.au.*my-account\/my-profile/.test(url)) {
   console.log("for profile module");
}
</code></pre>

</div>

<p>
Since javascript is good at analyzing URL, you can also tweak the URL parameters. Anyway, the full power of javascript is at your hand.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h4 id="sec-3-2">Tip 2</h4>
<div class="outline-text-3" id="text-3-2">
<p>
Sometimes mozrepl will be unresponsive. You can test it by running "M-x moz-reload-browser" to refresh the page. If page is not refreshed, restart Firefox. Luckily this does not happen too often.
</p>

<div class="org-src-container">


<pre><code class="lang-lisp">(defun moz-reload-browser ()
  (interactive)
  (comint-send-string (inferior-moz-process)
                      "setTimeout(function(){content.document.location.reload(true);}, '500');"))
</code></pre>

</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h3 id="sec-4">Demo</h3>
<div class="outline-text-2" id="text-4">
<p>
Here is a demo how I use it in a real world web application development.
</p>

<p>
The script to drive the firefox is written in simple javascript/jquery code, which I already show you.
</p>


<div class="figure">
<p><img src="wp-content/mozrepl-in-action.gif" alt="mozrepl-in-action.gif"></p>
</div>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/notes-on-set-up-nfs-on-archlinux.html">Notes on set up nfs on ArchLinux</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-02-07T17:24:09+00:00">2014-02-07 17:24</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/notes-on-set-up-nfs-on-archlinux.html#disqus_thread" data-disqus-identifier="cache/posts/notes-on-set-up-nfs-on-archlinux.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/archlinux.html" rel="tag">archlinux</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<div id="outline-container-1" class="outline-3"> <h4 id="sec-1">Key points</h4> <div class="outline-text-3" id="text-1">  <ul>
<li>see <a href="http://www.centos.org/docs/5/html/Deployment_Guide-en-US/s1-nfs-server-config-exports.html">Redhat documenation</a>, best doc on exportfs </li> <li>
<a href="http://superuser.com/questions/492989/understanding-subnet-mask">Understanding Subnet mask</a> and <a href="http://superuser.com/questions/186850/what-are-the-essentials-of-a-subnet-mask">essential Subnet mask</a> </li> <li>
<code>sudo exportfs -r</code> to reload /etc/exports </li> <li>
<code>sudo exportfs -v</code> to see current nfs exports </li> <li>content of /etc/exports: </li> </ul>
<pre class="prettyprint ">

/srv/nfs4/z 192.168.0.0/16(ro,insecure,no_subtree_check)
</pre>

<p></p>
<ul>
<li>check <a href="http://alephnull.com/benchmarks/sata2012/nfsv4.html">optimizatioin tips</a> </li> <li>
<code>man 5 exports</code> for the documentation of /etc/exports </li> <li>
<a href="https://www.serverstack.com/blog/2012/11/21/debugging-nfs-file-access-on-server-and-client-side/">Debugging NFS File Access on Server and Client Side</a> </li> </ul>
<pre class="prettyprint ">

# turn on the log

sudo rpcdebug -m nfsd -s proc

# turn off the log
</pre>

<p></p>
<ul>
<li>then <code>sudo tail -f /var/log/messages.log</code> </li> <li>Basically you need <code>sudo systemctl enable syslog-ng.service</code> to enable system log before you use rpcdebug </li> </ul>
</div>  </div>  <div id="outline-container-2" class="outline-3"> <h4 id="sec-2">Summary</h4> <div class="outline-text-3" id="text-2">  <p>On server side: </p>   
<pre class="prettyprint ">

sudo exportfs

# got output like:

# /srv/nfs4/z   192.168.0.0/16
</pre>

<p></p>
<p> Then on client side: </p>   
<pre class="prettyprint ">

# 131072 is 128K

sudo mount 192.168.1.9:/srv/nfs4/z ~/z -o rsize=131072,wsize=131072,noatime,nodiratime,intr
</pre>

<p></p>
</div> </div> </div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/git-merge-in-command-line.html">Git merge in command line</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-01-28T16:53:00+00:00">2014-01-28 16:53</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/git-merge-in-command-line.html#disqus_thread" data-disqus-identifier="cache/posts/git-merge-in-command-line.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/git.html" rel="tag">git</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>List and filter all the files need resolve conflict, then apply certain git operation on them: </p>   
<pre class="prettyprint ">

git diff --name-only --diff-filter=U|grep "\.html\|\.min\.js"|xargs -I{} sh -c "git checkout --theirs {} &amp;&amp; git add {}"
</pre>

<p></p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/switch-input-method-in-evil-mode.html">Switch input method in evil-mode (在Evil中快速切换输入法)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-01-27T22:12:22+00:00">2014-01-27 22:12</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/switch-input-method-in-evil-mode.html#disqus_thread" data-disqus-identifier="cache/posts/switch-input-method-in-evil-mode.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>I need toggle on input method to input Chinese (or any other language) in Emacs. The default hot key is "C-\" which corresponds the command "toggle-input-method". </p> <p> My problem is since I'm using <a href="http://www.emacswiki.org/emacs/Evil">evil-mode</a> (a Vim simulation), I need switch evil state from "normal" to "insert" before toggling on input method. </p> <p> That extra step is not necessary if you insert below code into ~/.emacs: </p>    
<pre class="prettyprint ">

(defun evil-toggle-input-method ()
  "when toggle on input method, switch to evil-insert-state if possible.
when toggle off input method, switch to evil-normal-state if current state is evil-insert-state"
  (interactive)
  (if (not current-input-method)
      (if (not (string= evil-state "insert"))
          (evil-insert-state))
    (if (string= evil-state "insert")
        (evil-normal-state)
        ))
  (toggle-input-method))


(global-set-key (kbd "C-\\") 'evil-toggle-input-method)
</pre>

<p></p>
<p> BTW, I strongly recommend the Chinese input method <a href="https://github.com/wenbinye/emacs-eim">eim</a> written in pure elisp. </p> <p> Emacs中切换其自带输入法的快捷键是"C-\",对应的命令是"toggle-input-method". </p> <p> 我遇到的问题是如果使用<a href="http://www.emacswiki.org/emacs/Evil">Evil</a>(一种Vim模拟)则切换输入法不方便.我需要先切换evil-state至insert,然后才能切换输入法. </p> <p> 只要将以上代码贴入~/.emacs,则切换输入法可以更加高效: </p> <p> 顺便提一下,<a href="https://github.com/wenbinye/emacs-eim">eim</a>是我强烈推荐的中文输入法.  </p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/effective-spell-check-in-emacs.html">Effective spell check in Emacs</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-01-21T12:00:00+00:00">2014-01-21 12:00</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/effective-spell-check-in-emacs.html#disqus_thread" data-disqus-identifier="cache/posts/effective-spell-check-in-emacs.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
           <li><a class="tag p-category" href="categories/spell.html" rel="tag">spell</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
spell check in Emacs                                                :en:linux:emacs:spell:
</p>

<p>
CREATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2014-01-21&gt;</span></span>
</p>

<p>
UPDATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2016-12-07 Wed&gt;</span></span>
</p>

<p>
I use <a href="http://www.emacswiki.org/emacs/FlySpell">Flyspell</a> in web-mode. But the solution works in other major modes.
</p>

<p>
I assume you already turn on <code>flyspell</code> for all the programming languages by inserting below code into <code>.emacs</code>,
</p>

<div class="org-src-container">

<pre><code class="lang-lisp">(add-hook 'prog-mode-hook 'flyspell-prog-mode)
</code></pre>

</div>

<p>
There is also a <a href="http://blog.binchen.org/posts/what-s-the-best-spell-check-set-up-in-emacs.html">short tutorial</a> on:
</p>

<ul class="org-ul">
<li>How to setup flyspell
</li>
<li>Difference between hunspell and aspell 
</li>
<li>How to setup hunspell
</li>
</ul>
<div id="outline-container-sec-1" class="outline-2">

<div class="outline-text-2" id="text-1">
<p>
I will check,
</p>
<ul class="org-ul">
<li>Text between html tag like <code>&lt;label&gt;Please input email&lt;/label&gt;</code>
</li>
<li>Value of html input control like <code>&lt;input type</code>"text" value="Please input your name"&gt;=
</li>
<li>CSS class name like <code>&lt;div class</code>"btn btn-default" /&gt;=
</li>
</ul>
<p>
My setup:
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">;; {{ flyspell setup for web-mode
(defun web-mode-flyspell-verify ()
  (let* ((f (get-text-property (- (point) 1) 'face))
         rlt)
    (cond
     ;; Check the words with these font faces, possibly.
     ;; this *blacklist* will be tweaked in next condition
     ((not (memq f '(web-mode-html-attr-value-face
                     web-mode-html-tag-face
                     web-mode-html-attr-name-face
                     web-mode-constant-face
                     web-mode-doctype-face
                     web-mode-keyword-face
                     web-mode-comment-face ;; focus on get html label right
                     web-mode-function-name-face
                     web-mode-variable-name-face
                     web-mode-css-property-name-face
                     web-mode-css-selector-face
                     web-mode-css-color-face
                     web-mode-type-face
                     web-mode-block-control-face)))
      (setq rlt t))
     ;; check attribute value under certain conditions
     ((memq f '(web-mode-html-attr-value-face))
      (save-excursion
        (search-backward-regexp "=['\"]" (line-beginning-position) t)
        (backward-char)
        (setq rlt (string-match "^\\(value\\|class\\|ng[A-Za-z0-9-]*\\)$"
                                (thing-at-point 'symbol)))))
     ;; finalize the blacklist
     (t
      (setq rlt nil)))
    rlt))
(put 'web-mode 'flyspell-mode-predicate 'web-mode-flyspell-verify)
;; }}
</code></pre>

</div>

<p>
I use <a href="http://web-mode.org/">web-mode</a> for HTML files. The technique applies on other modes (php-mode, html-mode ….) .
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">Don't display doublon (double word) as error</h3>
<div class="outline-text-2" id="text-2">
<p>
Modern CSS frameworks like <a href="http://getbootstrap.com/">Bootstrap</a> make doublon unavoidable. For example, CSS class name <code>btn btn-default</code> contains double word <code>btn</code>.
</p>

<p>
So we need stop displaying doublon as error in HTML,
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">(defvar flyspell-check-doublon t
  "Check doublon (double word) when calling `flyspell-highlight-incorrect-region'.")
 (make-variable-buffer-local 'flyspell-check-doublon)

(defadvice flyspell-highlight-incorrect-region (around flyspell-highlight-incorrect-region-hack activate)
  (if (or flyspell-check-doublon (not (eq 'doublon (ad-get-arg 2))))
      ad-do-it))

(defun web-mode-hook-setup ()
  (flyspell-mode 1)
  (setq flyspell-check-doublon nil))

(add-hook 'web-mode-hook 'web-mode-hook-setup)
</code></pre>

</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">Spell check camel case strings</h3>
<div class="outline-text-2" id="text-3">
<p>
We can check camel cased string/variable/function if and only if <a href="http://aspell.net/">aspell</a> is used.
</p>

<p>
Insert below code into <code>.emacs</code>,
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">;; if (aspell installed) { use aspell}
;; else if (hunspell installed) { use hunspell }
;; whatever spell checker I use, I always use English dictionary
;; I prefer use aspell because:
;; 1. aspell is older
;; 2. looks Kevin Atkinson still get some road map for aspell:
;; @see http://lists.gnu.org/archive/html/aspell-announce/2011-09/msg00000.html
(setq ispell-program-name "aspell"
      ;; force the English dictionary, support Camel Case spelling check (tested with aspell 0.6)
      ispell-extra-args '("--sug-mode=ultra" "--lang=en_US" "--run-together" "--run-together-limit=5" "--run-together-min=2"))
</code></pre>

</div>

<p>
Please note the option <code>--run-together-min=2</code> means the <b>minimum length of each sub-word extracted from camel case string is two</b>. Please run <code>man aspell</code> in shell for details.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h3 id="sec-4">Summary</h3>
<div class="outline-text-2" id="text-4">
<p>
<a href="http://www.emacswiki.org/emacs/FlySpell">EmacsWiki</a> suggests <code>(flyspell-prog-mode)</code> which only checks typo in comments.
</p>

<p>
But as I proved, Emacs gives you full freedom to design a <b>different</b> solution.
</p>

<p>
Screen shot (typos are underscored):
</p>


<div class="figure">
<p><img src="wp-content/spell-check-html-in-emacs.png" alt="spell-check-html-in-emacs.png"></p>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h3 id="sec-5">Javascript and ReactJS setup (OPTIONAL)</h3>
<div class="outline-text-2" id="text-5">
<p>
If you fully understand my previous sections, you don't need read this section.
</p>

<p>
Insert below code into <code>.emacs</code>,
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">(defun js-flyspell-verify ()
  (let* ((f (get-text-property (- (point) 1) 'face)))
    ;; *whitelist*
    ;; only words with following font face will be checked
    (memq f '(js2-function-call
              js2-function-param
              js2-object-property
              font-lock-variable-name-face
              font-lock-string-face
              font-lock-function-name-face))))
(put 'js2-mode 'flyspell-mode-predicate 'js-flyspell-verify)
(put 'rjsx-mode 'flyspell-mode-predicate 'js-flyspell-verify)
</code></pre>

</div>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/how-to-execute-user-program-for-system-v-init-script.html">How to execute user program for System V init script</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-01-18T09:37:10+00:00">2014-01-18 09:37</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/how-to-execute-user-program-for-system-v-init-script.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-execute-user-program-for-system-v-init-script.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/init.html" rel="tag">init</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>Memo for my self. </p>   
<pre class="prettyprint ">

sudo ls -1 /etc/{rc,init}.d/|grep local

# then read the file either rc.local or local
</pre>

<p></p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/notes-on-google-chromes-dev-tool.html">Notes on Google Chrome's dev tool</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-01-13T12:32:00+00:00">2014-01-13 12:32</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/notes-on-google-chromes-dev-tool.html#disqus_thread" data-disqus-identifier="cache/posts/notes-on-google-chromes-dev-tool.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/chrome.html" rel="tag">chrome</a></li>
           <li><a class="tag p-category" href="categories/debug.html" rel="tag">debug</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/google.html" rel="tag">google</a></li>
           <li><a class="tag p-category" href="categories/javascript.html" rel="tag">javascript</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p></p>
<ul>
<li>C-[ or C-] to switch panel </li> <li>C-S-J to toggle dev tools and focus <b>Console panel</b>, see <a href="https://developers.google.com/chrome-developer-tools/docs/commandline-api">command line reference</a> </li> <li>C-S-I to toggle dev tools, then C-o to switch to <b>Sources panel</b> if needed </li> <li>C-S-C to <b>open</b> dev tools and focus on <b>Elements panel</b> </li> <li>See <a href="https://developers.google.com/chrome-developer-tools/docs/shortcuts">https://developers.google.com/chrome-developer-tools/docs/shortcuts</a> for all hot keys </li> <li>See <a href="https://developers.google.com/chrome-developer-tools/docs/javascript-debugging">https://developers.google.com/chrome-developer-tools/docs/javascript-debugging</a> </li> <li>Click <a href="http://javascript-library.googlecode.com/svn/trunk/javascript/goog/demos/hovercard.html">here</a> for test </li> </ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption> <colgroup>
<col class="left">
<col class="left">
</colgroup>
<thead><tr>
<th scope="col" class="left">command in source panel</th>
<th scope="col" class="left">hotkey</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Continue</td>
<td class="left">C-\</td>
</tr>
<tr>
<td class="left">Toggle break point</td>
<td class="left">C-B</td>
</tr>
<tr>
<td class="left">Step over</td>
<td class="left">C-'</td>
</tr>
<tr>
<td class="left">Step into</td>
<td class="left">C-;</td>
</tr>
<tr>
<td class="left">Step out</td>
<td class="left">S-C-;</td>
</tr>
<tr>
<td class="left">Up call stack</td>
<td class="left">C-,</td>
</tr>
<tr>
<td class="left">Down call stack</td>
<td class="left">C-.</td>
</tr>
<tr>
<td class="left">Toggle console view</td>
<td class="left">ESC</td>
</tr>
<tr>
<td class="left">Goto line</td>
<td class="left">C-G</td>
</tr>
<tr>
<td class="left">Goto file</td>
<td class="left">C-P</td>
</tr>
<tr>
<td class="left">Jump to method</td>
<td class="left">S-C-O</td>
</tr>
</tbody>
</table>
<ul>
<li>I don't use hotkey F1~F12 because my windows manager is different from most developers </li> <li>live editing does not work on Chromium 30.0.1599.114 Built on Ubuntu 13.04. Anyway, I don't need this functionality </li> <li>hotkeys of "Continue" button in <b>Sources panel</b> does not work on Chromium 30.0.1599.114 Built on Ubuntu 13.04. </li> <li>"Break on" inspected element is extremely useful </li> </ul>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/my-grub2-configuration.html">My grub2 configuration</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-12-31T19:09:00+00:00">2013-12-31 19:09</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/my-grub2-configuration.html#disqus_thread" data-disqus-identifier="cache/posts/my-grub2-configuration.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/grub.html" rel="tag">grub</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
grub2 configuration                                                        :grub:linux:en:
</p>

<p>
Content of <code>/etc/grub.d/11_windows</code>,
</p>

<div class="org-src-container">

<pre><code class="lang-conf">#!/bin/sh -e
echo "#        Adding Windows GRUB 2 menu"
cat &lt;&lt; EOF
menuentry "Windows XP" {
savedefault
insmod chain
insmod ntfs
set root=(hd0,1)
chainloader +1
}
EOF
</code></pre>

</div>

<p>
/etc/default/grub
</p>

<div class="org-src-container">

<pre><code class="lang-conf"># Copyright 1999-2013 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/sys-boot/grub/files/grub.default-2,v 1.4 2013/09/21 18:10:55 floppym Exp $
#
# To populate all changes in this file you need to regenerate your
# grub configuration file afterwards:
#     'grub2-mkconfig -o /boot/grub/grub.cfg'
#
# See the grub info page for documentation on possible variables and
# their associated values. 

GRUB_DISTRIBUTOR="Gentoo"

GRUB_DEFAULT=saved
GRUB_SAVEDEFAULT=true
GRUB_HIDDEN_TIMEOUT=0
GRUB_HIDDEN_TIMEOUT_QUIET=true
GRUB_TIMEOUT=10

# Append parameters to the linux kernel command line
GRUB_CMDLINE_LINUX="libata.dma=1"

# Append parameters to the linux kernel command line for non-recovery entries
#GRUB_CMDLINE_LINUX_DEFAULT=""

# Uncomment to disable graphical terminal (grub-pc only)
#GRUB_TERMINAL=console

# The resolution used on graphical terminal.
# Note that you can use only modes which your graphic card supports via VBE.
# You can see them in real GRUB with the command `vbeinfo'.
#GRUB_GFXMODE=640x480

# Path to theme spec txt file.
# The starfield is by default provided with use truetype.
# NOTE: when enabling custom theme, ensure you have required font/etc.
#GRUB_THEME="/boot/grub/themes/starfield/theme.txt"

# Background image used on graphical terminal.
# Can be in various bitmap formats.
#GRUB_BACKGROUND="/boot/grub/mybackground.png"

# Uncomment if you don't want GRUB to pass "root=UUID=xxx" parameter to kernel
#GRUB_DISABLE_LINUX_UUID=true

# Uncomment to disable generation of recovery mode menu entries
#GRUB_DISABLE_RECOVERY=true
</code></pre>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/why-emacs-is-better-editor.html">Why Emacs is better editor - a case study for javascript developer</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2013-12-15T22:02:00+00:00">2013-12-15 22:02</time>
</div>
                <div class="stats">
                    
        
    <a href="posts/why-emacs-is-better-editor.html#disqus_thread" data-disqus-identifier="cache/posts/why-emacs-is-better-editor.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/html.html" rel="tag">html</a></li>
           <li><a class="tag p-category" href="categories/javascript.html" rel="tag">javascript</a></li>
           <li><a class="tag p-category" href="categories/js2.html" rel="tag">js2</a></li>
           <li><a class="tag p-category" href="categories/web.html" rel="tag">web</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>
Emacs is better editor - a case study for javascript developer            :en:emacs:web:html:javascript:js2:
</p>

<p>
UPDATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2014-01-15 Wed&gt;</span></span>
</p>

<p>
Let's see an example in real life development.
</p>

<div id="outline-container-sec-1" class="outline-2">

<div class="outline-text-2" id="text-1">
<p>
For people who does not get the key points of this article, here are the points:
</p>
<ul class="org-ul">
<li>Emacs has an embedded <b>javascript interpreter</b> which I extend a little bit.
</li>
<li>Other editors just use external tools or regular expression to do the semantic analysis.
</li>
<li>The difference of above two is bigger than the difference between machine gun and spear.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">Problem</h3>
<div class="outline-text-2" id="text-2">
<p>
I'm maintaining a big javascript file with thousands of lines of legacy code.
</p>

<p>
My most urgent issue is how to list all the functions in that javascript file and jump to the definition of specific function easily.
</p>

<p>
The modern enterprise application usually define the javascript function in some complex data structure. So most editors are not good at listing the functions.
</p>

<p>
To understand what "complex" means, let's check some code from real world application:
</p>
<div class="org-src-container">


<pre><code class="lang-javascript">$(el.completeRegistrationForm).validate({
    ignore: " :hidden",
    rules : {
        password : {
            required : function () { return $(el.password).is(":visible"); }
        },
        accountNumber : {
            required : function () {
                return $(el.accountNumber).is(":visible");
            },
            digits : true
        }
        // ... I skipped next 200 lines which are similar to above lines

    },
    messages : {
        password: {
            required : "Please input a valid password"
        },
        accountNumber: {
            required : "Please provide a valid account number",
            digits : "Please enter only digits",
        }
        // ... I skipped next 200 lines which are similar to above lines
    }
});
</code></pre>

</div>

<p>
Most editors like Sublime Text 3 cannot display the javascript functions with meaningful context in this case. All you can see is only a bunch of functions with name "required".:
<img src="wp-content/sublime-functions.png" alt="sublime-functions.png"></p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">Solution</h3>
<div class="outline-text-2" id="text-3">
<p>
Emacs has a <a href="http://www.emacswiki.org/emacs/Js2Mode">js2-mode</a> which is basically a javascript interpreter written in lisp. It's created by <a href="http://www.emacswiki.org/emacs/SteveYegge">Steve Yegge</a> and now maintained by <a href="https://github.com/mooz/js2-mode">mooz</a>.
</p>

<p>
Since <code>js2-mode</code> is a interpreter, basically it can do anything you want. The key point is to understand the <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree (AST)</a> defined in js2-mode.
</p>

<p>
Here is my patch to make <code>js2-mode</code> display the list of functions with correct context:
</p>

<div class="org-src-container">


<pre><code class="lang-diff">commit 56ed89bf18a6b58fd4620056288ea2ab52bd4d77
Author: Chen Bin &lt;chenbin.sh@gmail.com&gt;
Date:   Sun Dec 15 18:18:06 2013 +1100

    more hint for orphan function

diff --git a/js2-imenu-extras.el b/js2-imenu-extras.el
index e8e15a5..17bf158 100644
--- a/js2-imenu-extras.el
+++ b/js2-imenu-extras.el
@@ -174,6 +174,39 @@ prefix any functions defined inside the IIFE with the module name."
          (js2-imenu-record-module-pattern node)))
        t))))

+(defun js2-imenu-get-parent-keyname-list (node)
+  "get the list of keys of parent of node
+for example, for javascript code, {rules:{ password {required: function(){}}}}
+the return will be '(rules password)."
+  (let ((rlt '())
+        (n node))
+    (while (setq n (js2-imenu-parent-prop-node n))
+      (add-to-list 'rlt (js2-prop-node-name (js2-object-prop-node-left n)))
+      )
+    rlt
+    )
+  )
+
+(defun js2-imenu-parent-prop-node (node)
+  "for javascript code: parent-key-name:{ required:function(){} }
+we need know the  parent-key-name.
+ step1, 'required:function(){}' is the js2-object-prop-node
+ step2, '{ required:function(){} }' is the js2-object-node
+ step3, 'parent-key-name:{ required:function(){} }' is js2-object-prop-node
+"
+  (let (p2 p3)
+    ;; step 2
+    (setq p2 (js2-node-parent node))
+    ;; step 3
+    (when (and p2 (js2-object-node-p p2))
+      (setq p3 (js2-node-parent p2))
+      (if (and p3 (js2-object-prop-node-p p3))
+        p3
+        )
+      )
+    )
+  )
+
 (defun js2-imenu-record-orphan-function (node)
   "Record orphan function when it's the value of NODE.
 NODE must be `js2-object-prop-node'."
@@ -181,10 +214,15 @@ NODE must be `js2-object-prop-node'."
     (let ((fn-node (js2-object-prop-node-right node)))
       (unless (and js2-imenu-function-map
                    (gethash fn-node js2-imenu-function-map))
-        (let ((key-node (js2-object-prop-node-left node)))
-          (js2-record-imenu-entry fn-node
-                                  (list js2-imenu-other-functions-ns
-                                        (js2-prop-node-name key-node))
+        (let ((key-node (js2-object-prop-node-left node))
+              (parent-prop-node (js2-imenu-parent-prop-node node))
+              mylist
+              )
+          (setq mylist (append (js2-imenu-get-parent-keyname-list node)
+                               (list (js2-prop-node-name key-node))
+                               ))
+          (add-to-list 'mylist js2-imenu-other-functions-ns)
+          (js2-record-imenu-entry fn-node mylist
                                   (js2-node-abs-pos key-node)))))))

 (defun js2-imenu-record-module-pattern (node)
</code></pre>

</div>

<p>
I already submitted the patch to mooz so everyone will enjoy this feature in the future.
</p>

<p>
Here is the screen shot of emacs in old js2-mode, the UI is based on <a href="http://www.emacswiki.org/emacs/ImenuMode">Imenu Mode</a> and <a href="https://github.com/emacs-helm/helm">Helm</a>:
<img src="wp-content/emacs-functions.png" alt="emacs-functions.png"></p>

<p>
The screen shot after we applying the above patch: 
<img src="wp-content/emacs-functions-improved.png" alt="emacs-functions-improved.png"></p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h3 id="sec-4">Summary</h3>
<div class="outline-text-2" id="text-4">
<p>
That's an example of beauty of Emacs.
</p>

<p>
It gives you freedom and power. You can base your work on the top geeks like Steve Yegge and mooz. Just a few lines of lisp code to kick ass.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h3 id="sec-5">Update</h3>
<div class="outline-text-2" id="text-5">
<p>
My patch is incorporated into <code>js2-mode</code> since version <code>20140114</code>.
</p>

<p>
After installing <code>js2-mode</code>, you need paste one line setup into your <code>~/.emacs</code>,
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">(js2-imenu-extras-mode)
</code></pre>

</div>

<p>
The UI to display the candidate is from package <a href="https://github.com/emacs-helm/helm">Helm</a>.
</p>

<p>
The <code>Helm</code> version should be <code>20140125.1101</code> or higher, you can install <code>Helm</code> from <a href="http://melpa.milkbox.net/">MELPA</a>.
</p>

<p>
After installing <code>Helm</code>, you can use command <code>M-x helm-imenu</code> to show the list of functions to jump to. Here is the screen shot how I use imenu in my <a href="https://github.com/redguardtoo/hello/raw/master/hello2.js">hello2.js</a>:
</p>


<div class="figure">
<p><img src="wp-content/helm-imenu-and-js2-mode-nq8.png" alt="helm-imenu-and-js2-mode-nq8.png"></p>
</div>

<p>
UPDATE: I suggest using <code>counsel-imenu</code> from <a href="https://github.com/abo-abo/swiper">Counsel</a> instead of <code>Helm</code>.
</p>
</div>
</div>
</div>
            </div>
        </div>
    
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-16.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-14.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="chenbin0";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2017         <a href="mailto:chenbin.sh@gmail.com">Chen Bin</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
         document.addEventListener('DOMContentLoaded', function() {
           var items = document.getElementsByClassName('timeago'), e, pd;
           for (var i = 0; i < items.length; i++) {
             e = items[i];
             pd = moment(new Date(e.getAttribute('datetime')));
             e.innerHTML = pd.fromNow();
             e.setAttribute('title', pd.format('LLLL'));
           }
         });
        </script>
</body>
</html>
