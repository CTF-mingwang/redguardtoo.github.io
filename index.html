<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="description" content="Linux, Programming, Emacs">
    <meta name="viewport" content="width=device-width">
    <title>Chen's blog | Chen's blog</title>

    
            <link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

    
            <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">

      <link rel="canonical" href="http://blog.binchen.org/index.html">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    
<link rel="stylesheet" href="assets/css/highlight/monokai_sublime.css">
<style type="text/css">
td, th {
 border: 1px solid #CCC;
}
th {
 background: #DFDFDF;
 font-weight: bold;
}
td {
 background: #FAFAFA;
 text-align: center;
}
tr:nth-child(even) td { background: #F1F1F1; }
tr:nth-child(odd) td { background: #FEFEFE; }
</style>





</head>
<body>
    <section class="social">
        <ul>
        
            <li><a href="#" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="stories/about.html" title="About me"><i class="icon-user"></i></a></li>
            <li><a href="https://twitter.com/chen_bin" title="My Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="https://github.com/redguardtoo" title="My Github"><i class="icon-github"></i></a></li>

        </ul>
    </section>
    <section class="page-content">
        <div class="content" rel="main">
            
        <div class="post">
            <h1 class="title"><a href="posts/why-people-say-emacs-is-the-best-operating-system.html">Why people say "Emacs is the best operating system"</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2015-02-01T09:40:44+00:00">2015-02-01 09:40</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/why-people-say-emacs-is-the-best-operating-system.html#disqus_thread" data-disqus-identifier="cache/posts/why-people-say-emacs-is-the-best-operating-system.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/font.html" rel="tag">font</a></li>
           <li><a class="tag p-category" href="categories/linux.html" rel="tag">linux</a></li>
           <li><a class="tag p-category" href="categories/terminal.html" rel="tag">terminal</a></li>
           <li><a class="tag p-category" href="categories/terminator.html" rel="tag">terminator</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p>
It's becasue Emacs has great documentation and enough APIs.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h3 id="sec-1">
<span class="section-number-2">1</span> Documentation</h3>
<div class="outline-text-2" id="text-1">
<p>
The quality of documention is the best.
</p>

<p>
It helps me even on non-Emacs stuff.
</p>

<p>
When configuring the font for <a href="http://gnometerminator.blogspot.com/p/introduction.html">Terminator</a> (a terminal emulator) I found its manual is NOT clear. The manual didn't explain what is "Pango font name". After googling, I found the Emacs manual which explained it and also provided related toolchain.
</p>

<p>
For example, "fc-list" is mentioned to list the installed fonts. Since terminal use Mono font, I can type below command:
</p>
<div class="org-src-container">


<pre><code class="lang-bash">
fc-list | grep Mono
</code></pre>

</div>

<p>
The output is like:
</p>

<pre class="example">
/usr/share/fonts/urw-fonts/n022003l.pfb: Nimbus Mono L:style=Regular
/usr/share/fonts/urw-fonts/n022024l.pfb: Nimbus Mono L:style=Bold Oblique
/usr/share/fonts/liberation-fonts/LiberationMono-Regular.ttf: Liberation Mono:style=Regular
/usr/share/fonts/urw-fonts/n022004l.pfb: Nimbus Mono L:style=Bold
/usr/share/fonts/liberation-fonts/LiberationMono-BoldItalic.ttf: Liberation Mono:style=Bold Italic
/usr/share/fonts/liberation-fonts/LiberationMono-Bold.ttf: Liberation Mono:style=Bold
/usr/share/fonts/wqy-zenhei/wqy-zenhei.ttc: 文泉驿等宽正黑,文泉驛等寬正黑,WenQuanYi Zen Hei Mono:style=Medium,中等
/usr/share/fonts/liberation-fonts/LiberationMono-Italic.ttf: Liberation Mono:style=Italic
/usr/share/fonts/urw-fonts/n022023l.pfb: Nimbus Mono L:style=Regular Oblique
</pre>

<p>
Since Emacs manual explains the meaning of output, I know the font name "WenQuanYi Zen Hei Mono" is the key component of "Pango font name"
</p>

<p>
Because the manual also gives the details of other components of "Pango font name", the final "~/.config/terminator/config" is like:
</p>

<div class="org-src-container">

<pre><code class="lang-conf">
[profiles]
  [[default]]
  use_system_font = False
  # @see emacs manual for tools and explanation of font formats
  # https://www.gnu.org/software/emacs/manual/html_node/emacs/GTK-Resource-Basics.html
  # https://www.gnu.org/software/emacs/manual/html_node/emacs/Fonts.html#Fonts
  font =  WenQuanYi Zen Hei Mono 16
</code></pre>

</div>

<p></p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">
<span class="section-number-2">2</span> API</h3>
<div class="outline-text-2" id="text-2">
<p>
I create a new Emacs plugin which lists files whose name containing Chinese characters. At beginning I use Emacs API "find-name-dired". It uses the GNU find as the backend. But there is some integration issue on Linux. Chinese file names are displayed as garbled text in Emacs. I guess there is some decode/encode error between the interaction of Emacs process and GNU find process because Chinese files are fine on OS X.
</p>
<p>
Emacs has enough APIs for anything. After some research I found another pure Lisp version called "find-lisp-find-dired". So problem solved.</p>

<p></p>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/migrate-blog-from-wordpress-into-nikola.html">Migrate blog from wordpress into nikola</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-04-22T09:09:21+00:00">2014-04-22 09:09</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/migrate-blog-from-wordpress-into-nikola.html#disqus_thread" data-disqus-identifier="cache/posts/migrate-blog-from-wordpress-into-nikola.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/blog.html" rel="tag">blog</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/migrate.html" rel="tag">migrate</a></li>
           <li><a class="tag p-category" href="categories/nikola.html" rel="tag">nikola</a></li>
           <li><a class="tag p-category" href="categories/wordpress.html" rel="tag">wordpress</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p>
UPDATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2015-01-31 Sat&gt;</span></span>
</p>

<p>
CREATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2014-04-22&gt;</span></span>
</p>

<p>
Here are the steps. Tested on Cygwin/Mac/Linux.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h3 id="sec-1">
<span class="section-number-2">1</span> Requirements</h3>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre><code class="lang-sh">
# install python2 and make sure sqlite is supported
sudo USE="sqlite" emerge -a =python-2* # Gentoo Linux
</code></pre>

</div>

<p>
Make sure gcc libxslt-devel libxml2-devel zlib-devel installed, especially on cygwin.
See <a href="http://getnikola.com/handbook.html#libxml-libxslt-files-missing-errors">http://getnikola.com/handbook.html#libxml-libxslt-files-missing-errors</a>.
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">
<span class="section-number-2">2</span> Install</h3>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h4 id="sec-2-1">
<span class="section-number-3">2.1</span> Install Nikola</h4>
<div class="outline-text-3" id="text-2-1">
<p>
Please note the package "requests" is required by zen theme, so it's optional.
</p>

<p>
I prefer install packages into my HOME directory because it versatile and safe.
</p>

<p>
For example, "sudo pip install" could <a href="https://forums.gentoo.org/viewtopic-t-1006044-view-next.html?sid=931f7be2c16ac99fd85eb2940c0bf82b">screw up python on Gentoo Linux</a>.
</p>
<div class="org-src-container">


<pre><code class="lang-sh">
# @see http://stackoverflow.com/questions/2915471/install-a-python-package-into-a-different-directory-using-pip
pip install --user markdown webassets nikola requests
export PATH=$PATH:$HOME/.local/bin
</code></pre>

</div>

<p></p>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h4 id="sec-2-2">
<span class="section-number-3">2.2</span> Install theme (OPTIONAL)</h4>
<div class="outline-text-3" id="text-2-2">
<p>
I use zen theme,
</p>
<div class="org-src-container">

<pre><code class="lang-sh">
rm -rf themes/zen/;nikola install_theme zen
# or rm -rf themes/zen/; http_proxy=http://127.0.0.1:8087 nikola install_theme zen at mainland China
</code></pre>

</div>

<p>
Backup you theme under "~/.config/nikola/themes/zen". You won't need above command any more.
</p>

<p></p>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">
<span class="section-number-2">3</span> Usage</h3>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h4 id="sec-3-1">
<span class="section-number-3">3.1</span> Create root directory</h4>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre><code class="lang-sh">
mkdir -p ~/.config/;nikola init "nikola";cd ~/.config/nikola;
</code></pre>

</div>

<p>
Please note `nikola init "nikola"` creates "conf.py" for you. Backup this file and you never need `nikola init`. 
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h4 id="sec-3-2">
<span class="section-number-3">3.2</span> Import old posts and build new site</h4>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre><code class="lang-sh">
nicola import_wordpress my_wordpress_dump.xml
nikola build
</code></pre>

</div>

<p>
The website is create at "~/.config/nikola/output".
</p>

<p></p>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h3 id="sec-4">
<span class="section-number-2">4</span> Tips (OPTIONAL)</h3>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-sec-4-1" class="outline-3">
<h4 id="sec-4-1">
<span class="section-number-3">4.1</span> If wordpress use 3rd parth JS to render code</h4>
<div class="outline-text-3" id="text-4-1">
<p>
Use below command to fix embedded code in HTML files:
</p>
<div class="org-src-container">
<pre><code class="lang-bash">
find -name '*.wp' -exec grep -l "\[sourcecode.*\&lt;diff\&gt;.*\]" {} \; |xargs sed -i 's/\[sourcecode.*\&lt;diff\&gt;.*\]/&lt;pre class="brush: diff;"&gt;/g
find -name '*.wp' -exec grep -l "~~~~~~~~~~~~" {} \;|xargs sed -i "s%~~~~~~~~~~~~%&lt;/pre&gt;%g"
</code></pre>

</div>

<p>
Manually fixed those articles with Chinese titles in url_map.csv
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h4 id="sec-4-2">
<span class="section-number-3">4.2</span> Import comments into Disqus</h4>
<div class="outline-text-3" id="text-4-2">
<p>
<a href="https://disqus.com/">Disqus</a> is a blog comment hosting service.
</p>

<p>
Use below script to fixed the comment dumped from wordpress before importing it into Disqus:
</p>
<div class="org-src-container">


<pre><code class="lang-python">
#!/usr/bin/python
import getopt, sys, csv
def usage():
    print '''
NAME
    fix url mapping when migrate wordpress blog into nikola
Usage
    python fix-url-map.py [options]
'''[1:-1]

if __name__ == '__main__':
    try:
        opts, args = getopt.getopt(sys.argv[1:], "hf:x:", ["help", "file=","xml="])
    except getopt.GetoptError as err:
        # print help information and exit:
        print str(err) # will print something like "option -a not recognized"
        usage()
        sys.exit(2)

    file=""
    xml=""

    for o, a in opts:
        if o in ("-h", "--help"):
            usage()
            sys.exit()
        elif o in ("-f", "--file"):
            file= a
        elif o in ("-x", "--xml"):
            xml=a
        else:
            assert False, "unhandled option"

    with open(xml, 'r') as content_file:
        content = content_file.read()

    with open(file, 'rb') as csvfile:
         spamreader = csv.reader(csvfile, delimiter=',')
         for row in spamreader:
             content=content.replace("&gt;"+row[0]+"&lt;","&gt;"+row[1]+"&lt;")

    print content
</code></pre>

</div>

<p></p>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h4 id="sec-4-3">
<span class="section-number-3">4.3</span> Setup 3rd party JS libraries on new site</h4>
<div class="outline-text-3" id="text-4-3">
<p>
Install syntaxhighlighter and google analytics, insert below code into conf.py:
</p>
<div class="org-src-container">

<pre><code class="lang-python">
BODY_END = """
&lt;script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js'&gt;&lt;/script&gt;
&lt;script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shAutoloader.min.js'&gt;&lt;/script&gt;
&lt;script type='text/javascript'&gt;
function path()
{
  var args = arguments,
      result = [];

  for(var i = 0; i &lt; args.length; i++){
    result.push(args[i].replace('@', '//cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/'));
  }

  return result;
};

SyntaxHighlighter.autoloader.apply(null, path(
  'applescript            @shBrushAppleScript.min.js',
  'actionscript3 as3      @shBrushAS3.min.js',
  'bash shell             @shBrushBash.min.js',
  'coldfusion cf          @shBrushColdFusion.min.js',
  'cpp c c++              @shBrushCpp.min.js',
  'clojure                @shBrushScala.min.js',
  'c# c-sharp csharp      @shBrushCSharp.min.js',
  'css                    @shBrushCss.min.js',
  'delphi pascal          @shBrushDelphi.min.js',
  'diff patch pas         @shBrushDiff.min.js',
  'erl erlang             @shBrushErlang.min.js',
  'groovy                 @shBrushGroovy.min.js',
  'java                   @shBrushJava.min.js',
  'jfx javafx             @shBrushJavaFX.min.js',
  'js jscript javascript  @shBrushJScript.min.js',
  'perl pl                @shBrushPerl.min.js',
  'php                    @shBrushPhp.min.js',
  'text plain             @shBrushPlain.min.js',
  'py python              @shBrushPython.min.js',
  'ruby rails ror rb      @shBrushRuby.min.js',
  'sass scss              @shBrushSass.min.js',
  'scala                  @shBrushScala.min.js',
  'sql                    @shBrushSql.min.js',
  'vb vbnet               @shBrushVb.min.js',
  'xml xhtml xslt html    @shBrushXml.min.js'
));
SyntaxHighlighter.all();
&lt;/script&gt;
&lt;script type='text/javascript'&gt;
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-29850823-2']);
_gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
&lt;/script&gt;
"""

EXTRA_HEAD_DATA = """
&lt;link rel='stylesheet' type='text/css' href='//cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css'&gt;
&lt;link rel='stylesheet' type='text/css' href='//cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCoreEmacs.css'&gt;
"""
</code></pre>

</div>

<p>
In above code, shCoreEmacs.css is the color theme for syntaxhighlighter.
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h4 id="sec-4-4">
<span class="section-number-3">4.4</span> Upload</h4>
<div class="outline-text-3" id="text-4-4">
<p>
I use <a href="https://filezilla-project.org/">FileZilla</a> as a FTP client. <a href="http://www.ncftp.com/">NcFTP</a> is a command line alternative.
</p>

<p>
The best way to upload HTML files is <a href="http://git-scm.com/">Git</a>.</p>
</div>

<p></p>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/what-s-the-best-spell-check-set-up-in-emacs.html">What's the best spell check set up in emacs</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-04-21T08:25:20+00:00">2014-04-21 08:25</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/what-s-the-best-spell-check-set-up-in-emacs.html#disqus_thread" data-disqus-identifier="cache/posts/what-s-the-best-spell-check-set-up-in-emacs.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/aspell.html" rel="tag">aspell</a></li>
           <li><a class="tag p-category" href="categories/check.html" rel="tag">check</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/hunspell.html" rel="tag">hunspell</a></li>
           <li><a class="tag p-category" href="categories/ispell.html" rel="tag">ispell</a></li>
           <li><a class="tag p-category" href="categories/spell.html" rel="tag">spell</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p>
To save your time, I started from conclusion.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h3 id="sec-1">
<span class="section-number-2">1</span> Suggestion for non-programmers</h3>
<div class="outline-text-2" id="text-1">
<p>
Emacs will find the right dictionary by querying your locale.
</p>

<p>
Run command "locale" in your shell to get current locale.
</p>

<p>
If you want to force Emacs use dictionary "en_US", copy below code into your ~/.emacs:
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">
;; find aspell and hunspell automatically
(cond
 ((executable-find "aspell")
  (setq ispell-program-name "aspell")
  (setq ispell-extra-args '("--sug-mode=ultra" "--lang=en_US")))
 ((executable-find "hunspell")
  (setq ispell-program-name "hunspell")
  (setq ispell-extra-args '("-d en_US")))
 )
</code></pre>

</div>

<p>
That's it!
</p>

<p>
Please run command "man aspell" or "man hunspell" in shell if you have more questions. I've nothing more to say.
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">
<span class="section-number-2">2</span> Suggestion for programmers</h3>
<div class="outline-text-2" id="text-2">
<p>
I strongly recommend aspell instead of hunspell (Though hunspell is fine).
</p>

<p>
Please insert below code into your ~/.emacs:
</p>

<div class="org-src-container">


<pre><code class="lang-lisp">
;; if (aspell installed) { use aspell}
;; else if (hunspell installed) { use hunspell }
;; whatever spell checker I use, I always use English dictionary
;; I prefer use aspell because:
;; 1. aspell is older
;; 2. looks Kevin Atkinson still get some road map for aspell:
;; @see http://lists.gnu.org/archive/html/aspell-announce/2011-09/msg00000.html
(defun flyspell-detect-ispell-args (&amp;optional RUN-TOGETHER)
  "if RUN-TOGETHER is true, spell check the CamelCase words"
  (let (args)
    (cond
     ((string-match  "aspell$" ispell-program-name)
      ;; force the English dictionary, support Camel Case spelling check (tested with aspell 0.6)
      (setq args (list "--sug-mode=ultra" "--lang=en_US"))
      (if RUN-TOGETHER
          (setq args (append args '("--run-together" "--run-together-limit=5" "--run-together-min=2")))))
     ((string-match "hunspell$" ispell-program-name)
      (setq args nil)))
    args
    ))

(cond
 ((executable-find "aspell")
  (setq ispell-program-name "aspell"))
 ((executable-find "hunspell")
  (setq ispell-program-name "hunspell")
  ;; just reset dictionary to the safe one "en_US" for hunspell.
  ;; if we need use different dictionary, we specify it in command line arguments
  (setq ispell-local-dictionary "en_US")
  (setq ispell-local-dictionary-alist
        '(("en_US" "[[:alpha:]]" "[^[:alpha:]]" "[']" nil nil nil utf-8))))
 (t (setq ispell-program-name nil)))

;; ispell-cmd-args is useless, it's the list of *extra* arguments we will append to the ispell process when "ispell-word" is called.
;; ispell-extra-args is the command arguments which will *always* be used when start ispell process
(setq ispell-extra-args (flyspell-detect-ispell-args t))
;; (setq ispell-cmd-args (flyspell-detect-ispell-args))
(defadvice ispell-word (around my-ispell-word activate)
  (let ((old-ispell-extra-args ispell-extra-args))
    (ispell-kill-ispell t)
    (setq ispell-extra-args (flyspell-detect-ispell-args))
    ad-do-it
    (setq ispell-extra-args old-ispell-extra-args)
    (ispell-kill-ispell t)
    ))
</code></pre>

</div>

<p>
That's it.
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">
<span class="section-number-2">3</span> Why</h3>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h4 id="sec-3-1">
<span class="section-number-3">3.1</span> Aspell</h4>
<div class="outline-text-3" id="text-3-1">
<p>
apell is recommended because its option "–run-together". That option could spell check the camel case word. Variable name often uses camel case naming convention these days. Read my <a href="http://blog.binchen.org/?p=950">Effective spell check in Emacs</a> for advanced tips on how to use flyspell to check variable names.
</p>

<p>
If Emacs start a aspell process with "–run-together" option, that process is not closed so it can be re-used by other commands.
</p>

<p>
This behaviour will be a problem if you want to let Emacs/aspell correct the typo by running the command "ispell-word" because a apell process with "–run-together" will produce much noise.
</p>

<p>
For example, for a typo "helle" Emacs will give you too many candidates. It's hard to find the desired word "hello":
<img src="wp-content/aspell-camelcase-suggest-nq8.png" alt="aspell-camelcase-suggest-nq8.png">
</p>

<p>
The better solution is before running "M-x ispell-word", we'd better restart a aspell proces without the argument "–run-together".
</p>

<p>
Here is the screen shot after we applying this fix:
<img src="wp-content/aspell-normal-suggest-nq8.png" alt="aspell-normal-suggest-nq8.png">
</p>

<p>
As I mentioned, the global variable "ispell-extra-args" contains arguments Emacs will always append to a spell checker process (aspell or hunspell). That's the only variable you need care about.
</p>

<p>
There is another variable named "ispell-cmd-args". It is actually some <b>extra</b> arguments Emacs could send to an <b>existing</b> spell checker process when you "M-x ispell-word". In my opinion, it's useless. I mention it because the naming are really confusing. "ispell-extra-args" is actually command line arguments the spell checker will always use. The "ispell-cmd-args" are actually the extra arguments will be used in certain cases.
</p>
</div>

<p></p>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h4 id="sec-3-2">
<span class="section-number-3">3.2</span> Hunspell</h4>
<div class="outline-text-3" id="text-3-2">
<p>
I cannot find hunspell option to check camel case words. Please enlighten me if you know the option.
</p>
<p>
Hunspell has some design flaw. It will always check the environment variable LC_ALL, LC_MESSAGES and LANG <b>at first</b> to find the default dictionary unless you specify the dictionary in the command line. If it cannot find the default dictionary, the spell checker process won't start. Aspell does not have this issue, if it cannot find the zh_CN dictionary, it will fall back into English.
</p>

<p>
Specify the ispell-extra-args <b>won't stop hunspell to search for the default dictionary</b> at the beginning.
</p>

<p>
For example, I am a Chinese and my locale is "zh_CN.utf-8". So hunspell will always search the dictionary zh_CN. Even I'm only interested in English spell checking.
</p>

<p>
To specify the dictionary explicitly, I need hack the Emacs code which is kind of mess. Finally, I figure out. It's just several lines of elisp code:
</p>

<div class="org-src-container">

<pre><code class="lang-lisp">
(setq ispell-program-name "hunspell")
(setq ispell-local-dictionary "en_US")
(setq ispell-local-dictionary-alist
      '(("en_US" "[[:alpha:]]" "[^[:alpha:]]" "[']" nil nil nil utf-8)))
</code></pre>

</div>

<p></p>
</div>
</div>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/how-to-embed-button-in-wxdataviewlistctrl.html">How to embed button in wxDataViewListCtrl</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-04-13T15:39:28+00:00">2014-04-13 15:39</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/how-to-embed-button-in-wxdataviewlistctrl.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-embed-button-in-wxdataviewlistctrl.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/c.html" rel="tag">c</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/wxwidgets.html" rel="tag">wxwidgets</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p>
Before creating wxDataViewListCtrl, it's better to detect information about text size so that we can set the column width and height intelligently.
</p>

<p>
Here is the code:
</p>

<div class="org-src-container">

<pre><code class="lang-c">
void GuessRowSize(int* w, int* h) {
    //@see http://sourceforge.net/apps/trac/codelite/browser/trunk/LiteEditor/new_build_tab.cpp?rev=5804

// Determine the row height
    wxBitmap tmpBmp(1, 1);
    wxMemoryDC memDc;
    memDc.SelectObject(tmpBmp);
    wxFont f = wxSystemSettings::GetFont(wxSYS_ANSI_FIXED_FONT);
    int xx, yy;
    memDc.GetTextExtent(wxT("Tp"), &amp;xx, &amp;yy, NULL, NULL, &amp;f);

    //enough height for ICON
    *h=yy&lt;16? 16: yy;

    memDc.GetTextExtent("Wp", &amp;xx, &amp;yy, NULL, NULL, &amp;f);
    *w=xx/2;

    return;
}
wxDataViewListCtrl* ctrl=new wxDataViewListCtrl(parent,-1);
ctrl-&gt;Create(parent,id,wxDefaultPosition,wxDefaultSize);
int w,h;
GuessRowSize(&amp;w,&amp;h);
//hard code width may not be good, may be can use w ,h
AppendTextColumn(_T("Column 1"),wxDATAVIEW_CELL_INERT,200 /*width*/);
//must be called after Create()
ctrl-&gt;SetRowHeight(h+6);


// well I need provide button render by myself
class wxDataViewMyButtonRenderer: public wxDataViewCustomRenderer, public wxTimer
{
public:
    wxDataViewMyButtonRenderer( const wxString &amp;varianttype = wxT("wxString"),
                              int align = wxDVR_DEFAULT_ALIGNMENT );

    virtual bool SetValue( const wxVariant &amp;value );
    virtual bool GetValue( wxVariant &amp;value ) const;

    virtual bool Render( wxRect, wxDC*, int);
    virtual wxSize GetSize() const;
    virtual void Notify();
    void SetParent(GalleryListView*);
    // Implementation only, don't use nor override
    virtual bool ActivateCell(const wxRect&amp; rect,
        wxDataViewModel *model,
        const wxDataViewItem&amp; item,
        unsigned int col,
        const wxMouseEvent *mouseEvent);

private:
    wxString m_value;
    bool m_button_clicked;
    wxRect m_cell_rect;
    GalleryListView* m_parent;

protected:
    DECLARE_DYNAMIC_CLASS_NO_COPY(wxDataViewMyButtonRenderer)
};
</code></pre>

</div>

<p>
When user click one row, the ActivateCell is called, we can use some rect detect algorithm to find if the button rect is clicked.
</p>

<p>
There is no mouse up event handler! So I have to hack, basically start a wxTimer when button clicked and draw the button up effect after about 1 second in Notify(). That's why I ask wxDataViewMyButtonRenderer to inherit from wxTimer.
</p>

<p>
To draw the button up effect, I need ask the parent wxDataViewListCtrl to refresh itself, so that the button's Render() method has a chance to be called. That's why we need SetParent().
</p>

<p>
Here is the part of implementation:
</p>

<div class="org-src-container">

<pre><code class="lang-c">
bool
wxDataViewMyButtonRenderer::ActivateCell(const wxRect&amp; rect,
    wxDataViewModel *model,
    const wxDataViewItem&amp; item,
    unsigned int col,
    const wxMouseEvent *mouseEvent)
{
    wxDataViewListStore* store=(wxDataViewListStore*) model;

    if ( mouseEvent ) {
        if ( !wxRect(GetSize()).Contains(mouseEvent-&gt;GetPosition()) ){
            return false;
        }
        wxVariant item_value_pdf;
        store-&gt;GetValueByRow(item_value_pdf , store-&gt;GetRow(item),0);
        wxVariant item_value_created;
        store-&gt;GetValueByRow(item_value_created , store-&gt;GetRow(item),1);

        m_button_clicked=true;
        m_cell_rect=rect;
    } else {
        wxLogDebug(_T("Sorry, I don't handle keyboard"));
    }

    return true;
}

bool
wxDataViewMyButtonRenderer::Render( wxRect rect, wxDC *dc, int state )
{
    wxLogDebug(_T("Render called"));
    // Ensure that the check boxes always have at least the minimal required
    // size, otherwise DrawCheckBox() doesn't really work well. If this size is
    // greater than the rect size, the checkbox will be truncated but this is a
    // lesser evil.
    wxSize size = rect.GetSize();
    size.IncTo(GetSize());
    rect.SetSize(size);

    // draw button
    if(m_button_clicked==true &amp;&amp; rect.Intersects(m_cell_rect)){
        //draw the button when clicked
        dc-&gt;SetBrush(wxBrush(wxColour(65, 150, 65), wxBRUSHSTYLE_SOLID));
        dc-&gt;SetPen( *wxBLACK_PEN );
        dc-&gt;DrawRectangle(rect);

        // draw button push down effect. since we cannot detect mouse up event, we use
        // timer to draw it
        const int time_to_button_up=350;
        StartOnce(time_to_button_up);
    } else {
        // draw normal button
        dc-&gt;SetBrush(wxBrush(wxColour(84, 174, 84), wxBRUSHSTYLE_SOLID));
        dc-&gt;SetPen( *wxBLACK_PEN );
        dc-&gt;DrawRectangle(rect);

        //draw inner white border
        rect.Deflate(1);
        dc-&gt;SetPen( *wxWHITE_PEN );
        dc-&gt;DrawRectangle(rect);
    }

    dc-&gt;SetTextForeground(*wxWHITE);
    dc-&gt;DrawLabel(m_value,wxRect(dc-&gt;GetTextExtent(m_value)).CentreIn(rect));

    return true;
}
</code></pre>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/popup-function-your-cursor-is-in.html">popup function where your cursor is in</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-04-08T22:59:00+00:00">2014-04-08 22:59</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/popup-function-your-cursor-is-in.html#disqus_thread" data-disqus-identifier="cache/posts/popup-function-your-cursor-is-in.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p>
<a href="http://www.emacswiki.org/emacs/WhichFuncMode">Which Func Mode</a> will display the current function name in the mode line.
</p>

<p>
But I can't use it.
</p>

<p>
It's because I reduce my mode-line into minimum to make it work with my tiny netbook.
</p>

<p>
<a href="http://emacsredux.com/blog/2014/04/05/which-function-mode/">Showing the function in header</a> is also not possible because it conflicts with my color theme.
</p>

<p>
So I choose to display the function name in a popup.
</p>

<p>
Insert below code into ~/.emacs,
</p>

<div class="org-src-container">

<pre><code class="lang-lisp">
(autoload 'which-function "which-func")
(autoload 'popup-tip "popup")

(defun copy-yank-str (msg)
  (kill-new msg)
  (with-temp-buffer
    (insert msg)
    (shell-command-on-region (point-min) (point-max)
                             (cond
                              ((eq system-type 'cygwin) "putclip")
                              ((eq system-type 'darwin) "pbcopy")
                              (t "xsel -ib")
                              ))))

(defun popup-which-function ()
  (interactive)
  (let ((msg (which-function)))
    (popup-tip msg)
    (copy-yank-str msg)
    ))
</code></pre>

</div>

<p>
The extra bonus is "popup-which-function" will also insert the function name into clipboard and kill ring.
</p>

<p>
The above code need package <a href="https://github.com/auto-complete/popup-el">"popup.el"</a> to be installed.
</p>

<p>
Screen shot:
<img src="wp-content/pop-which-func-nq8.png" alt="pop-which-func-nq8.png">
#+image/pop-which-func-nq8.png <img src="http://blog.binchen.org/wp-content/uploads/2014/04/wpid-pop-which-func-nq8.png" alt="wpid-pop-which-func-nq8.png">
</p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/paste-string-from-clipboard-into-minibuffer-in-emacs.html">paste string from clipboard into minibuffer in Emacs</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-04-08T22:17:00+00:00">2014-04-08 22:17</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/paste-string-from-clipboard-into-minibuffer-in-emacs.html#disqus_thread" data-disqus-identifier="cache/posts/paste-string-from-clipboard-into-minibuffer-in-emacs.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/bash.html" rel="tag">bash</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p>
First, I find "Alt-Y" is easier to press when paste string into minibuffer than old "Shift+Insert". "Ctrl-V" is not supported in some terminals.
</p>

<p>
Second, intergrating some command line clipboard tool into Emacs is better than Emacs X clipboard. Command line tool works in any environment. For example, when you log into a remote server with ssh, your local computer could share clipboard with your Emacs in remote shell. Please note in this example, you need using X11 forward over ssh, usually it's already set up on server.
</p>

<p>
Here is the code:
</p>

<div class="org-src-container">

<pre><code class="lang-lisp">
(defun paste-from-x-clipboard()
  (interactive)
  (shell-command
   (cond
    (*cygwin* "getclip")
    (*is-a-mac* "pbpaste")
    (t "xsel -ob")
    )
   1)
  )

(defun my/paste-in-minibuffer ()
  (local-set-key (kbd "M-y") 'paste-from-x-clipboard)
  )

(add-hook 'minibuffer-setup-hook 'my/paste-in-minibuffer)
</code></pre>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/upload-emacs-package-to-marmalade.html">Upload emacs package to marmalade</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-03-28T07:26:01+00:00">2014-03-28 07:26</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/upload-emacs-package-to-marmalade.html#disqus_thread" data-disqus-identifier="cache/posts/upload-emacs-package-to-marmalade.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/marmalade.html" rel="tag">marmalade</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>Thanks to <a href="https://plus.google.com/+SebastianWiesner/posts">Sebastian Wiesner</a> for providing a python script to upload package to <a href="http://marmalade-repo.org/">http://marmalade-repo.org/</a>. </p>    
<pre class="prettyprint ">

sudo pip install requests keyring

curl -L https://raw.githubusercontent.com/lunaryorn/dotfiles/master/emacs/bin/marmalade-upload &gt; ~/bin/marmalade-upload &amp;&amp; chmod +x ~/bin/marmalade-upload

~/bin/marmalade-upload -h # see help
</pre>

<p></p>
<p> Please note if the same version already exists on server, I need delete it before uploading. </p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/use-firefox-in-emacs-way-3.html">Use firefox in Emacs way</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-03-23T20:03:00+00:00">2014-03-23 20:03</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/use-firefox-in-emacs-way-3.html#disqus_thread" data-disqus-identifier="cache/posts/use-firefox-in-emacs-way-3.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
           <li><a class="tag p-category" href="categories/firefox.html" rel="tag">firefox</a></li>
           <li><a class="tag p-category" href="categories/keysnail.html" rel="tag">keysnail</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p>
UPDATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2014-05-20 Tue&gt;</span></span>
</p>

<p>
CREATED: <span class="timestamp-wrapper"><span class="timestamp">&lt;2014-03-23 Sun&gt;</span></span>
</p>

<p>
I use <a href="https://github.com/mooz/keysnail/wiki">keysnail</a>. it's a firefox addon to convert firefox into Emacs.
</p>

<p>
I install keysnail's own plugins "HoK" and "Tanything".
</p>

<p>
Here are the use cases of keysnail.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h3 id="sec-1">
<span class="section-number-2">1</span> Click &amp; Copy the links</h3>
<div class="outline-text-2" id="text-1">
<p>
Install the <a href="https://github.com/mooz/keysnail/wiki/plugin">HoK</a>.
</p>

<p>
Insert below code into ~/.keysnail.js:
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">
hook.setHook("PluginLoaded", function () {
    if (!plugins.hok) return;

    /* HoK 1.3.9+ required */
    plugins.hok.pOptions.selector = plugins.hok.pOptions.selector
    /* feedly */
    + ", *[data-uri]" + ", *[data-selector-toggle]" + ", *[data-page-action]" + ", *[data-app-action]"
    /* google plus */
    + ", *[guidedhelpid]"
    /* twitter */
    + ", *[data-item-count]";
});

key.setGlobalKey(["C-c","C-f"], function (aEvent, aArg) {
        ext.exec("hok-start-foreground-mode", aArg);
}, "Hok - Foreground hint mode", true);

key.setGlobalKey(["C-c","C-b"], function (aEvent, aArg) {
        ext.exec("hok-start-background-mode", aArg);
}, "HoK - Background hint mode", true);

key.setGlobalKey(["C-c","C-y"], function (aEvent, aArg) {
        ext.exec("hok-yank-foreground-mode", aArg);
}, "HoK - Background hint mode", true);

key.setGlobalKey(["C-c","C-;"], function (aEvent, aArg) {
        ext.exec("hok-start-extended-mode", aArg);
}, "HoK - Extented hint mode", true);

key.setGlobalKey(["C-c", "C-e"], function (aEvent, aArg) {
        ext.exec("hok-start-continuous-mode", aArg);
}, "Start continuous HaH", true);
</code></pre>

</div>

<p>
Now I can press "Ctrl-C Ctrl-F" to select the links to click.
</p>

<p>
The links will be highlighted as below screen shot:
<img src="wp-content/keysnail-hok-nq8.png" alt="keysnail-hok-nq8.png">
</p>

<p>
I can press the highlighted hint to click the link.
</p>

<p>
Copy the link into clipboard is also easy. I press "C-c C-y" and similar UI will be displayed. I press the hint above to finish the operation.
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h3 id="sec-2">
<span class="section-number-2">2</span> Copy the text of link</h3>
<div class="outline-text-2" id="text-2">
<p>
This is my most favorite tool. As a developer, I need copy text of links from bug tracking software and paste it into git commit message frequently.
</p>

<p>
That's error prone because:
</p>
<ol class="org-ol">
<li>The links are cluttered so it's hard to select the text of the link without actually clicking the link. 
</li>
<li>The web UI of bug tracing system may use some CSS magic. Only part of the text of links are displayed. So it's impossible to select the text at all. For example, <a href="https://www.atlassian.com/software/jira">JIRA</a> will display file name of "Screenshot 03/05/2014-193024.png" as "Screenshot 03/05/2014…png".
</li>
</ol>

<p>
If you use keysnail+HOK, it's as simple as press hot key "C-c ; Y". That's it!
</p>
</div>

</div>

<div id="outline-container-sec-3" class="outline-2">
<h3 id="sec-3">
<span class="section-number-2">3</span> Switch tab</h3>
<div class="outline-text-2" id="text-3">
<p>
Install the <a href="https://github.com/mooz/keysnail/wiki/plugin">Tanything</a>.
</p>

<p>
Insert below code into ~/.keysnail.js:
</p>
<div class="org-src-container">


<pre><code class="lang-lisp">
key.setGlobalKey(["C-c", "C-a"], function (ev, arg) {
  ext.exec("tanything", arg);
}, "view all tabs", true);
</code></pre>

</div>

<p>
Press "Ctrl-C Ctrl-A", you got below UI:
<img src="wp-content/keysnail-tanything-nq8.png" alt="keysnail-tanything-nq8.png">
</p>

<p>
Tanything will locate the tab by finding match in web page's title or URL.
</p>

<p></p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h3 id="sec-4">
<span class="section-number-2">4</span> My keysnail set up</h3>
<div class="outline-text-2" id="text-4">
<p>
You can download my ~/.keysnail.js from <a href="https://gist.githubusercontent.com/redguardtoo/003ac86d4c11b70b870a/raw/32356b071785248c0ff56d9c5896168263efefdd/.keysnail.js">HERE</a>.
</p>

<p>
#+image/keysnail-hok-nq8.png <img src="http://blog.binchen.org/wp-content/uploads/2014/03/wpid-keysnail-hok-nq8.png" alt="wpid-keysnail-hok-nq8.png">
#+image/keysnail-tanything-nq8.png <img src="http://blog.binchen.org/wp-content/uploads/2014/03/keysnail-tanything-nq8.png" alt="keysnail-tanything-nq8.png"></p>
</div>

</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/debug-emacs-lisp-code-the-hard-way.html">Debug Emacs Lisp code the hard way</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-03-19T19:45:00+00:00">2014-03-19 19:45</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/debug-emacs-lisp-code-the-hard-way.html#disqus_thread" data-disqus-identifier="cache/posts/debug-emacs-lisp-code-the-hard-way.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/debug.html" rel="tag">debug</a></li>
           <li><a class="tag p-category" href="categories/elisp.html" rel="tag">elisp</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p></p>
<p>I <a href="https://github.com/emacs-helm/helm/issues/448">met some issue</a> when using helm several days ago. </p> <p> With the help from Michael Heerdegen, I can locate the line error message is dumped. </p> <p> But the problem is I cannot get the backtrace at all. </p> <p> So I insert some <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Internals-of-Debugger.html">backtrace printing code</a> above that line and "M-x eval-buffer": </p>   
<pre class="prettyprint ">

(with-output-to-temp-buffer "backtrace-output"
  (let ((var 1))
    (save-excursion
      (setq var (eval '(progn
                         (1+ var)
                         (list 'testing (backtrace))))))))
</pre>

<p></p>
<p> It turns out that some third party package I installed changes the emacs variable "display-buffer-function". I guess that's why the backtrace is blocked. Because backtrace is usually dumped into a backtrace buffer. And backtrace buffer's is actually influenced by the variable. </p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/how-to-use-ctags-in-emacs-effectively-3.html">How to use ctags in Emacs effectively</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-03-11T18:52:00+00:00">2014-03-11 18:52</time>
                </div>
                <div class="stats">
                    
        
    <a href="posts/how-to-use-ctags-in-emacs-effectively-3.html#disqus_thread" data-disqus-identifier="cache/posts/how-to-use-ctags-in-emacs-effectively-3.html">Comments</a>


                </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/ctags.html" rel="tag">ctags</a></li>
           <li><a class="tag p-category" href="categories/emacs.html" rel="tag">emacs</a></li>
           <li><a class="tag p-category" href="categories/en.html" rel="tag">en</a></li>
        </ul>
        </div>

            </div>
            <div class="body">
                <div>
<p></p>
<p><a href="http://ctags.sourceforge.net/">Exuberant Ctags</a> is a code navigation tool. It supports many language and could be integrated into Emacs well. </p> <p> Please read <a href="http://www.emacswiki.org/emacs/BuildTags">EmacsWiki</a> for basic usage. </p> <p> I will talk about how I manage my ctags. </p> <p> Basically ctags will produce a index file with file name TAGS. The full path of TAGS will be stored in a global list "tags-table-list". </p> <p> An example of tags-table-list: </p>
<pre class="prettyprint ">
(setq tags-table-list '("~/wxWidgets-master/TAGS" "~/projs/Loris/src/desktop/TAGS"))
</pre>

<p></p>
<p> Every time we you "M-x find-tag", the TAGS file in above list will be read from the scratch to locate the definition of the symbol under cursor. </p> <p> Here is my strategy to manage TAGS <b>automatically</b>: </p>
<ul> <li>I hard coded full path of TAGS in .emacs because I usually don't change project path. </li> <li>In major mode hook like c++-mode-hook or js2-mode-hook I will check the directory path of current file. If it contains certain string, I suppose the file belong to certain project. </li> <li>Then I will create TAGS for that project if needed </li> <li>Every time when I save the file, I may update TAGS according to the value of tags-table-list. </li> </ul>   <p> Here is the code: </p>
<pre class="prettyprint lang-lisp">
(defun my-project-name-contains-substring (REGEX)
  (let ((dir (if (buffer-file-name)
                 (file-name-directory (buffer-file-name))
               "")))
    (string-match-p REGEX dir)))

(defun my-create-tags-if-needed (SRC-DIR &amp;optional FORCE)
  "return the full path of tags file"
  (let ((dir (file-name-as-directory (file-truename SRC-DIR)) )
       file)
    (setq file (concat dir "TAGS"))
    (when (or FORCE (not (file-exists-p file)))
      (message "Creating TAGS in %s ..." dir)
      (shell-command
       (format "ctags -f %s -e -R %s" file dir))
      )
    file
    ))

(defvar my-tags-updated-time nil)

(defun my-update-tags ()
  (interactive)
  "check the tags in tags-table-list and re-create it"
  (dolist (tag tags-table-list)
    (my-create-tags-if-needed (file-name-directory tag) t)
    ))

(defun my-auto-update-tags-when-save ()
  (interactive)
  (cond
   ((not my-tags-updated-time)
    (setq my-tags-updated-time (current-time)))
   ((&lt; (- (float-time (current-time)) (float-time my-tags-updated-time)) 300)
    ;; &lt; 300 seconds
    ;; do nothing
    )
   (t
    (setq my-tags-updated-time (current-time))
    (my-update-tags)
    (message "updated tags after %d seconds." (- (float-time (current-time))  (float-time my-tags-updated-time)))
    )
   ))

(defun my-setup-develop-environment ()
    (when (my-project-name-contains-substring "Loris")
      (cond
       ((my-project-name-contains-substring "src/desktop")
        ;; C++ project don't need html tags
        (setq tags-table-list (list
                               (my-create-tags-if-needed
                                (concat (file-name-as-directory (getenv "WXWIN")) "include"))
                               (my-create-tags-if-needed "~/projs/Loris/loris/src/desktop")))
        )
       ((my-project-name-contains-substring "src/html")
        ;; html project donot need C++ tags
        (setq tags-table-list (list (my-create-tags-if-needed "~/projs/Loris/loris/src/html")))
        ))))

(add-hook 'after-save-hook 'my-auto-update-tags-when-save)
(add-hook 'js2-mode-hook 'my-setup-develop-environment)
(add-hook 'web-mode-hook 'my-setup-develop-environment)
(add-hook 'c++-mode-hook 'my-setup-develop-environment)
(add-hook 'c-mode-hook 'my-setup-develop-environment)
</pre>

<p></p>
<p> UPDATE: There is some discussion at <a href="https://plus.google.com/110954683162859211810/posts/NsdzvywuoX3">Google Plus</a> about using ctags. Kaushal Modi recommended three emacs plugins: </p>
<ol> <li>ctags-update </li> <li>etags-table </li> <li>etags-select </li> </ol>   <p> I tried these three plugins. ctags-update and etags-table duplicate my above elisp code. I prefer my own code because it's simpler and totally controllable. For example, the fact that I need only care about <b>only one global variable tags-table-list</b> makes my code shorter. </p> <p> But I do like etags-select, it provide better UI for finding tag and I will use it from now on. </p>
</div>
            </div>
        </div>
    
        <nav class="postindexpager">
        <ul class="pager">
            <li class="next">
                <a href="index-17.html" rel="next">Older posts</a>
            </li>
        </ul>
        </nav>

    
        
       <script>var disqus_shortname="chenbin0";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>


    


             
        <footer id="footer" role="contentinfo">
            <p>Contents © 2015         <a href="mailto:chenbin.sh@gmail.com">Chen Bin</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>

        </div>
    </section>
    
<script type="text/javascript">
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\[").replace(/[\]]/, "\]");
    var regex = new RegExp("[\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

var urlMap={
695:'/posts/australia-food-brands.html',
694:'/posts/hua-shen-jiang-len-mian-zuo-fa.html',
512:'/posts/moving-focus-and-buffer-between-emacs-window.html',
357:'/posts/how-to-configure-yasnippet-0-7-0-and-use-it-with-auto-complete-mode.html',
755:'/posts/niu-rou-mian-zuo-fa.html',
750:'/posts/how-to-manage-emacs-packages.html',
664:'/posts/elisp-code-copy-full-path-of-current-file-into-os-clipboard-and-yank-ring.html',
758:'/posts/nan-gua-zhou-zuo-fa.html',
214:'/posts/wei-shen-men-chen-xu-yaun-chuang-ye-de-xiao-shi-gong-zi-shi-1000yuan-xiao-shi.html',
1088:'/posts/use-firefox-in-emacs-way-3.html',
198:'/posts/tui-jian-hao-shu-enterprise-rails.html',
825:'/posts/matthew-keeler-video-tutorial-on-org-mode-in-emacs.html',
823:'/posts/one-liner-to-load-m3u-into-mpd.html',
636:'/posts/set-up-nfs-server-on-archlinux.html',
191:'/posts/pin-gu-le-emacs-xia-zhi-chi-intellisense-de-ji-ge-fang-an.html',
291:'/posts/chu-xue-zhe-shi-yong-emacs-de-nan-dian.html',
847:'/posts/how-to-use-git-effectively.html',
619:'/posts/an-example-to-abuse-the-git-merge.html',
596:'/posts/i-became-a-true-emacs-geek-when-i-publicized-my-emacs-d-at-github-com.html',
507:'/posts/commentuncomment-line-is-easy-in-emacs.html',
748:'/posts/use-git-send-email-at-ubuntu.html',
502:'http://blog.binchen.rg/posts/fa-biao-yi-nian-chen-wei-emacs-gao-shou-man-yi-zhou-nian-de-gan-wu.html',
742:'/posts/one-liner-bash-to-createupdate-playlist-for-mpd.html',
739:'/posts/how-to-install-emacs-source-code-under-ubuntu.html',
139:'/posts/mysqldump-for-sqlite3.html',
222:'/posts/clean-up-emacs-mode-line-for-tiny-netbook.html',
345:'/posts/zai-wo-de-osx-shang-wei-heroku-kai-fa-rails-chen-xu.html',
884:'/posts/memo-on-upgrading-archlinux.html',
341:'/posts/zhen-dui-ruby-on-rails-kai-fa-de-emacs-cha-jian.html',
835:'/posts/copy-file-name-or-full-path-of-file-in-emacs-dired-buffer-into-system-clipboard.html',
48:'/posts/jian-chi-shi-yong-gnu-screen.html',
832:'/posts/fan-qie-ji-dan-tang-zuo-fa.html',
181:'/posts/my-herbstluftwm-configuration.html',
1124:'/stories/test.html',
589:'/posts/the-reliable-way-to-access-system-clipboard-from-emacs.html',
1105:'/posts/popup-function-your-cursor-is-in.html',
424:'/posts/how-to-use-ftp-in-emacs.html',
580:'/posts/how-to-write-javascripthtml-code-quickly.html',
1128:'/stories/test-my-wordpress.html',
537:'/posts/my-work-flow-to-debug-emacs-plugin.html',
896:'/posts/why-some-systemd-service-on-archlinux-does-not-work.html',
111:'/posts/perforce-tip-how-to-apply-my-default-change-to-the-release-branch.html',
890:'/posts/hao-you-shen-cai-zuo-fa.html',
123:'/posts/my-emacs-configuration.html',
1065:'/posts/debug-emacs-lisp-code-the-hard-way.html',
803:'/posts/xiang-gu-shen-gun-niu-rou-wo-dan-zhou-zuo-fa.html',
5:'/stories/about.html',
692:'/posts/find-which-package-contains-a-file.html',
430:'/posts/my-personal-emacs-customization-custom-el.html',
436:'/posts/how-to-manage-and-use-tags-file-of-third-party-libraries-in-emacs.html',
1103:'/posts/paste-string-from-clipboard-into-minibuffer-in-emacs.html',
735:'/posts/how-to-avoid-ris-when-using-emacs-by-re-assigning-hotkeys-2.html',
730:'/posts/how-to-get-email-from-exchange-server-without-outlook.html',
1016:'/posts/one-liner-to-download-and-extract-emacs-lisp-source-code.html',
245:'/posts/always-turn-on-fpermissive-for-gcc-4-6.html',
924:'/posts/notes-on-google-chromes-dev-tool.html',
947:'/posts/how-to-execute-user-program-for-system-v-init-script.html',
248:'/posts/hao-yong-de-ti-gao-shen-chan-li-de-firefox-cha-jian-leechblock.html',
403:'/posts/notes-on-using-gnus.html',
329:'/posts/guan-yu-yi-nian-chen-wei-emacs-gao-shou-yi-wen-de-da-yi.html',
485:'/posts/import-gmail-contacts-into-bbdb.html',
525:'/posts/start-wxwidgets-programming-on-linux.html',
524:'/posts/notes-to-install-gentoo-linux.html',
488:'/posts/simplest-workflow-on-email-git-commit-in-emacs-no-magit-needed.html',
521:'/posts/find-files-provided-by-the-installed-package.html',
484:'/posts/use-emacs-keyboard-layout-under-archlinux-console-linuxemacsconsoleen.html',
22:'/posts/yong-org2blog-emacs-fa-biao-bo-ke.html',
950:'/posts/effective-spell-check-in-emacs.html',
1029:'/posts/how-to-adapt-my-work-style-to-the-employers-standard-in-emacs.html',
28:'/posts/yi-bu-wu-liao-de-zhen-zhi-xuan-chuan-pian.html',
1118:'/posts/how-to-embed-button-in-wxdataviewlistctrl.html',
773:'/posts/ku-gua-hu-luo-bo-chao-ji-dan-zuo-fa.html',
640:'/posts/install-google-talk-plugin-64bit-on-gentoo-linux.html',
583:'/posts/how-to-refactorrename-a-variable-name-in-a-function-efficiently.html',
644:'/posts/shi-mian-yu-du-tang-shao-fa.html',
818:'/posts/toggle-full-view-of-window-in-emacs.html',
816:'/posts/the-minimum-packages-to-install-for-front-end-development-on-linux.html',
812:'/posts/use-gnus-to-apply-patch-sent-by-git-send-email.html',
791:'/posts/install-gitso-v0-6-on-gentoo-linux.html',
256:'/posts/start-wxwdigets-programming-on-windows.html',
398:'/posts/the-latest-version-of-yasnippet-is-not-compatible-with-auto-complete-enemacsyasnippetauto-complete.html',
377:'/posts/my-git-alias-in-bashrc.html',
395:'/posts/why-facebook-app-for-android-pad-sucks.html',
390:'/posts/python-code-to-migrate-the-mysql-database-enmysqldatabasepython.html',
314:'/posts/it-chuang-ye-de-bei-can-gu-shi.html',
492:'/posts/open-url-in-emacs-with-external-browser.html',
375:'/posts/emacs-zhong-de-wan-mei-duo-chuang-kou-cao-zuo.html',
553:'/posts/how-to-use-yasnippets-to-produce-email-templates-in-emacs.html',
319:'/posts/emacs-zen-yang-gai-bian-le-wo-de-ren-shen.html',
1002:'/posts/my-answer-to-what-are-some-must-have-emacs-additions-on-quora-com.html',
30:'/posts/dropbox-hen-you-chuang-yi.html',
31:'/posts/perl-code-to-change-ip.html',
38:'/posts/geek-chang-yong-ruan-jian-qin-dan.html',
651:'/posts/how-to-use-terminal-in-emacs-effectively.html',
650:'/posts/my-git-set-up.html',
653:'/posts/how-to-do-the-screen-cast-in-linux.html',
655:'/posts/poor-mans-github.html',
654:'/posts/fan-qie-chao-dan-de-zuo-fa.html',
710:'/posts/the-power-of-git-command-line-interface-4.html',
1006:'/posts/code-rush.html',
866:'/posts/how-to-take-screen-shot-for-business-people-efficiently-in-emacs.html',
864:'/posts/how-to-use-flyspell-in-web-mode.html',
1041:'/posts/how-to-use-org2blog-effectively-as-a-programmer.html',
260:'/posts/the-most-important-features-of-midnight-commander-mc.html',
264:'/posts/copypaste-in-emacs.html',
669:'/posts/hei-mu-er-chao-dan-de-zuo-fa.html',
266:'/posts/hotkeys-for-moving-windows-in-emacs.html',
268:'/posts/yi-nian-cheng-wei-emacs-gao-shou-xiang-shen-yi-yang-shi-yong-bian-ji-qi.html',
666:'/posts/666.html',
173:'/posts/emacs-gdbgud-hotkeys.html',
175:'/posts/gitorious-is-useless.html',
303:'/posts/the-most-elegant-wordpress-theme-for-geeks.html',
901:'/posts/why-emacs-is-better-editor.html',
307:'/posts/fasd-make-me-10x-more-produtive-under-shell.html',
789:'/posts/han-guo-da-jiang-tang-zuo-fa.html',
1047:'/posts/hack-wordpress-php-and-make-cdnjs-com-host-js.html',
543:'/posts/convert-multiple-line-into-one-big-string-in-emacs.html',
542:'/posts/how-to-manage-my-software-configuration-at-github.html',
545:'/posts/make-emacs-support-auto-completion-for-cmake.html',
782:'/posts/how-to-use-expand-region-efficiently.html',
1057:'/posts/how-to-use-ctags-in-emacs-effectively-3.html',
575:'/posts/the-most-efficient-way-to-git-add-file-in-dired-mode-emacsendiredgit.html',
979:'/posts/notes-on-set-up-nfs-on-archlinux.html',
797:'/posts/use-org2blog-to-share-blog-efficiently.html',
467:'/posts/toggle-http-proxy-in-emacs-w3m.html',
464:'/posts/emacs-lisp-bin-bu-nan-xue.html',
462:'/posts/use-popfile-at-linux.html',
877:'/posts/notes-on-upgrading-gentoo-linux.html',
166:'/posts/zhan-li-bian-chen-de-fu-zuo-yong.html',
679:'/posts/hu-luo-bo-zhou-zuo-fa.html',
93:'/posts/one-line-linux-cli-to-remove-span-tag.html',
373:'/posts/convert-tex-to-pdf.html',
371:'/posts/install-perl-module-through-source-package-on-cygwin-by-using-cpanm-2.html',
574:'/posts/how-to-split-album-into-different-flac-and-tag-them-under-gentoo-linux.html',
332:'/posts/shi-yong-bootstrap-wen-zhang-de-xiao-jie.html',
570:'/posts/the-minimum-emacs-for-debug-purpose.html',
279:'/posts/how-to-debug-gtk-warning.html',
277:'/posts/notes-for-js3-mode-in-emacs.html',
668:'/posts/huang-jin-suan-tou-ji-tang-zuo-fa.html',
275:'/posts/tips-for-debug-c-code-in-emacs.html',
18:'/posts/hello-word.html',
170:'/posts/sample-python-code-to-resize-image.html',
762:'/posts/my-salad.html',
840:'/posts/san-wen-yu-dun-dou-fu-zuo-fa.html',
478:'/posts/search-the-word-under-cursor-in-stackoverflow-com-and-google-code-search.html',
775:'/posts/navigateselect-html-tags-in-emacs.html',
1021:'/posts/my-answer-to-how-do-you-use-emacs-without-a-directory-tree-on-the-side-of-the-editor-on-quora-com.html',
965:'/posts/git-merge-in-command-line.html',
963:'/posts/switch-input-method-in-evil-mode.html',
381:'/posts/emacs-zhong-de-zi-dong-wan-chen-wan-quan-zhi-nan.html',
728:'/posts/qin-jiao-chao-ji-rou-zuo-fa.html',
686:'/posts/mo-gu-ji-rou-yi-da-li-mian-zuo-fa.html',
110:'/posts/multiple-ssh-private-keys.html',
366:'/posts/install-perl-module-through-source-package-on-cygwin-by-using-cpanm.html',
363:'/posts/note-on-emacs-chat-between-john-wiegley-and-sacha-chua.html',
118:'/posts/you-yong-de-emacs-kuai-jie-jian.html',
368:'/posts/how-to-convert-org-to-pdf.html',
689:'/posts/nai-you-bao-yu-gu.html',
566:'/posts/how-to-use-keyboard-to-navigate-feedly-com.html',
987:'/posts/how-to-do-htmljavascript-repl-read-eval-print-loop-with-no-server-set-up-2.html',
201:'/posts/ncdu-best-disk-usage-analyzer-under-linux.html',
1093:'/posts/upload-emacs-package-to-marmalade.html',
62:'/posts/yong-mintty-zuo-wei-cyginw-de-console.html',
87:'/posts/linux-zhuo-mian-shi-yong-zhi-dao.html',
918:'/posts/my-grub2-configuration.html',
281:'/posts/zhen-que-de-tou-bu-bao-jian.html',
765:'/posts/dou-ban-jiang-gai-jiao-fan-zuo-fa.html',
856:'/posts/suan-miao-chao-niu-rou-zuo-fa.html',
1012:'/posts/add-current-directory-into-load-path-in-emacs.html',
769:'/posts/take-bavarian-tasting-platter-at-bavarian-bier-cafe-parramatta.html',
600:'/posts/open-readme-under-git-root-directory-in-emacs.html',
601:'/posts/use-vimdiff-to-resolve-git-merge-conflicts-effectively.html'
};

var postId=parseInt(getParameterByName('p'),10);
if(postId>0 && urlMap[postId]) {
    window.location=urlMap[postId];
}
</script>
<script type="text/javascript" src="assets/js/highlight.pack.js"></script>
<script type="text/javascript">
hljs.initHighlightingOnLoad();
// google analytics setup
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-29850823-2']);
_gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script>

    
    
            <script src="assets/js/all-nocdn.js" type="text/javascript"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    
        <script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
    
</body>
</html>
