<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>Chen's blog (scm)</title><link>http://blog.binchen.org/</link><description></description><atom:link href="http://blog.binchen.org/categories/scm.xml" type="application/rss+xml" rel="self"></atom:link><language>en</language><lastBuildDate>Sun, 07 Dec 2014 23:12:03 GMT</lastBuildDate><generator>http://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Perforce Tip: how to apply my default change to the release branch</title><link>http://blog.binchen.org/posts/perforce-tip-how-to-apply-my-default-change-to-the-release-branch.html</link><dc:creator>Chen Bin</dc:creator><description>&lt;div&gt;&lt;p&gt;&lt;/p&gt;&lt;div id="table-of-contents"&gt; &lt;h3&gt;Table of Contents&lt;/h3&gt; &lt;div id="text-table-of-contents"&gt; &lt;ul&gt; &lt;li&gt;&lt;a href="http://blog.binchen.org/posts/perforce-tip-how-to-apply-my-default-change-to-the-release-branch.html#sec-1"&gt;1 Reasons I need this hack&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="http://blog.binchen.org/posts/perforce-tip-how-to-apply-my-default-change-to-the-release-branch.html#sec-2"&gt;2 How to?&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/div&gt;  &lt;div id="outline-container-1" class="outline-3"&gt; &lt;h4 id="sec-1"&gt;Reasons I need this hack&lt;/h4&gt; &lt;div class="outline-text-3" id="text-1"&gt;  &lt;ul&gt; &lt;li&gt;Our current project used mix platforms (WIN64/Linux64), so the file path contains backward slash &lt;code&gt;\&lt;/code&gt;. &lt;/li&gt; &lt;li&gt;My p4 CLI program is from Windows installer because Cygwin version has the slash issue. &lt;/li&gt; &lt;li&gt;Windows version of p4 has no such issue under Cygwin if we only feed it relative path. &lt;/li&gt; &lt;/ul&gt;  &lt;/div&gt;  &lt;/div&gt;  &lt;div id="outline-container-2" class="outline-3"&gt; &lt;h4 id="sec-2"&gt;How to?&lt;/h4&gt; &lt;div class="outline-text-3" id="text-2"&gt;  &lt;p&gt;Create the patch, &lt;/p&gt;   &lt;pre class="src src-sh"&gt;p4 diff -du -db main-branch/... &amp;gt; ~/mywork.patch
&lt;/pre&gt;   &lt;p&gt; Go to the work directory of release branch. &lt;/p&gt;   &lt;pre class="src src-sh"&gt;&lt;span style="color: #c397d8;"&gt;cd&lt;/span&gt; dir-release-branch/
&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;   &lt;p&gt; &lt;code&gt;p4 edit' the files I want to patch under release branch. Please note, &amp;lt;/p&amp;gt;&amp;lt;ul&amp;gt; &amp;lt;li&amp;gt;&lt;/code&gt;lsdiff' is from the package &lt;code&gt;patchutils'. &amp;lt;/li&amp;gt; &amp;lt;li&amp;gt;&lt;/code&gt;nosl' will strip the backward/forward slashes. It's written by me.       &lt;/p&gt;&lt;pre class="src src-sh"&gt;cat ~/mywork.patch|lsdiff|nosl 5|p4 -x - edit
&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;   &lt;p&gt; Patch the files and DONE! &lt;/p&gt;   &lt;pre class="src src-sh"&gt;patch -p5 &amp;lt; ~/mywork.patch
&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;   &lt;p&gt; Here is the source code of nosl. I put it in my .bashrc &lt;/p&gt;   &lt;pre class="src src-sh"&gt;&lt;span style="color: #7aa6da;"&gt;nosl&lt;/span&gt; ()
&lt;p&gt;{
    &lt;span style="color: #b9ca4a;"&gt;if&lt;/span&gt; [ -z &lt;span style="color: #70c0b1;"&gt;"$1"&lt;/span&gt; ]; &lt;span style="color: #b9ca4a;"&gt;then&lt;/span&gt;
        &lt;span style="color: #c397d8;"&gt;echo&lt;/span&gt; &lt;span style="color: #70c0b1;"&gt;"Usage: echo /hello/world|nosl num"&lt;/span&gt;;
        &lt;span style="color: #c397d8;"&gt;echo&lt;/span&gt; &lt;span style="color: #70c0b1;"&gt;"strip num leading slashes"&lt;/span&gt;;
    &lt;span style="color: #b9ca4a;"&gt;else&lt;/span&gt;
        perl -pe &lt;span style="color: #70c0b1;"&gt;"\$n=$1;while(\$n&amp;gt;0){ \$_=~ s/[^\\\/]*[\\\/]+//;\$n--; }"&lt;/span&gt;;
    &lt;span style="color: #b9ca4a;"&gt;fi&lt;/span&gt;
}&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;   &lt;p&gt; BTW, you could avoid all the trouble of &lt;a href="http://www.perforce.com"&gt;Perforce&lt;/a&gt; by switching to &lt;a href="http://git-scm.com"&gt;Git&lt;/a&gt;. &lt;/p&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;</description><category>emacs</category><category>en</category><category>linux</category><category>perforce</category><category>scm</category><guid>http://blog.binchen.org/posts/perforce-tip-how-to-apply-my-default-change-to-the-release-branch.html</guid><pubDate>Fri, 24 Jun 2011 19:15:00 GMT</pubDate></item></channel></rss>