<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>Chen's blog (mode)</title><link>http://blog.binchen.org/</link><description></description><atom:link href="http://blog.binchen.org/categories/mode.xml" type="application/rss+xml" rel="self"></atom:link><language>en</language><lastBuildDate>Fri, 30 Oct 2015 00:35:55 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Use js2-mode to print json path</title><link>http://blog.binchen.org/posts/use-js2-mode-to-print-json-path.html</link><dc:creator>Chen Bin</dc:creator><description>&lt;div&gt;&lt;p&gt;These days most web applications are based on RESTful service.
&lt;/p&gt;

&lt;p&gt;
So javascript developers have to deal with JSON frequently.
&lt;/p&gt;

&lt;p&gt;
When working on JSON, the most boring and error prone task is to get the full path of specific field.
&lt;/p&gt;

&lt;p&gt;
For example, given the JSON response like:
&lt;/p&gt;

&lt;pre&gt;&lt;code class="lang-javascript"&gt;{
  key1: {
    subkey1: {
      arr1: [{ key3: 'hello'}]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;
The developer need figure out the full path of "key3" which is "&lt;code&gt;key1.subkey1.arr1[0].key3&lt;/code&gt;".
&lt;/p&gt;

&lt;p&gt;
My solution is to take advantage of AST created by &lt;a href="https://github.com/mooz/js2-mode"&gt;js2-mode&lt;/a&gt;.
&lt;/p&gt;

&lt;p&gt;
&lt;b&gt;Step 1&lt;/b&gt;, insert below code into ~/.emacs,
&lt;/p&gt;

&lt;pre&gt;&lt;code class="lang-lisp"&gt;(defun js2-print-json-path ()
  "Print the path to the JSON value under point, and save it in the kill ring."
  (interactive)
  (let (next-node node-type rlt key-name)
    (setq next-node (js2-node-at-point))
    ;; scanning from AST, no way to optimise `js2-node-at-point'
    (while (and next-node (arrayp next-node) (&amp;gt; (length next-node) 5))
      (setq node-type (aref next-node 0))
      (cond
       ;; json property node
       ((eq node-type 'cl-struct-js2-object-prop-node)
        (setq key-name (js2-prop-node-name (js2-object-prop-node-left next-node)))
        (if rlt (setq rlt (concat "." key-name rlt))
          (setq rlt (concat "." key-name))))

       ;; array node
       ((or (eq node-type 'cl-struct-js2-array-node)
            (eq node-type 'cl-struct-js2-infix-node))
        (if rlt (setq rlt (concat "[0]" rlt))
          (setq rlt "[0]")))

       (t)) ; do nothing

      ;; get parent node
      (setq next-node (aref next-node 5)))
    ;; clean final result
    (setq rlt (replace-regexp-in-string "^\\." "" rlt))
    (when rlt
      (kill-new rlt)
      (message "%s =&amp;gt; kill-ring" rlt))
    rlt))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;
&lt;b&gt;Step 2&lt;/b&gt;, move the cursor over the key/value of the field and `M-x js2-print-json-path`.
&lt;/p&gt;&lt;/div&gt;</description><category>emacs</category><category>en</category><category>javascript</category><category>js2</category><category>mode</category><guid>http://blog.binchen.org/posts/use-js2-mode-to-print-json-path.html</guid><pubDate>Thu, 29 Oct 2015 14:18:10 GMT</pubDate></item><item><title>Notes for js3-mode in emacs</title><link>http://blog.binchen.org/posts/notes-for-js3-mode-in-emacs.html</link><dc:creator>Chen Bin</dc:creator><description>&lt;div&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Mark: 3 =&amp;gt; cool, 2 =&amp;gt; useful, 1 =&amp;gt; rarely used &lt;/p&gt;&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;&lt;colgroup&gt;&lt;col class="left"&gt;&lt;col class="left"&gt;&lt;col class="left"&gt;&lt;col class="right"&gt;&lt;/colgroup&gt;&lt;thead&gt;&lt;tr&gt;&lt;th scope="col" class="left"&gt;Function&lt;/th&gt;&lt;th scope="col" class="left"&gt;Hotkey&lt;/th&gt;&lt;th scope="col" class="left"&gt;Comment&lt;/th&gt;&lt;th scope="col" class="right"&gt;Mark&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-mode-toggle-hide-functions&lt;/td&gt;&lt;td class="left"&gt;C-c C-f&lt;/td&gt;&lt;td class="left"&gt;show/hide ALL functions&lt;/td&gt;&lt;td class="right"&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-narrow-to-defun&lt;/td&gt;&lt;td class="left"&gt;C-x n d&lt;/td&gt;&lt;td class="left"&gt;(C-x n w to wide)&lt;/td&gt;&lt;td class="right"&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-mode-display-warnings-and-errors&lt;/td&gt;&lt;td class="left"&gt;&lt;/td&gt;&lt;td class="left"&gt;&lt;/td&gt;&lt;td class="right"&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js-toggle-element&lt;/td&gt;&lt;td class="left"&gt;C-c C-o&lt;/td&gt;&lt;td class="left"&gt;show/hide code snippet between {}&lt;/td&gt;&lt;td class="right"&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-next-error&lt;/td&gt;&lt;td class="left"&gt;M-g M-n or C-x `&lt;/td&gt;&lt;td class="left"&gt;&lt;/td&gt;&lt;td class="right"&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-beginning-of-defun&lt;/td&gt;&lt;td class="left"&gt;&lt;/td&gt;&lt;td class="left"&gt;jump to the beginning of function&lt;/td&gt;&lt;td class="right"&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-end-of-defun&lt;/td&gt;&lt;td class="left"&gt;&lt;/td&gt;&lt;td class="left"&gt;jump to the end of function&lt;/td&gt;&lt;td class="right"&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-mark-defun&lt;/td&gt;&lt;td class="left"&gt;C-M-h&lt;/td&gt;&lt;td class="left"&gt;Select the function body&lt;/td&gt;&lt;td class="right"&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="left"&gt;js3-enter-mirror-mode&lt;/td&gt;&lt;td class="left"&gt;&lt;/td&gt;&lt;td class="left"&gt;Automatically insert [],()â€¦&lt;/td&gt;&lt;td class="right"&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;</description><category>emacs</category><category>en</category><category>javascript</category><category>js3</category><category>mode</category><guid>http://blog.binchen.org/posts/notes-for-js3-mode-in-emacs.html</guid><pubDate>Fri, 10 Feb 2012 18:21:00 GMT</pubDate></item></channel></rss>